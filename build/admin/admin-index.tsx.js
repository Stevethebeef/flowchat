(()=>{"use strict";var e={338:(e,t,a)=>{var n=a(795);t.H=n.createRoot,n.hydrateRoot},795:e=>{e.exports=window.ReactDOM}},t={};const a=window.React;var n=function a(n){var l=t[n];if(void 0!==l)return l.exports;var c=t[n]={exports:{}};return e[n](c,c.exports,a),c.exports}(338);function l(){const e=window.n8nChatAdmin?.i18n||{};return{i18n:e,t:(t,a)=>e[t]||a||t}}const c=({onEdit:e,onCreate:t})=>{const{t:n}=l(),[c,s]=(0,a.useState)([]),[r,o]=(0,a.useState)(!0),[i,m]=(0,a.useState)(null),d=(0,a.useCallback)(async()=>{o(!0),m(null);try{const e=await fetch(`${window.n8nChatAdmin.apiUrl}/instances`,{headers:{"X-WP-Nonce":window.n8nChatAdmin.nonce}});if(!e.ok)throw new Error("Failed to fetch instances");const t=await e.json();s(t)}catch(e){m(e instanceof Error?e.message:"An error occurred")}finally{o(!1)}},[]);return(0,a.useEffect)(()=>{d()},[d]),r?(0,a.createElement)("div",{className:"n8n-chat-instance-list"},(0,a.createElement)("div",{className:"n8n-chat-loading"},n("loadingInstances","Loading instances..."))):i?(0,a.createElement)("div",{className:"n8n-chat-instance-list"},(0,a.createElement)("div",{className:"n8n-chat-error"},i),(0,a.createElement)("button",{className:"button",onClick:d},"Retry")):(0,a.createElement)("div",{className:"n8n-chat-instance-list"},(0,a.createElement)("div",{className:"n8n-chat-instance-header"},(0,a.createElement)("h1",null,n("chatInstances","Chat Instances")),(0,a.createElement)("button",{className:"button button-primary",onClick:t},n("addNewInstance","Add New Instance"))),0===c.length?(0,a.createElement)("div",{className:"n8n-chat-empty-state"},(0,a.createElement)("p",null,n("noInstancesYet","No chat instances yet.")),(0,a.createElement)("button",{className:"button button-primary",onClick:t},n("createFirstInstance","Create Your First Instance"))):(0,a.createElement)("table",{className:"wp-list-table widefat fixed striped"},(0,a.createElement)("thead",null,(0,a.createElement)("tr",null,(0,a.createElement)("th",null,n("name","Name")),(0,a.createElement)("th",null,n("status","Status")),(0,a.createElement)("th",null,n("webhookUrl","Webhook URL")),(0,a.createElement)("th",null,n("sessions","Sessions")),(0,a.createElement)("th",null,n("shortcode","Shortcode")),(0,a.createElement)("th",null,n("actions","Actions")))),(0,a.createElement)("tbody",null,c.map(t=>{var l;return(0,a.createElement)("tr",{key:t.id},(0,a.createElement)("td",null,(0,a.createElement)("strong",null,(0,a.createElement)("a",{href:"#",onClick:a=>{a.preventDefault(),e(t.id)}},t.name)),t.isDefault&&(0,a.createElement)("span",{className:"n8n-chat-badge n8n-chat-badge-default"},"Default")),(0,a.createElement)("td",null,(0,a.createElement)("button",{className:"n8n-chat-toggle "+(t.isEnabled?"n8n-chat-toggle-on":""),onClick:()=>(async e=>{try{if(!(await fetch(`${window.n8nChatAdmin.apiUrl}/instances/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-WP-Nonce":window.n8nChatAdmin.nonce},body:JSON.stringify({...e,isEnabled:!e.isEnabled})})).ok)throw new Error("Failed to update instance");d()}catch(e){alert(e instanceof Error?e.message:"Failed to update")}})(t),title:t.isEnabled?n("disabled","Click to disable"):n("enabled","Click to enable")},(0,a.createElement)("span",{className:"n8n-chat-toggle-slider"}),(0,a.createElement)("span",{className:"screen-reader-text"},t.isEnabled?n("enabled","Enabled"):n("disabled","Disabled")))),(0,a.createElement)("td",null,t.webhookUrl?(0,a.createElement)("code",{className:"n8n-chat-webhook-url"},t.webhookUrl.substring(0,40),"..."):(0,a.createElement)("span",{className:"n8n-chat-warning"},"Not configured")),(0,a.createElement)("td",null,null!==(l=t.sessionCount)&&void 0!==l?l:0),(0,a.createElement)("td",null,(0,a.createElement)("code",null,'[n8n-chat id="',t.id,'"]')),(0,a.createElement)("td",null,(0,a.createElement)("div",{className:"n8n-chat-actions"},(0,a.createElement)("button",{className:"button button-small",onClick:()=>e(t.id)},n("edit","Edit")),(0,a.createElement)("button",{className:"button button-small",onClick:()=>(async e=>{try{if(!(await fetch(`${window.n8nChatAdmin.apiUrl}/instances/${e}/duplicate`,{method:"POST",headers:{"X-WP-Nonce":window.n8nChatAdmin.nonce}})).ok)throw new Error("Failed to duplicate instance");d()}catch(e){alert(e instanceof Error?e.message:"Failed to duplicate")}})(t.id)},n("duplicate","Duplicate")),(0,a.createElement)("button",{className:"button button-small button-link-delete",onClick:()=>(async e=>{const t=window.n8nChatAdmin.i18n;if(confirm(`${t.confirmDelete}\n\n${t.confirmDeleteMessage}`))try{if(!(await fetch(`${window.n8nChatAdmin.apiUrl}/instances/${e}`,{method:"DELETE",headers:{"X-WP-Nonce":window.n8nChatAdmin.nonce}})).ok)throw new Error("Failed to delete instance");d()}catch(e){alert(e instanceof Error?e.message:"Failed to delete")}})(t.id,t.name)},n("delete","Delete")))))}))))},s=({instance:e,updateField:t,instanceId:n})=>{const{t:c}=l(),[s,r]=(0,a.useState)(!1),[o,i]=(0,a.useState)(null),m=(e,t)=>{navigator.clipboard.writeText(e).then(()=>{i(t),setTimeout(()=>i(null),2e3)})},d=n?`[n8n_chat id="${n}"]`:"[n8n_chat]",h=n?`<?php n8n_chat_render('${n}'); ?>`:"<?php n8n_chat_render(); ?>";return(0,a.createElement)("div",{className:"n8n-chat-tab-content"},(0,a.createElement)("div",{className:"n8n-chat-section"},(0,a.createElement)("h2",{className:"n8n-chat-section-title"},c("generalSettings","General Settings")),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-name"},c("name","Name")," ",(0,a.createElement)("span",{className:"required"},"*")),(0,a.createElement)("input",{type:"text",id:"fc-name",value:e.name||"",onChange:e=>t("name",e.target.value),className:"regular-text",placeholder:"e.g., Support Bot"}),(0,a.createElement)("p",{className:"description"},c("internalNameDesc","Internal name for organization. This won't be visible to visitors."))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",null,c("status","Status")),(0,a.createElement)("div",{className:"n8n-chat-radio-group"},(0,a.createElement)("label",{className:"n8n-chat-radio"},(0,a.createElement)("input",{type:"radio",name:"status",checked:!0===e.isEnabled,onChange:()=>t("isEnabled",!0)}),(0,a.createElement)("span",{className:"n8n-chat-radio-label"},(0,a.createElement)("span",{className:"n8n-chat-status-dot n8n-chat-status-active"}),c("active","Active"))),(0,a.createElement)("label",{className:"n8n-chat-radio"},(0,a.createElement)("input",{type:"radio",name:"status",checked:!1===e.isEnabled,onChange:()=>t("isEnabled",!1)}),(0,a.createElement)("span",{className:"n8n-chat-radio-label"},(0,a.createElement)("span",{className:"n8n-chat-status-dot n8n-chat-status-inactive"}),c("inactive","Inactive")))),(0,a.createElement)("p",{className:"description"},c("statusDesc","When inactive, the chat will not appear on your site."))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:e.isDefault||!1,onChange:e=>t("isDefault",e.target.checked)}),(0,a.createElement)("span",null,c("setAsDefault","Set as default instance"))),(0,a.createElement)("p",{className:"description"},c("defaultInstanceDesc","The default instance is used when no specific ID is provided in the shortcode.")))),(0,a.createElement)("div",{className:"n8n-chat-section"},(0,a.createElement)("button",{type:"button",className:"n8n-chat-toggle-advanced",onClick:()=>r(!s),"aria-expanded":s},(0,a.createElement)("span",{className:"dashicons "+(s?"dashicons-arrow-down-alt2":"dashicons-arrow-right-alt2")}),s?c("hide","Hide"):c("show","Show")," ",c("advancedOptions","Advanced Options")),s&&(0,a.createElement)("div",{className:"n8n-chat-advanced-content"},(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-slug"},c("slug","Slug")),(0,a.createElement)("input",{type:"text",id:"fc-slug",value:n||c("autoGeneratedOnSave","Auto-generated on save"),readOnly:!0,className:"regular-text code",disabled:!0}),(0,a.createElement)("p",{className:"description"},c("slugDesc","URL-friendly identifier (auto-generated from name)."))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",null,c("shortcode","Shortcode")),(0,a.createElement)("div",{className:"n8n-chat-copy-field"},(0,a.createElement)("code",{className:"n8n-chat-code-display"},d),(0,a.createElement)("button",{type:"button",className:"button button-small",onClick:()=>m(d,"shortcode")},"shortcode"===o?c("copied","âœ“ Copied!"):c("copy","Copy"))),(0,a.createElement)("p",{className:"description"},c("shortcodeDesc","Add this to any page or post to display the chat."))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",null,c("phpFunction","PHP Function")),(0,a.createElement)("div",{className:"n8n-chat-copy-field"},(0,a.createElement)("code",{className:"n8n-chat-code-display"},h),(0,a.createElement)("button",{type:"button",className:"button button-small",onClick:()=>m(h,"php")},"php"===o?c("copied","âœ“ Copied!"):c("copy","Copy"))),(0,a.createElement)("p",{className:"description"},c("phpFunctionDesc","Use in theme templates to render the chat programmatically."))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-system-prompt"},c("systemPrompt","System Prompt (Meta-Prompt)")),(0,a.createElement)("textarea",{id:"fc-system-prompt",value:e.systemPrompt||"",onChange:e=>t("systemPrompt",e.target.value),rows:4,className:"large-text",placeholder:c("systemPromptPlaceholder","Additional context sent with every message to n8n...")}),(0,a.createElement)("p",{className:"description"},c("systemPromptDesc","This text is sent to n8n with each request. Use dynamic tags like")," ",(0,a.createElement)("code",null,"{site_name}"),", ",(0,a.createElement)("code",null,"{user_name}"),", ",(0,a.createElement)("code",null,"{current_page_title}"),".")),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",null,c("availableDynamicTags","Available Dynamic Tags")),(0,a.createElement)("div",{className:"n8n-chat-tags-list"},(0,a.createElement)("span",{className:"n8n-chat-tag",onClick:()=>m("{site_name}","tag1")},"{site_name}"),(0,a.createElement)("span",{className:"n8n-chat-tag",onClick:()=>m("{site_url}","tag2")},"{site_url}"),(0,a.createElement)("span",{className:"n8n-chat-tag",onClick:()=>m("{user_name}","tag3")},"{user_name}"),(0,a.createElement)("span",{className:"n8n-chat-tag",onClick:()=>m("{user_email}","tag4")},"{user_email}"),(0,a.createElement)("span",{className:"n8n-chat-tag",onClick:()=>m("{user_role}","tag5")},"{user_role}"),(0,a.createElement)("span",{className:"n8n-chat-tag",onClick:()=>m("{current_page_title}","tag6")},"{current_page_title}"),(0,a.createElement)("span",{className:"n8n-chat-tag",onClick:()=>m("{current_page_url}","tag7")},"{current_page_url}"),(0,a.createElement)("span",{className:"n8n-chat-tag",onClick:()=>m("{current_date}","tag8")},"{current_date}"),(0,a.createElement)("span",{className:"n8n-chat-tag",onClick:()=>m("{current_time}","tag9")},"{current_time}")),(0,a.createElement)("p",{className:"description"},c("dynamicTagsDesc","Click a tag to copy it. Tags are replaced with actual values when sent to n8n."))))))},r=({content:e,children:t,position:n="top"})=>{const[l,c]=(0,a.useState)(!1),[s,r]=(0,a.useState)(n),o=(0,a.useRef)(null),i=(0,a.useRef)(null);return(0,a.useEffect)(()=>{if(l&&i.current&&o.current){const e=i.current.getBoundingClientRect();o.current.getBoundingClientRect(),"top"===n&&e.top<0?r("bottom"):"bottom"===n&&e.bottom>window.innerHeight?r("top"):"left"===n&&e.left<0?r("right"):"right"===n&&e.right>window.innerWidth?r("left"):r(n)}},[l,n]),(0,a.createElement)("span",{ref:o,className:"n8n-chat-tooltip-wrapper",onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),onFocus:()=>c(!0),onBlur:()=>c(!1)},t,l&&(0,a.createElement)("span",{ref:i,className:`n8n-chat-tooltip n8n-chat-tooltip--${s}`,role:"tooltip"},e))},o=({tooltip:e,position:t="top"})=>(0,a.createElement)(r,{content:e,position:t},(0,a.createElement)("span",{className:"dashicons dashicons-info n8n-chat-info-icon","aria-label":"More information",tabIndex:0})),i=({instance:e,updateField:t})=>{const{t:n}=l(),[c,s]=(0,a.useState)(!1),[r,i]=(0,a.useState)(!1),[m,d]=(0,a.useState)(!1),[h,u]=(0,a.useState)(null),p=e.connection||{},E=p.auth||"none";return(0,a.createElement)("div",{className:"n8n-chat-tab-content"},(0,a.createElement)("div",{className:"n8n-chat-section"},(0,a.createElement)("h2",{className:"n8n-chat-section-title"},"n8n Connection"),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-webhook-url"},n("webhookUrl","n8n Webhook URL")," ",(0,a.createElement)("span",{className:"required"},"*"),(0,a.createElement)(o,{tooltip:n("tooltipWebhookUrl","Copy this from your n8n Chat Trigger node. Open n8n â†’ Chat Trigger node â†’ Production URL")})),(0,a.createElement)("input",{type:"url",id:"fc-webhook-url",value:e.webhookUrl||"",onChange:e=>t("webhookUrl",e.target.value),className:"large-text code",placeholder:"https://your-n8n.example.com/webhook/abc123"}),(0,a.createElement)("p",{className:"description"},n("webhookUrlDesc","The production webhook URL from your n8n Chat Trigger node."))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",null,"Authentication"),(0,a.createElement)("div",{className:"n8n-chat-radio-group n8n-chat-radio-group-vertical"},(0,a.createElement)("label",{className:"n8n-chat-radio"},(0,a.createElement)("input",{type:"radio",name:"auth",checked:"none"===E,onChange:()=>t("connection.auth","none")}),(0,a.createElement)("span",{className:"n8n-chat-radio-label"},"None (Public)")),(0,a.createElement)("label",{className:"n8n-chat-radio"},(0,a.createElement)("input",{type:"radio",name:"auth",checked:"basic"===E,onChange:()=>t("connection.auth","basic")}),(0,a.createElement)("span",{className:"n8n-chat-radio-label"},"Basic Auth")),(0,a.createElement)("label",{className:"n8n-chat-radio"},(0,a.createElement)("input",{type:"radio",name:"auth",checked:"bearer"===E,onChange:()=>t("connection.auth","bearer")}),(0,a.createElement)("span",{className:"n8n-chat-radio-label"},"Bearer Token")))),"basic"===E&&(0,a.createElement)("div",{className:"n8n-chat-auth-fields"},(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-auth-username"},"Username"),(0,a.createElement)("input",{type:"text",id:"fc-auth-username",value:p.username||"",onChange:e=>t("connection.username",e.target.value),className:"regular-text"})),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-auth-password"},"Password"),(0,a.createElement)("div",{className:"n8n-chat-password-field"},(0,a.createElement)("input",{type:r?"text":"password",id:"fc-auth-password",value:p.password||"",onChange:e=>t("connection.password",e.target.value),className:"regular-text"}),(0,a.createElement)("button",{type:"button",className:"button button-small n8n-chat-toggle-password",onClick:()=>i(!r),"aria-label":r?"Hide password":"Show password"},(0,a.createElement)("span",{className:"dashicons "+(r?"dashicons-hidden":"dashicons-visibility")}))))),"bearer"===E&&(0,a.createElement)("div",{className:"n8n-chat-auth-fields"},(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-auth-token"},"Bearer Token"),(0,a.createElement)("div",{className:"n8n-chat-password-field"},(0,a.createElement)("input",{type:r?"text":"password",id:"fc-auth-token",value:p.bearerToken||"",onChange:e=>t("connection.bearerToken",e.target.value),className:"large-text code",placeholder:"Enter your bearer token"}),(0,a.createElement)("button",{type:"button",className:"button button-small n8n-chat-toggle-password",onClick:()=>i(!r),"aria-label":r?"Hide token":"Show token"},(0,a.createElement)("span",{className:"dashicons "+(r?"dashicons-hidden":"dashicons-visibility")})))))),(0,a.createElement)("div",{className:"n8n-chat-section"},(0,a.createElement)("h2",{className:"n8n-chat-section-title"},n("streaming","Streaming")),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:!1!==p.enableStreaming,onChange:e=>t("connection.enableStreaming",e.target.checked)}),(0,a.createElement)("span",null,n("streamResponses","Stream responses in real-time")),(0,a.createElement)(o,{tooltip:n("tooltipStreaming","Enable Server-Sent Events for real-time responses. Your n8n Chat Trigger must also have streaming enabled.")})),(0,a.createElement)("p",{className:"description"},n("streamingDesc","Show AI responses word-by-word as they are generated.")))),(0,a.createElement)("div",{className:"n8n-chat-section"},(0,a.createElement)("h2",{className:"n8n-chat-section-title"},n("connectionTest","Connection Test")),(0,a.createElement)("div",{className:"n8n-chat-connection-test"},h&&(0,a.createElement)("div",{className:"n8n-chat-test-result "+(h.success?"is-success":"is-error")},(0,a.createElement)("div",{className:"n8n-chat-test-status"},(0,a.createElement)("span",{className:"dashicons "+(h.success?"dashicons-yes-alt":"dashicons-warning")}),(0,a.createElement)("span",{className:"n8n-chat-test-message"},h.success?n("connected","Connected"):n("connectionFailed","Connection Failed"))),(0,a.createElement)("p",null,h.message),h.responseTime&&(0,a.createElement)("p",{className:"n8n-chat-test-meta"},n("responseTime","Response time"),": ",h.responseTime,"ms")),(0,a.createElement)("button",{type:"button",className:"button",onClick:async()=>{if(e.webhookUrl){d(!0),u(null);try{const t=await fetch(`${window.n8nChatAdmin.apiUrl}/test-webhook`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.n8nChatAdmin.nonce},body:JSON.stringify({url:e.webhookUrl,auth:p.auth,username:p.username,password:p.password,bearerToken:p.bearerToken})}),a=await t.json();u({success:a.success,message:a.message,statusCode:a.status_code,responseTime:a.response_time})}catch(e){u({success:!1,message:e instanceof Error?e.message:"Test failed"})}finally{d(!1)}}else u({success:!1,message:"Please enter a webhook URL first."})},disabled:m||!e.webhookUrl},m?(0,a.createElement)(a.Fragment,null,(0,a.createElement)("span",{className:"spinner is-active"}),n("testing","Testing...")):n("testConnectionNow","Test Connection Now")))),(0,a.createElement)("div",{className:"n8n-chat-section"},(0,a.createElement)("button",{type:"button",className:"n8n-chat-toggle-advanced",onClick:()=>s(!c),"aria-expanded":c},(0,a.createElement)("span",{className:"dashicons "+(c?"dashicons-arrow-down-alt2":"dashicons-arrow-right-alt2")}),c?n("hide","Hide"):n("show","Show")," ",n("advancedConnectionSettings","Advanced Connection Settings")),c&&(0,a.createElement)("div",{className:"n8n-chat-advanced-content"},(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-timeout"},n("timeout","Timeout")," (",n("seconds","seconds"),")"),(0,a.createElement)("input",{type:"number",id:"fc-timeout",value:p.timeout||30,onChange:e=>t("connection.timeout",parseInt(e.target.value,10)),min:5,max:120,className:"small-text"}),(0,a.createElement)("p",{className:"description"},n("timeoutDesc","How long to wait for a response before timing out."))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-chat-input-key"},n("chatInputKey","Chat Input Key"),(0,a.createElement)(o,{tooltip:n("tooltipChatInputKey","The JSON key n8n expects for the user's message. Only change if your n8n workflow uses a different key name.")})),(0,a.createElement)("input",{type:"text",id:"fc-chat-input-key",value:p.chatInputKey||"chatInput",onChange:e=>t("connection.chatInputKey",e.target.value),className:"regular-text code"}),(0,a.createElement)("p",{className:"description"},n("chatInputKeyDesc","The key name for the user message in n8n.")," ",n("default","Default"),": ",(0,a.createElement)("code",null,"chatInput"))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-session-key"},n("sessionKey","Session Key"),(0,a.createElement)(o,{tooltip:n("tooltipSessionKey","The JSON key for session tracking. Enables conversation history in n8n.")})),(0,a.createElement)("input",{type:"text",id:"fc-session-key",value:p.sessionKey||"sessionId",onChange:e=>t("connection.sessionKey",e.target.value),className:"regular-text code"}),(0,a.createElement)("p",{className:"description"},n("sessionKeyDesc","The key name for session ID in n8n.")," ",n("default","Default"),": ",(0,a.createElement)("code",null,"sessionId"))))))},m=[{id:"chat",icon:"ðŸ’¬",label:"Chat"},{id:"robot",icon:"ðŸ¤–",label:"Robot"},{id:"help",icon:"â“",label:"Help"},{id:"support",icon:"ðŸŽ§",label:"Support"},{id:"sparkle",icon:"âœ¨",label:"Sparkle"},{id:"custom",icon:"ðŸ“·",label:"Custom"}],d=[{id:"bottom-right",label:"Bottom Right"},{id:"bottom-left",label:"Bottom Left"},{id:"top-right",label:"Top Right"},{id:"top-left",label:"Top Left"}],h=[{id:"small",label:"Small",px:"48px"},{id:"medium",label:"Medium",px:"56px"},{id:"large",label:"Large",px:"64px"}],u=({instance:e,updateField:t})=>{const[n,l]=(0,a.useState)(!1),c=e.bubble||{},s=e.autoOpen||{},r=e.window||{},o=c.enabled?"bubble":"inline",i=e=>{"bubble"===e?(t("bubble.enabled",!0),c.showOnAllPages||t("bubble.showOnAllPages",!0)):t("bubble.enabled",!1)};return(0,a.createElement)("div",{className:"n8n-chat-tab-content"},(0,a.createElement)("div",{className:"n8n-chat-section"},(0,a.createElement)("h2",{className:"n8n-chat-section-title"},"Display Mode"),(0,a.createElement)("div",{className:"n8n-chat-mode-selector"},(0,a.createElement)("div",{className:"n8n-chat-mode-card "+("bubble"===o?"is-selected":""),onClick:()=>i("bubble")},(0,a.createElement)("div",{className:"n8n-chat-mode-preview"},(0,a.createElement)("div",{className:"n8n-chat-mode-preview-bubble"},(0,a.createElement)("span",null,"ðŸ’¬"))),(0,a.createElement)("div",{className:"n8n-chat-mode-info"},(0,a.createElement)("h4",null,"Floating Bubble"),(0,a.createElement)("p",null,"Shows as a floating button that expands into a chat window.")),(0,a.createElement)("div",{className:"n8n-chat-mode-check"},(0,a.createElement)("span",{className:"dashicons dashicons-yes"}))),(0,a.createElement)("div",{className:"n8n-chat-mode-card "+("inline"===o?"is-selected":""),onClick:()=>i("inline")},(0,a.createElement)("div",{className:"n8n-chat-mode-preview"},(0,a.createElement)("div",{className:"n8n-chat-mode-preview-inline"},(0,a.createElement)("div",{className:"n8n-chat-mode-preview-header"}),(0,a.createElement)("div",{className:"n8n-chat-mode-preview-messages"},(0,a.createElement)("div",{className:"n8n-chat-mode-preview-msg"}),(0,a.createElement)("div",{className:"n8n-chat-mode-preview-msg user"})))),(0,a.createElement)("div",{className:"n8n-chat-mode-info"},(0,a.createElement)("h4",null,"Inline Widget"),(0,a.createElement)("p",null,"Embeds directly in page content using shortcode placement.")),(0,a.createElement)("div",{className:"n8n-chat-mode-check"},(0,a.createElement)("span",{className:"dashicons dashicons-yes"}))))),"bubble"===o&&(0,a.createElement)("div",{className:"n8n-chat-section"},(0,a.createElement)("h2",{className:"n8n-chat-section-title"},"Bubble Settings"),(0,a.createElement)("div",{className:"n8n-chat-field n8n-chat-toggle-field n8n-chat-highlight-field"},(0,a.createElement)("label",{className:"n8n-chat-toggle"},(0,a.createElement)("input",{type:"checkbox",checked:!0===c.showOnAllPages,onChange:e=>t("bubble.showOnAllPages",e.target.checked)}),(0,a.createElement)("span",{className:"n8n-chat-toggle-slider"}),(0,a.createElement)("span",{className:"n8n-chat-toggle-label"},(0,a.createElement)("strong",null,"Show on all pages"),(0,a.createElement)("span",{className:"n8n-chat-toggle-description"},"Enable this to display the chat bubble on every page of your site automatically. No shortcode needed!")))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",null,"Position"),(0,a.createElement)("div",{className:"n8n-chat-position-selector"},d.map(e=>(0,a.createElement)("label",{key:e.id,className:"n8n-chat-position-option"},(0,a.createElement)("input",{type:"radio",name:"position",checked:c.position===e.id,onChange:()=>t("bubble.position",e.id)}),(0,a.createElement)("span",{className:`n8n-chat-position-preview ${e.id}`},(0,a.createElement)("span",{className:"n8n-chat-position-dot"})),(0,a.createElement)("span",{className:"n8n-chat-position-label"},e.label))))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",null,"Bubble Icon"),(0,a.createElement)("div",{className:"n8n-chat-icon-selector"},m.map(e=>(0,a.createElement)("button",{key:e.id,type:"button",className:"n8n-chat-icon-option "+(c.icon===e.id?"is-selected":""),onClick:()=>t("bubble.icon",e.id),title:e.label},(0,a.createElement)("span",{className:"n8n-chat-icon-preview"},e.icon))))),"custom"===c.icon&&(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-custom-icon"},"Custom Icon URL"),(0,a.createElement)("input",{type:"url",id:"fc-custom-icon",value:c.customIconUrl||"",onChange:e=>t("bubble.customIconUrl",e.target.value),className:"large-text",placeholder:"https://example.com/icon.png"})),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",null,"Bubble Size"),(0,a.createElement)("div",{className:"n8n-chat-size-selector"},h.map(e=>(0,a.createElement)("label",{key:e.id,className:"n8n-chat-size-option"},(0,a.createElement)("input",{type:"radio",name:"size",checked:c.size===e.id,onChange:()=>t("bubble.size",e.id)}),(0,a.createElement)("span",{className:"n8n-chat-size-preview"},(0,a.createElement)("span",{className:`n8n-chat-size-circle ${e.id}`}),(0,a.createElement)("span",null,e.label)))))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-bubble-text"},"Bubble Text (Optional)"),(0,a.createElement)("input",{type:"text",id:"fc-bubble-text",value:c.text||"",onChange:e=>t("bubble.text",e.target.value),className:"regular-text",placeholder:"e.g., Chat with us!"}),(0,a.createElement)("p",{className:"description"},"Text shown next to the bubble. Leave empty for icon only.")),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:!1!==c.pulseAnimation,onChange:e=>t("bubble.pulseAnimation",e.target.checked)}),(0,a.createElement)("span",null,"Pulse animation to attract attention"))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:!1!==c.showUnreadBadge,onChange:e=>t("bubble.showUnreadBadge",e.target.checked)}),(0,a.createElement)("span",null,"Show unread message badge"))),(0,a.createElement)("div",{className:"n8n-chat-field-row"},(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-offset-x"},"Horizontal Offset"),(0,a.createElement)("div",{className:"n8n-chat-slider-field"},(0,a.createElement)("input",{type:"range",id:"fc-offset-x",min:0,max:100,value:c.offsetX||24,onChange:e=>t("bubble.offsetX",parseInt(e.target.value,10))}),(0,a.createElement)("span",{className:"n8n-chat-slider-value"},c.offsetX||24,"px"))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-offset-y"},"Vertical Offset"),(0,a.createElement)("div",{className:"n8n-chat-slider-field"},(0,a.createElement)("input",{type:"range",id:"fc-offset-y",min:0,max:100,value:c.offsetY||24,onChange:e=>t("bubble.offsetY",parseInt(e.target.value,10))}),(0,a.createElement)("span",{className:"n8n-chat-slider-value"},c.offsetY||24,"px"))))),(0,a.createElement)("div",{className:"n8n-chat-section"},(0,a.createElement)("h2",{className:"n8n-chat-section-title"},"Chat Window Size"),(0,a.createElement)("div",{className:"n8n-chat-field-row"},(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-window-width"},"Width"),(0,a.createElement)("div",{className:"n8n-chat-slider-field"},(0,a.createElement)("input",{type:"range",id:"fc-window-width",min:300,max:600,step:10,value:r.width||400,onChange:e=>t("window.width",parseInt(e.target.value,10))}),(0,a.createElement)("span",{className:"n8n-chat-slider-value"},r.width||400,"px"))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-window-height"},"Height"),(0,a.createElement)("div",{className:"n8n-chat-slider-field"},(0,a.createElement)("input",{type:"range",id:"fc-window-height",min:400,max:800,step:10,value:r.height||600,onChange:e=>t("window.height",parseInt(e.target.value,10))}),(0,a.createElement)("span",{className:"n8n-chat-slider-value"},r.height||600,"px"))))),"bubble"===o&&(0,a.createElement)("div",{className:"n8n-chat-section"},(0,a.createElement)("h2",{className:"n8n-chat-section-title"},"Auto-Open Behavior"),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:s.enabled||!1,onChange:e=>t("autoOpen.enabled",e.target.checked)}),(0,a.createElement)("span",null,"Automatically open chat window"))),s.enabled&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",null,"Trigger"),(0,a.createElement)("div",{className:"n8n-chat-radio-group"},(0,a.createElement)("label",{className:"n8n-chat-radio"},(0,a.createElement)("input",{type:"radio",name:"autoOpenTrigger",checked:"delay"===s.trigger,onChange:()=>t("autoOpen.trigger","delay")}),(0,a.createElement)("span",{className:"n8n-chat-radio-label"},"Time Delay")),(0,a.createElement)("label",{className:"n8n-chat-radio"},(0,a.createElement)("input",{type:"radio",name:"autoOpenTrigger",checked:"scroll"===s.trigger,onChange:()=>t("autoOpen.trigger","scroll")}),(0,a.createElement)("span",{className:"n8n-chat-radio-label"},"Scroll Position")),(0,a.createElement)("label",{className:"n8n-chat-radio"},(0,a.createElement)("input",{type:"radio",name:"autoOpenTrigger",checked:"idle"===s.trigger,onChange:()=>t("autoOpen.trigger","idle")}),(0,a.createElement)("span",{className:"n8n-chat-radio-label"},"User Idle")))),"delay"===s.trigger&&(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-auto-delay"},"Delay (seconds)"),(0,a.createElement)("input",{type:"number",id:"fc-auto-delay",value:Math.round((s.delay||5e3)/1e3),onChange:e=>t("autoOpen.delay",1e3*parseInt(e.target.value,10)),min:1,max:60,className:"small-text"})),"scroll"===s.trigger&&(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-auto-scroll"},"Scroll Percentage"),(0,a.createElement)("div",{className:"n8n-chat-slider-field"},(0,a.createElement)("input",{type:"range",id:"fc-auto-scroll",min:10,max:90,step:5,value:s.scrollPercentage||50,onChange:e=>t("autoOpen.scrollPercentage",parseInt(e.target.value,10))}),(0,a.createElement)("span",{className:"n8n-chat-slider-value"},s.scrollPercentage||50,"%"))),"idle"===s.trigger&&(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-auto-idle"},"Idle Time (seconds)"),(0,a.createElement)("input",{type:"number",id:"fc-auto-idle",value:Math.round((s.idleTime||3e4)/1e3),onChange:e=>t("autoOpen.idleTime",1e3*parseInt(e.target.value,10)),min:5,max:300,className:"small-text"})),(0,a.createElement)("button",{type:"button",className:"n8n-chat-toggle-advanced",onClick:()=>l(!n),"aria-expanded":n},(0,a.createElement)("span",{className:"dashicons "+(n?"dashicons-arrow-down-alt2":"dashicons-arrow-right-alt2")}),n?"Hide":"Show"," Advanced Conditions"),n&&(0,a.createElement)("div",{className:"n8n-chat-advanced-content"},(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:!1!==s.conditions?.oncePerSession,onChange:e=>t("autoOpen.conditions.oncePerSession",e.target.checked)}),(0,a.createElement)("span",null,"Once per session only"))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:s.conditions?.oncePerDay||!1,onChange:e=>t("autoOpen.conditions.oncePerDay",e.target.checked)}),(0,a.createElement)("span",null,"Once per day only"))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:!1!==s.conditions?.skipIfInteracted,onChange:e=>t("autoOpen.conditions.skipIfInteracted",e.target.checked)}),(0,a.createElement)("span",null,"Skip if user already interacted"))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:s.conditions?.excludeMobile||!1,onChange:e=>t("autoOpen.conditions.excludeMobile",e.target.checked)}),(0,a.createElement)("span",null,"Disable on mobile devices")))))))},p=({instance:e,updateField:t})=>{const{t:n}=l(),[c,s]=(0,a.useState)(!1),r=e.messages||{},i=e.suggestedPrompts||[];return(0,a.createElement)("div",{className:"n8n-chat-tab-content"},(0,a.createElement)("div",{className:"n8n-chat-section"},(0,a.createElement)("h2",{className:"n8n-chat-section-title"},"Welcome Screen"),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:!1!==r.showWelcomeScreen,onChange:e=>t("messages.showWelcomeScreen",e.target.checked)}),(0,a.createElement)("span",null,"Show welcome screen on first open")),(0,a.createElement)("p",{className:"description"},"Display a greeting screen before the chat conversation starts.")),!1!==r.showWelcomeScreen&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-chat-title"},"Chat Title"),(0,a.createElement)("input",{type:"text",id:"fc-chat-title",value:e.chatTitle||"",onChange:e=>t("chatTitle",e.target.value),className:"regular-text",placeholder:"e.g., How can we help?"}),(0,a.createElement)("p",{className:"description"},"Title shown at the top of the chat window.")),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-welcome-message"},"Welcome Message"),(0,a.createElement)("textarea",{id:"fc-welcome-message",value:e.welcomeMessage||"",onChange:e=>t("welcomeMessage",e.target.value),rows:3,className:"large-text",placeholder:"Hi! ðŸ‘‹ How can I help you today?"}),(0,a.createElement)("p",{className:"description"},"The initial greeting message shown to users.")),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",null,"Quick Suggestions",(0,a.createElement)("span",{className:"n8n-chat-field-note"},"(max 4)")),(0,a.createElement)("div",{className:"n8n-chat-suggestions-list"},i.map((e,n)=>(0,a.createElement)("div",{key:n,className:"n8n-chat-suggestion-item"},(0,a.createElement)("input",{type:"text",value:e,onChange:e=>((e,a)=>{const n=[...i];n[e]=a,t("suggestedPrompts",n)})(n,e.target.value),className:"regular-text",placeholder:`Suggestion ${n+1}`}),(0,a.createElement)("button",{type:"button",className:"button-link n8n-chat-remove-btn",onClick:()=>(e=>{const a=i.filter((t,a)=>a!==e);t("suggestedPrompts",a)})(n),"aria-label":"Remove suggestion"},(0,a.createElement)("span",{className:"dashicons dashicons-no-alt"})))),i.length<4&&(0,a.createElement)("button",{type:"button",className:"button button-secondary",onClick:()=>{i.length<4&&t("suggestedPrompts",[...i,""])}},(0,a.createElement)("span",{className:"dashicons dashicons-plus-alt2"}),"Add Suggestion")),(0,a.createElement)("p",{className:"description"},"Quick prompts users can click to start a conversation.")))),(0,a.createElement)("div",{className:"n8n-chat-section"},(0,a.createElement)("h2",{className:"n8n-chat-section-title"},"Chat Input"),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-placeholder"},"Input Placeholder"),(0,a.createElement)("input",{type:"text",id:"fc-placeholder",value:e.placeholderText||"",onChange:e=>t("placeholderText",e.target.value),className:"regular-text",placeholder:"Type your message..."}),(0,a.createElement)("p",{className:"description"},"Placeholder text shown in the message input field."))),(0,a.createElement)("div",{className:"n8n-chat-section"},(0,a.createElement)("h2",{className:"n8n-chat-section-title"},"UI Options"),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:!1!==e.showHeader,onChange:e=>t("showHeader",e.target.checked)}),(0,a.createElement)("span",null,"Show chat header"))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:e.showTimestamp||!1,onChange:e=>t("showTimestamp",e.target.checked)}),(0,a.createElement)("span",null,"Show message timestamps"))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:!1!==e.showAvatar,onChange:e=>t("showAvatar",e.target.checked)}),(0,a.createElement)("span",null,"Show bot avatar"))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:!1!==e.features?.showTypingIndicator,onChange:e=>t("features.showTypingIndicator",e.target.checked)}),(0,a.createElement)("span",null,"Show typing indicator")))),(0,a.createElement)("div",{className:"n8n-chat-section"},(0,a.createElement)("h2",{className:"n8n-chat-section-title"},n("inputFeatures","Input Features")),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:!1!==e.features?.voiceInput,onChange:e=>t("features.voiceInput",e.target.checked)}),(0,a.createElement)("span",null,n("enableVoiceInput","Enable voice input")),(0,a.createElement)(o,{tooltip:n("tooltipVoiceInput","Uses Web Speech API. Supported in Chrome, Edge, and Safari. Firefox has limited support.")})),(0,a.createElement)("p",{className:"description"},n("voiceInputDesc","Allow users to dictate messages using their microphone."))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:e.features?.fileUpload||!1,onChange:e=>t("features.fileUpload",e.target.checked)}),(0,a.createElement)("span",null,n("enableFileUploads","Enable file uploads")),(0,a.createElement)(o,{tooltip:n("tooltipFileUpload","Files are uploaded to wp-content/uploads/n8n-chat/temp/ and auto-deleted after 24 hours.")})),(0,a.createElement)("p",{className:"description"},n("fileUploadsDesc","Allow users to attach files and images to their messages."))),e.features?.fileUpload&&(0,a.createElement)("div",{className:"n8n-chat-subsection"},(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",null,"Allowed File Types"),(0,a.createElement)("div",{className:"n8n-chat-file-types-grid"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:e.features?.fileTypes?.includes("image/jpeg")||!1,onChange:a=>{const n=e.features?.fileTypes||[];a.target.checked?t("features.fileTypes",[...n,"image/jpeg"]):t("features.fileTypes",n.filter(e=>"image/jpeg"!==e))}}),(0,a.createElement)("span",null,"JPEG Images")),(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:e.features?.fileTypes?.includes("image/png")||!1,onChange:a=>{const n=e.features?.fileTypes||[];a.target.checked?t("features.fileTypes",[...n,"image/png"]):t("features.fileTypes",n.filter(e=>"image/png"!==e))}}),(0,a.createElement)("span",null,"PNG Images")),(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:e.features?.fileTypes?.includes("image/gif")||!1,onChange:a=>{const n=e.features?.fileTypes||[];a.target.checked?t("features.fileTypes",[...n,"image/gif"]):t("features.fileTypes",n.filter(e=>"image/gif"!==e))}}),(0,a.createElement)("span",null,"GIF Images")),(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:e.features?.fileTypes?.includes("image/webp")||!1,onChange:a=>{const n=e.features?.fileTypes||[];a.target.checked?t("features.fileTypes",[...n,"image/webp"]):t("features.fileTypes",n.filter(e=>"image/webp"!==e))}}),(0,a.createElement)("span",null,"WebP Images")),(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:e.features?.fileTypes?.includes("application/pdf")||!1,onChange:a=>{const n=e.features?.fileTypes||[];a.target.checked?t("features.fileTypes",[...n,"application/pdf"]):t("features.fileTypes",n.filter(e=>"application/pdf"!==e))}}),(0,a.createElement)("span",null,"PDF Documents")),(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:e.features?.fileTypes?.includes("text/plain")||!1,onChange:a=>{const n=e.features?.fileTypes||[];a.target.checked?t("features.fileTypes",[...n,"text/plain"]):t("features.fileTypes",n.filter(e=>"text/plain"!==e))}}),(0,a.createElement)("span",null,"Text Files")))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-max-file-size"},"Maximum File Size",(0,a.createElement)("span",{className:"n8n-chat-field-value"},(m=e.features?.maxFileSize||10485760)<1024?`${m} B`:m<1048576?`${Math.round(m/1024)} KB`:`${Math.round(m/1048576)} MB`)),(0,a.createElement)("input",{type:"range",id:"fc-max-file-size",min:1048576,max:52428800,step:1048576,value:e.features?.maxFileSize||10485760,onChange:e=>t("features.maxFileSize",parseInt(e.target.value,10)),className:"n8n-chat-slider"}),(0,a.createElement)("div",{className:"n8n-chat-slider-labels"},(0,a.createElement)("span",null,"1 MB"),(0,a.createElement)("span",null,"50 MB")),(0,a.createElement)("p",{className:"description"},"Maximum size for uploaded files. Larger files will be rejected.")))),(0,a.createElement)("div",{className:"n8n-chat-section"},(0,a.createElement)("button",{type:"button",className:"n8n-chat-toggle-advanced",onClick:()=>s(!c),"aria-expanded":c},(0,a.createElement)("span",{className:"dashicons "+(c?"dashicons-arrow-down-alt2":"dashicons-arrow-right-alt2")}),c?"Hide":"Show"," Error Messages"),c&&(0,a.createElement)("div",{className:"n8n-chat-advanced-content"},(0,a.createElement)("p",{className:"n8n-chat-section-description"},"Customize the error messages shown to users when something goes wrong."),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-error-connection"},"Connection Error"),(0,a.createElement)("textarea",{id:"fc-error-connection",value:r.connectionError||"",onChange:e=>t("messages.connectionError",e.target.value),rows:2,className:"large-text",placeholder:"Sorry, I'm having trouble connecting. Please try again in a moment."})),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-error-timeout"},"Timeout Error"),(0,a.createElement)("textarea",{id:"fc-error-timeout",value:r.timeoutError||"",onChange:e=>t("messages.timeoutError",e.target.value),rows:2,className:"large-text",placeholder:"The request took too long. Please try again."})),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-error-rate-limit"},"Rate Limit Error"),(0,a.createElement)("textarea",{id:"fc-error-rate-limit",value:r.rateLimitError||"",onChange:e=>t("messages.rateLimitError",e.target.value),rows:2,className:"large-text",placeholder:"You're sending messages too quickly. Please wait a moment."})))),(0,a.createElement)("div",{className:"n8n-chat-section"},(0,a.createElement)("h2",{className:"n8n-chat-section-title"},"Offline Fallback"),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:!1!==e.fallback?.enabled,onChange:e=>t("fallback.enabled",e.target.checked)}),(0,a.createElement)("span",null,"Enable fallback contact form")),(0,a.createElement)("p",{className:"description"},"Show a contact form when the chat is unavailable.")),!1!==e.fallback?.enabled&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-fallback-email"},"Notification Email"),(0,a.createElement)("input",{type:"email",id:"fc-fallback-email",value:e.fallback?.email||"",onChange:e=>t("fallback.email",e.target.value),className:"regular-text",placeholder:"support@example.com"}),(0,a.createElement)("p",{className:"description"},"Email address to receive fallback form submissions.")),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-fallback-message"},"Fallback Message"),(0,a.createElement)("textarea",{id:"fc-fallback-message",value:e.fallback?.message||"",onChange:e=>t("fallback.message",e.target.value),rows:2,className:"large-text",placeholder:"Our chat is temporarily unavailable. Please leave a message."})))));var m},E=[{id:"system",label:"System Default"},{id:"inter",label:"Inter"},{id:"roboto",label:"Roboto"},{id:"open-sans",label:"Open Sans"},{id:"lato",label:"Lato"},{id:"poppins",label:"Poppins"}],b=[{id:"small",label:"Small (14px)"},{id:"medium",label:"Medium (16px)"},{id:"large",label:"Large (18px)"}],g=[{id:"custom",label:"Custom Colors",description:"Set your own colors"},{id:"theme",label:"Theme Colors",description:"Match your WordPress theme"},{id:"preset",label:"Style Preset",description:"Use a pre-designed style"}],f=({instance:e,updateField:t})=>{const{t:n}=l(),[c,s]=(0,a.useState)([]),[r,i]=(0,a.useState)(!0),[m,d]=(0,a.useState)(!1),h=e.appearance||{},u=e.colorSource||"custom";return(0,a.useEffect)(()=>{(async()=>{try{const e=await fetch(`${window.n8nChatAdmin.apiUrl}/style-presets`,{headers:{"X-WP-Nonce":window.n8nChatAdmin.nonce}});if(e.ok){const t=await e.json();s(t)}}catch(e){console.error("Failed to fetch style presets:",e)}finally{i(!1)}})()},[]),(0,a.createElement)("div",{className:"n8n-chat-tab-content"},(0,a.createElement)("div",{className:"n8n-chat-section"},(0,a.createElement)("h2",{className:"n8n-chat-section-title"},n("colorScheme","Color Scheme")),(0,a.createElement)("div",{className:"n8n-chat-color-source-selector"},g.map(e=>(0,a.createElement)("label",{key:e.id,className:"n8n-chat-color-source-option"},(0,a.createElement)("input",{type:"radio",name:"colorSource",checked:u===e.id,onChange:()=>t("colorSource",e.id)}),(0,a.createElement)("div",{className:"n8n-chat-color-source-content"},(0,a.createElement)("span",{className:"n8n-chat-color-source-label"},n(`colorSource_${e.id}`,e.label)),(0,a.createElement)("span",{className:"n8n-chat-color-source-desc"},n(`colorSourceDesc_${e.id}`,e.description))))))),"preset"===u&&(0,a.createElement)("div",{className:"n8n-chat-section"},(0,a.createElement)("h2",{className:"n8n-chat-section-title"},n("stylePresets","Style Presets")),r?(0,a.createElement)("div",{className:"n8n-chat-loading-inline"},(0,a.createElement)("span",{className:"spinner is-active"}),n("loadingPresets","Loading presets...")):(0,a.createElement)("div",{className:"n8n-chat-presets-grid"},c.map(n=>(0,a.createElement)("div",{key:n.id,className:"n8n-chat-preset-card "+(e.stylePreset===n.id?"is-selected":""),onClick:()=>(e=>{t("stylePreset",e.id),t("appearance.userBubbleColor",e.colors.userBubble),t("appearance.botBubbleColor",e.colors.botBubble),t("appearance.backgroundColor",e.colors.background),t("appearance.textColor",e.colors.text),t("appearance.headerBackground",e.colors.header),t("appearance.borderRadius",e.borderRadius),t("appearance.fontFamily",e.fontFamily),t("primaryColor",e.colors.primary)})(n)},(0,a.createElement)("div",{className:"n8n-chat-preset-preview",style:{backgroundColor:n.colors.background,borderRadius:`${n.borderRadius}px`}},(0,a.createElement)("div",{className:"n8n-chat-preset-header",style:{backgroundColor:n.colors.header}}),(0,a.createElement)("div",{className:"n8n-chat-preset-messages"},(0,a.createElement)("div",{className:"n8n-chat-preset-msg bot",style:{backgroundColor:n.colors.botBubble}}),(0,a.createElement)("div",{className:"n8n-chat-preset-msg user",style:{backgroundColor:n.colors.userBubble}}))),(0,a.createElement)("div",{className:"n8n-chat-preset-info"},(0,a.createElement)("h4",null,n.name),(0,a.createElement)("p",null,n.description)),e.stylePreset===n.id&&(0,a.createElement)("div",{className:"n8n-chat-preset-check"},(0,a.createElement)("span",{className:"dashicons dashicons-yes"})))))),"custom"===u&&(0,a.createElement)("div",{className:"n8n-chat-section"},(0,a.createElement)("h2",{className:"n8n-chat-section-title"},n("customColors","Custom Colors")),(0,a.createElement)("div",{className:"n8n-chat-color-grid"},(0,a.createElement)("div",{className:"n8n-chat-color-field"},(0,a.createElement)("label",{htmlFor:"fc-color-primary"},n("primaryColor","Primary Color")),(0,a.createElement)("div",{className:"n8n-chat-color-input"},(0,a.createElement)("input",{type:"color",id:"fc-color-primary",value:e.primaryColor||"#3b82f6",onChange:e=>t("primaryColor",e.target.value)}),(0,a.createElement)("input",{type:"text",value:e.primaryColor||"#3b82f6",onChange:e=>t("primaryColor",e.target.value),className:"small-text code",placeholder:"#3b82f6"}))),(0,a.createElement)("div",{className:"n8n-chat-color-field"},(0,a.createElement)("label",{htmlFor:"fc-color-user-bubble"},n("userBubble","User Bubble")),(0,a.createElement)("div",{className:"n8n-chat-color-input"},(0,a.createElement)("input",{type:"color",id:"fc-color-user-bubble",value:h.userBubbleColor||"#3b82f6",onChange:e=>t("appearance.userBubbleColor",e.target.value)}),(0,a.createElement)("input",{type:"text",value:h.userBubbleColor||"#3b82f6",onChange:e=>t("appearance.userBubbleColor",e.target.value),className:"small-text code"}))),(0,a.createElement)("div",{className:"n8n-chat-color-field"},(0,a.createElement)("label",{htmlFor:"fc-color-bot-bubble"},n("botBubble","Bot Bubble")),(0,a.createElement)("div",{className:"n8n-chat-color-input"},(0,a.createElement)("input",{type:"color",id:"fc-color-bot-bubble",value:h.botBubbleColor||"#f3f4f6",onChange:e=>t("appearance.botBubbleColor",e.target.value)}),(0,a.createElement)("input",{type:"text",value:h.botBubbleColor||"#f3f4f6",onChange:e=>t("appearance.botBubbleColor",e.target.value),className:"small-text code"}))),(0,a.createElement)("div",{className:"n8n-chat-color-field"},(0,a.createElement)("label",{htmlFor:"fc-color-background"},n("background","Background")),(0,a.createElement)("div",{className:"n8n-chat-color-input"},(0,a.createElement)("input",{type:"color",id:"fc-color-background",value:h.backgroundColor||"#ffffff",onChange:e=>t("appearance.backgroundColor",e.target.value)}),(0,a.createElement)("input",{type:"text",value:h.backgroundColor||"#ffffff",onChange:e=>t("appearance.backgroundColor",e.target.value),className:"small-text code"}))),(0,a.createElement)("div",{className:"n8n-chat-color-field"},(0,a.createElement)("label",{htmlFor:"fc-color-text"},n("textColor","Text Color")),(0,a.createElement)("div",{className:"n8n-chat-color-input"},(0,a.createElement)("input",{type:"color",id:"fc-color-text",value:h.textColor||"#1f2937",onChange:e=>t("appearance.textColor",e.target.value)}),(0,a.createElement)("input",{type:"text",value:h.textColor||"#1f2937",onChange:e=>t("appearance.textColor",e.target.value),className:"small-text code"}))),(0,a.createElement)("div",{className:"n8n-chat-color-field"},(0,a.createElement)("label",{htmlFor:"fc-color-header"},n("header","Header")),(0,a.createElement)("div",{className:"n8n-chat-color-input"},(0,a.createElement)("input",{type:"color",id:"fc-color-header",value:h.headerBackground||"#3b82f6",onChange:e=>t("appearance.headerBackground",e.target.value)}),(0,a.createElement)("input",{type:"text",value:h.headerBackground||"#3b82f6",onChange:e=>t("appearance.headerBackground",e.target.value),className:"small-text code"}))))),"theme"===u&&(0,a.createElement)("div",{className:"n8n-chat-section"},(0,a.createElement)("div",{className:"n8n-chat-info-box"},(0,a.createElement)("span",{className:"dashicons dashicons-info"}),(0,a.createElement)("div",null,(0,a.createElement)("p",null,(0,a.createElement)("strong",null,n("themeIntegrationActive","Theme Integration Active"))),(0,a.createElement)("p",null,n("themeColorsDesc","Colors will be automatically extracted from your WordPress theme. This includes colors from theme.json, customizer settings, and CSS variables."),(0,a.createElement)(o,{tooltip:n("tooltipThemeColors","Extracts colors from theme.json (block themes), Customizer settings, or CSS variables like --wp--preset--color--primary.")}))))),(0,a.createElement)("div",{className:"n8n-chat-section"},(0,a.createElement)("h2",{className:"n8n-chat-section-title"},n("typography","Typography")),(0,a.createElement)("div",{className:"n8n-chat-field-row"},(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-font-family"},n("fontFamily","Font Family")),(0,a.createElement)("select",{id:"fc-font-family",value:h.fontFamily||"system",onChange:e=>t("appearance.fontFamily",e.target.value),className:"regular-text"},E.map(e=>(0,a.createElement)("option",{key:e.id,value:e.id},e.label)))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-font-size"},n("fontSize","Font Size")),(0,a.createElement)("select",{id:"fc-font-size",value:h.fontSize||"medium",onChange:e=>t("appearance.fontSize",e.target.value),className:"regular-text"},b.map(e=>(0,a.createElement)("option",{key:e.id,value:e.id},e.label))))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-border-radius"},n("borderRadius","Border Radius")),(0,a.createElement)("div",{className:"n8n-chat-slider-field"},(0,a.createElement)("input",{type:"range",id:"fc-border-radius",min:0,max:24,value:h.borderRadius||12,onChange:e=>t("appearance.borderRadius",parseInt(e.target.value,10))}),(0,a.createElement)("span",{className:"n8n-chat-slider-value"},h.borderRadius||12,"px")))),(0,a.createElement)("div",{className:"n8n-chat-section"},(0,a.createElement)("h2",{className:"n8n-chat-section-title"},n("botAvatar","Bot Avatar")),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-avatar-url"},n("avatarImageUrl","Avatar Image URL")),(0,a.createElement)("div",{className:"n8n-chat-media-field"},(0,a.createElement)("input",{type:"url",id:"fc-avatar-url",value:e.avatarUrl||"",onChange:e=>t("avatarUrl",e.target.value),className:"large-text",placeholder:"https://example.com/avatar.png"}),(0,a.createElement)("button",{type:"button",className:"button",onClick:()=>{const e=window.wp?.media?.({title:n("selectBotAvatar","Select Bot Avatar"),button:{text:n("useAsAvatar","Use as Avatar")},multiple:!1,library:{type:"image"}});e?.on("select",()=>{const a=e.state().get("selection").first().toJSON();t("avatarUrl",a.url)}),e?.open()}},(0,a.createElement)("span",{className:"dashicons dashicons-format-image"}),n("chooseImage","Choose Image"))),(0,a.createElement)("p",{className:"description"},n("avatarDesc","Leave empty to use the default bot icon. Recommended size: 80x80px."))),e.avatarUrl&&(0,a.createElement)("div",{className:"n8n-chat-avatar-preview"},(0,a.createElement)("img",{src:e.avatarUrl,alt:n("botAvatarPreview","Bot avatar preview")}),(0,a.createElement)("button",{type:"button",className:"button-link n8n-chat-remove-btn",onClick:()=>t("avatarUrl","")},n("remove","Remove")))),(0,a.createElement)("div",{className:"n8n-chat-section"},(0,a.createElement)("button",{type:"button",className:"n8n-chat-toggle-advanced",onClick:()=>d(!m),"aria-expanded":m},(0,a.createElement)("span",{className:"dashicons "+(m?"dashicons-arrow-down-alt2":"dashicons-arrow-right-alt2")}),m?n("hide","Hide"):n("show","Show")," ",n("customCss","Custom CSS")),m&&(0,a.createElement)("div",{className:"n8n-chat-advanced-content"},(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-custom-css"},n("customCss","Custom CSS")),(0,a.createElement)("textarea",{id:"fc-custom-css",value:e.customCss||"",onChange:e=>t("customCss",e.target.value),rows:10,className:"large-text code",placeholder:".n8n-chat-widget {\n  /* Your custom styles */\n}"}),(0,a.createElement)("p",{className:"description"},n("customCssDesc","Add custom CSS to further customize the chat appearance. All styles are scoped to")," ",(0,a.createElement)("code",null,".n8n-chat-widget"),".")))))},N=[{id:"url",label:"URL Contains",placeholder:"/products/"},{id:"url_exact",label:"URL Exactly",placeholder:"https://example.com/pricing"},{id:"url_regex",label:"URL Regex",placeholder:"^/blog/.*"},{id:"post_type",label:"Post Type",placeholder:"product"},{id:"page_id",label:"Page ID",placeholder:"123"},{id:"category",label:"Category Slug",placeholder:"news"},{id:"tag",label:"Tag Slug",placeholder:"featured"},{id:"template",label:"Page Template",placeholder:"template-full-width.php"}],v=[{id:"is",label:"Is"},{id:"is_not",label:"Is Not"},{id:"contains",label:"Contains"},{id:"not_contains",label:"Does Not Contain"}],y=[{id:"administrator",label:"Administrator"},{id:"editor",label:"Editor"},{id:"author",label:"Author"},{id:"contributor",label:"Contributor"},{id:"subscriber",label:"Subscriber"},{id:"customer",label:"Customer (WooCommerce)"},{id:"shop_manager",label:"Shop Manager (WooCommerce)"}],w=[{id:"mon",label:"Mon"},{id:"tue",label:"Tue"},{id:"wed",label:"Wed"},{id:"thu",label:"Thu"},{id:"fri",label:"Fri"},{id:"sat",label:"Sat"},{id:"sun",label:"Sun"}],k=({instance:e,updateField:t})=>{const{t:n}=l(),[c]=(0,a.useState)(!0),s=e.targeting||{},r=e.access||{},i=e.schedule||{},m=e.devices||{desktop:!0,tablet:!0,mobile:!0},d=s.rules||[],h=(e,a,n)=>{const l=d.map(t=>t.id===e?{...t,[a]:n}:t);t("targeting.rules",l)};return(0,a.createElement)("div",{className:"n8n-chat-tab-content"},(0,a.createElement)("div",{className:"n8n-chat-section"},(0,a.createElement)("h2",{className:"n8n-chat-section-title"},n("pageTargeting","Page Targeting"),c&&(0,a.createElement)("span",{className:"n8n-chat-pro-badge"},"PRO")),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:s.enabled||!1,onChange:e=>t("targeting.enabled",e.target.checked)}),(0,a.createElement)("span",null,n("enablePageTargeting","Enable page targeting rules"))),(0,a.createElement)("p",{className:"description"},n("pageTargetingDesc","Show this chat only on specific pages or sections of your site."))),s.enabled&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",null,n("displayMode","Display Mode")),(0,a.createElement)("div",{className:"n8n-chat-radio-group"},(0,a.createElement)("label",{className:"n8n-chat-radio"},(0,a.createElement)("input",{type:"radio",name:"targetingMode",checked:"all"===s.mode,onChange:()=>t("targeting.mode","all")}),(0,a.createElement)("span",{className:"n8n-chat-radio-label"},n("showOnAllPages","Show on all pages (default)"))),(0,a.createElement)("label",{className:"n8n-chat-radio"},(0,a.createElement)("input",{type:"radio",name:"targetingMode",checked:"include"===s.mode,onChange:()=>t("targeting.mode","include")}),(0,a.createElement)("span",{className:"n8n-chat-radio-label"},n("showOnlyMatching","Show only on matching pages"))),(0,a.createElement)("label",{className:"n8n-chat-radio"},(0,a.createElement)("input",{type:"radio",name:"targetingMode",checked:"exclude"===s.mode,onChange:()=>t("targeting.mode","exclude")}),(0,a.createElement)("span",{className:"n8n-chat-radio-label"},n("hideOnMatching","Hide on matching pages"))))),("include"===s.mode||"exclude"===s.mode)&&(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",null,n("targetingRules","Targeting Rules"),(0,a.createElement)(o,{tooltip:n("tooltipUrlPattern","Examples: /products/* (wildcard), /blog (exact), product (contains). Uses simple pattern matching, not regex.")})),(0,a.createElement)("div",{className:"n8n-chat-rules-list"},d.map((e,n)=>(0,a.createElement)("div",{key:e.id,className:"n8n-chat-rule-row"},n>0&&(0,a.createElement)("span",{className:"n8n-chat-rule-connector"},"OR"),(0,a.createElement)("select",{value:e.type,onChange:t=>h(e.id,"type",t.target.value),className:"n8n-chat-rule-type"},N.map(e=>(0,a.createElement)("option",{key:e.id,value:e.id},e.label))),(0,a.createElement)("select",{value:e.operator,onChange:t=>h(e.id,"operator",t.target.value),className:"n8n-chat-rule-operator"},v.map(e=>(0,a.createElement)("option",{key:e.id,value:e.id},e.label))),(0,a.createElement)("input",{type:"text",value:e.value,onChange:t=>h(e.id,"value",t.target.value),placeholder:N.find(t=>t.id===e.type)?.placeholder,className:"n8n-chat-rule-value"}),(0,a.createElement)("button",{type:"button",className:"button-link n8n-chat-remove-btn",onClick:()=>{return a=e.id,void t("targeting.rules",d.filter(e=>e.id!==a));var a},"aria-label":"Remove rule"},(0,a.createElement)("span",{className:"dashicons dashicons-no-alt"})))),(0,a.createElement)("button",{type:"button",className:"button button-secondary",onClick:()=>{const e={id:`rule_${Date.now()}`,type:"url",operator:"contains",value:""};t("targeting.rules",[...d,e])}},(0,a.createElement)("span",{className:"dashicons dashicons-plus-alt2"}),n("addRule","Add Rule")))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-priority"},n("priority","Priority"),(0,a.createElement)(o,{tooltip:n("tooltipPriority","Higher number = higher priority. If a page matches multiple chat instances, the highest priority wins.")})),(0,a.createElement)("input",{type:"number",id:"fc-priority",value:s.priority||0,onChange:e=>t("targeting.priority",parseInt(e.target.value,10)),min:0,max:100,className:"small-text"}),(0,a.createElement)("p",{className:"description"},n("priorityDesc","When multiple chat bots match a page, the one with higher priority wins."))))),(0,a.createElement)("div",{className:"n8n-chat-section"},(0,a.createElement)("h2",{className:"n8n-chat-section-title"},n("userAccess","User Access")),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:r.requireLogin||!1,onChange:e=>t("access.requireLogin",e.target.checked)}),(0,a.createElement)("span",null,n("requireLogin","Require user to be logged in")))),r.requireLogin&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",null,n("restrictToRoles","Restrict to specific roles (leave empty for all logged-in users)")),(0,a.createElement)("div",{className:"n8n-chat-roles-grid"},y.map(e=>(0,a.createElement)("label",{key:e.id,className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:(r.allowedRoles||[]).includes(e.id),onChange:()=>(e=>{const a=r.allowedRoles||[],n=a.includes(e)?a.filter(t=>t!==e):[...a,e];t("access.allowedRoles",n)})(e.id)}),(0,a.createElement)("span",null,e.label))))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-denied-message"},n("accessDeniedMessage","Access Denied Message")),(0,a.createElement)("textarea",{id:"fc-denied-message",value:r.deniedMessage||"",onChange:e=>t("access.deniedMessage",e.target.value),rows:2,className:"large-text",placeholder:n("accessDeniedPlaceholder","Please log in to use this chat.")})))),(0,a.createElement)("div",{className:"n8n-chat-section"},(0,a.createElement)("h2",{className:"n8n-chat-section-title"},n("deviceTargeting","Device Targeting")),(0,a.createElement)("div",{className:"n8n-chat-devices-grid"},(0,a.createElement)("label",{className:"n8n-chat-device-option"},(0,a.createElement)("input",{type:"checkbox",checked:!1!==m.desktop,onChange:e=>t("devices.desktop",e.target.checked)}),(0,a.createElement)("span",{className:"n8n-chat-device-icon"},(0,a.createElement)("span",{className:"dashicons dashicons-desktop"})),(0,a.createElement)("span",{className:"n8n-chat-device-label"},n("desktop","Desktop"))),(0,a.createElement)("label",{className:"n8n-chat-device-option"},(0,a.createElement)("input",{type:"checkbox",checked:!1!==m.tablet,onChange:e=>t("devices.tablet",e.target.checked)}),(0,a.createElement)("span",{className:"n8n-chat-device-icon"},(0,a.createElement)("span",{className:"dashicons dashicons-tablet"})),(0,a.createElement)("span",{className:"n8n-chat-device-label"},n("tablet","Tablet"))),(0,a.createElement)("label",{className:"n8n-chat-device-option"},(0,a.createElement)("input",{type:"checkbox",checked:!1!==m.mobile,onChange:e=>t("devices.mobile",e.target.checked)}),(0,a.createElement)("span",{className:"n8n-chat-device-icon"},(0,a.createElement)("span",{className:"dashicons dashicons-smartphone"})),(0,a.createElement)("span",{className:"n8n-chat-device-label"},n("mobile","Mobile"))))),(0,a.createElement)("div",{className:"n8n-chat-section"},(0,a.createElement)("h2",{className:"n8n-chat-section-title"},n("schedule","Schedule"),c&&(0,a.createElement)("span",{className:"n8n-chat-pro-badge"},"PRO")),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:i.enabled||!1,onChange:e=>t("schedule.enabled",e.target.checked)}),(0,a.createElement)("span",null,n("enableSchedule","Enable scheduled availability"))),(0,a.createElement)("p",{className:"description"},n("scheduleDesc","Only show the chat during specific hours/days."))),i.enabled&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)("div",{className:"n8n-chat-field-row"},(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-schedule-start"},n("startTime","Start Time")),(0,a.createElement)("input",{type:"time",id:"fc-schedule-start",value:i.startTime||"09:00",onChange:e=>t("schedule.startTime",e.target.value)})),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-schedule-end"},n("endTime","End Time")),(0,a.createElement)("input",{type:"time",id:"fc-schedule-end",value:i.endTime||"17:00",onChange:e=>t("schedule.endTime",e.target.value)}))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-schedule-timezone"},n("timezone","Timezone")),(0,a.createElement)("select",{id:"fc-schedule-timezone",value:i.timezone||"site",onChange:e=>t("schedule.timezone",e.target.value),className:"regular-text"},(0,a.createElement)("option",{value:"site"},n("siteTimezone","Site Timezone")),(0,a.createElement)("option",{value:"visitor"},n("visitorTimezone","Visitor's Timezone")),(0,a.createElement)("option",{value:"UTC"},"UTC"))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",null,n("activeDays","Active Days")),(0,a.createElement)("div",{className:"n8n-chat-days-selector"},w.map(e=>(0,a.createElement)("button",{key:e.id,type:"button",className:"n8n-chat-day-btn "+((i.days||[]).includes(e.id)?"is-active":""),onClick:()=>(e=>{const a=i.days||[],n=a.includes(e)?a.filter(t=>t!==e):[...a,e];t("schedule.days",n)})(e.id)},e.label)))),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-outside-hours-msg"},n("outsideHoursMessage","Outside Hours Message")),(0,a.createElement)("textarea",{id:"fc-outside-hours-msg",value:i.outsideHoursMessage||"",onChange:e=>t("schedule.outsideHoursMessage",e.target.value),rows:2,className:"large-text",placeholder:n("outsideHoursPlaceholder","We're currently offline. Leave a message and we'll respond when we're back online.")}),(0,a.createElement)("p",{className:"description"},n("outsideHoursDesc","Message shown when the chat is accessed outside scheduled hours."))))))},C=({instance:e,mode:t})=>{const n=(0,a.useRef)(null),l=(0,a.useRef)(null),[c,s]=(0,a.useState)(0);return(0,a.useEffect)(()=>{s(e=>e+1)},[e.primaryColor,e.appearance?.userBubbleColor,e.appearance?.botBubbleColor,e.appearance?.backgroundColor,e.appearance?.textColor,e.appearance?.headerBackground,e.appearance?.fontFamily,e.appearance?.fontSize,e.appearance?.borderRadius,e.bubble?.enabled,e.bubble?.position,e.bubble?.size,e.bubble?.icon]),(0,a.useEffect)(()=>{if(!n.current)return;l.current||(l.current=n.current.attachShadow({mode:"open"}));const a=l.current,c=e.appearance||{},s=e.bubble||{},r=s.enabled,o=`\n      <style>\n      :host {\n        display: block;\n        width: 100%;\n        height: 100%;\n      }\n\n      * {\n        box-sizing: border-box;\n        margin: 0;\n        padding: 0;\n      }\n\n      .preview-container {\n        width: 100%;\n        height: 100%;\n        background: #e5e5e5;\n        border-radius: 8px;\n        display: flex;\n        align-items: ${r?"flex-end":"center"};\n        justify-content: ${r?"flex-end":"center"};\n        padding: ${r?"24px":"16px"};\n        position: relative;\n        overflow: hidden;\n      }\n\n      .preview-container.is-mobile {\n        max-width: 375px;\n        margin: 0 auto;\n      }\n\n      /* Chat Window */\n      .chat-window {\n        background: ${c.backgroundColor||"#ffffff"};\n        border-radius: ${c.borderRadius||12}px;\n        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        font-family: ${(()=>{switch(c.fontFamily){case"inter":return"'Inter', sans-serif";case"roboto":return"'Roboto', sans-serif";case"open-sans":return"'Open Sans', sans-serif";case"lato":return"'Lato', sans-serif";case"poppins":return"'Poppins', sans-serif";default:return'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'}})()};\n        font-size: ${(()=>{switch(c.fontSize){case"small":return"14px";case"large":return"18px";default:return"16px"}})()};\n        color: ${c.textColor||"#1f2937"};\n        transition: all 0.2s ease;\n      }\n\n      .chat-window.inline-mode {\n        width: 100%;\n        height: 100%;\n        max-width: 400px;\n        max-height: 500px;\n      }\n\n      .chat-window.bubble-mode {\n        width: 350px;\n        height: 450px;\n        max-height: 80%;\n      }\n\n      .chat-window.is-mobile {\n        width: 100%;\n        max-width: 100%;\n        height: 400px;\n      }\n\n      /* Header */\n      .chat-header {\n        background: ${c.headerBackground||e.primaryColor||"#3b82f6"};\n        color: white;\n        padding: 16px;\n        display: flex;\n        align-items: center;\n        gap: 12px;\n      }\n\n      .chat-header-avatar {\n        width: 36px;\n        height: 36px;\n        background: rgba(255, 255, 255, 0.2);\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 18px;\n      }\n\n      .chat-header-avatar img {\n        width: 100%;\n        height: 100%;\n        border-radius: 50%;\n        object-fit: cover;\n      }\n\n      .chat-header-title {\n        font-weight: 600;\n        font-size: 15px;\n      }\n\n      .chat-header-close {\n        margin-left: auto;\n        background: none;\n        border: none;\n        color: white;\n        cursor: pointer;\n        opacity: 0.8;\n        font-size: 20px;\n      }\n\n      /* Messages */\n      .chat-messages {\n        flex: 1;\n        padding: 16px;\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n        overflow-y: auto;\n        background: ${c.backgroundColor||"#ffffff"};\n      }\n\n      .chat-message {\n        max-width: 80%;\n        padding: 10px 14px;\n        border-radius: ${Math.max(8,(c.borderRadius||12)-4)}px;\n        line-height: 1.4;\n      }\n\n      .chat-message.bot {\n        background: ${c.botBubbleColor||"#f3f4f6"};\n        color: ${c.textColor||"#1f2937"};\n        align-self: flex-start;\n        border-bottom-left-radius: 4px;\n      }\n\n      .chat-message.user {\n        background: ${c.userBubbleColor||e.primaryColor||"#3b82f6"};\n        color: white;\n        align-self: flex-end;\n        border-bottom-right-radius: 4px;\n      }\n\n      /* Input */\n      .chat-input {\n        padding: 12px 16px;\n        border-top: 1px solid #e5e7eb;\n        display: flex;\n        gap: 8px;\n        background: ${c.backgroundColor||"#ffffff"};\n      }\n\n      .chat-input input {\n        flex: 1;\n        border: 1px solid #d1d5db;\n        border-radius: ${Math.max(4,(c.borderRadius||12)/2)}px;\n        padding: 10px 14px;\n        font-size: inherit;\n        font-family: inherit;\n        outline: none;\n      }\n\n      .chat-input input:focus {\n        border-color: ${e.primaryColor||"#3b82f6"};\n        box-shadow: 0 0 0 2px ${e.primaryColor||"#3b82f6"}20;\n      }\n\n      .chat-input button {\n        background: ${e.primaryColor||"#3b82f6"};\n        color: white;\n        border: none;\n        border-radius: ${Math.max(4,(c.borderRadius||12)/2)}px;\n        padding: 10px 16px;\n        cursor: pointer;\n        font-weight: 500;\n      }\n\n      /* Bubble Trigger */\n      .bubble-trigger {\n        position: absolute;\n        bottom: 24px;\n        right: 24px;\n        width: ${"small"===s.size?"48px":"large"===s.size?"64px":"56px"};\n        height: ${"small"===s.size?"48px":"large"===s.size?"64px":"56px"};\n        border-radius: 50%;\n        background: ${e.primaryColor||"#3b82f6"};\n        color: white;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        font-size: ${"small"===s.size?"20px":"large"===s.size?"28px":"24px"};\n        animation: ${!1!==s.pulseAnimation?"pulse 2s infinite":"none"};\n      }\n\n      .bubble-trigger.bottom-left {\n        right: auto;\n        left: 24px;\n      }\n\n      .bubble-trigger.top-right {\n        bottom: auto;\n        top: 24px;\n      }\n\n      .bubble-trigger.top-left {\n        bottom: auto;\n        top: 24px;\n        right: auto;\n        left: 24px;\n      }\n\n      @keyframes pulse {\n        0% { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); }\n        50% { box-shadow: 0 4px 20px rgba(0, 0, 0, 0.25); }\n        100% { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); }\n      }\n\n      /* Welcome Screen */\n      .welcome-screen {\n        padding: 24px;\n        text-align: center;\n        flex: 1;\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        gap: 16px;\n      }\n\n      .welcome-title {\n        font-size: 1.25em;\n        font-weight: 600;\n        color: ${c.textColor||"#1f2937"};\n      }\n\n      .welcome-message {\n        color: #6b7280;\n        line-height: 1.5;\n      }\n\n      .welcome-suggestions {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        justify-content: center;\n        margin-top: 8px;\n      }\n\n      .welcome-suggestion {\n        background: ${c.botBubbleColor||"#f3f4f6"};\n        border: 1px solid #e5e7eb;\n        border-radius: 16px;\n        padding: 8px 14px;\n        font-size: 0.875em;\n        cursor: pointer;\n        transition: background 0.15s;\n      }\n\n      .welcome-suggestion:hover {\n        background: #e5e7eb;\n      }\n    </style>\n      <div class="preview-container ${"mobile"===t?"is-mobile":""}">\n        ${r?`\n          <div class="chat-window bubble-mode ${"mobile"===t?"is-mobile":""}">\n            ${!1!==e.showHeader?`\n            <div class="chat-header">\n              <div class="chat-header-avatar">\n                ${e.avatarUrl?`<img src="${e.avatarUrl}" alt="" />`:"ðŸ¤–"}\n              </div>\n              <span class="chat-header-title">${e.chatTitle||"Chat"}</span>\n              <button class="chat-header-close">Ã—</button>\n            </div>\n            `:""}\n            ${!1!==e.messages?.showWelcomeScreen?`\n            <div class="welcome-screen">\n              <div class="welcome-title">${e.chatTitle||"How can we help?"}</div>\n              <div class="welcome-message">${e.welcomeMessage||"Hi! ðŸ‘‹ How can I help you today?"}</div>\n              ${(e.suggestedPrompts||[]).length>0?`\n              <div class="welcome-suggestions">\n                ${(e.suggestedPrompts||[]).filter(e=>e).map(e=>`<button class="welcome-suggestion">${e}</button>`).join("")}\n              </div>\n              `:""}\n            </div>\n            `:`\n            <div class="chat-messages">\n              <div class="chat-message bot">${e.welcomeMessage||"Hi! How can I help you today?"}</div>\n              <div class="chat-message user">I have a question about pricing</div>\n              <div class="chat-message bot">Of course! I'd be happy to help with pricing info.</div>\n            </div>\n            `}\n            <div class="chat-input">\n              <input type="text" placeholder="${e.placeholderText||"Type your message..."}" readonly />\n              <button>Send</button>\n            </div>\n          </div>\n          <div class="bubble-trigger ${s.position||"bottom-right"}">\n            ${(()=>{switch(s.icon){case"robot":return"ðŸ¤–";case"help":return"â“";case"support":return"ðŸŽ§";case"sparkle":return"âœ¨";case"custom":return s.customIconUrl?`<img src="${s.customIconUrl}" alt="" style="width: 60%; height: 60%;" />`:"ðŸ’¬";default:return"ðŸ’¬"}})()}\n          </div>\n        `:`\n          <div class="chat-window inline-mode ${"mobile"===t?"is-mobile":""}">\n            ${!1!==e.showHeader?`\n            <div class="chat-header">\n              <div class="chat-header-avatar">\n                ${e.avatarUrl?`<img src="${e.avatarUrl}" alt="" />`:"ðŸ¤–"}\n              </div>\n              <span class="chat-header-title">${e.chatTitle||"Chat"}</span>\n            </div>\n            `:""}\n            <div class="chat-messages">\n              <div class="chat-message bot">${e.welcomeMessage||"Hi! How can I help you today?"}</div>\n              <div class="chat-message user">I have a question about pricing</div>\n              <div class="chat-message bot">Of course! I'd be happy to help with pricing info.</div>\n            </div>\n            <div class="chat-input">\n              <input type="text" placeholder="${e.placeholderText||"Type your message..."}" readonly />\n              <button>Send</button>\n            </div>\n          </div>\n        `}\n      </div>\n    `;a.innerHTML=o},[e,t,c]),(0,a.createElement)("div",{ref:n,className:"n8n-chat-live-preview","aria-label":"Chat widget preview"})},x=[{id:"general",labelKey:"general",fallback:"General",icon:"âš™ï¸"},{id:"connection",labelKey:"connection",fallback:"Connection",icon:"ðŸ”—"},{id:"display",labelKey:"display",fallback:"Display",icon:"ðŸ“±"},{id:"messages",labelKey:"messages",fallback:"Messages",icon:"ðŸ’¬"},{id:"appearance",labelKey:"appearance",fallback:"Appearance",icon:"ðŸŽ¨"},{id:"rules",labelKey:"rules",fallback:"Rules",icon:"ðŸ“‹"}],S={name:"New Chat",webhookUrl:"",isEnabled:!1,isDefault:!1,theme:"light",colorSource:"custom",primaryColor:"#3b82f6",stylePreset:"",customCss:"",welcomeMessage:"Hi! ðŸ‘‹ How can I help you today?",placeholderText:"Type your message...",chatTitle:"Chat",systemPrompt:"",suggestedPrompts:[],showHeader:!0,showTimestamp:!1,showAvatar:!0,avatarUrl:"",bubble:{enabled:!1,icon:"chat",customIconUrl:"",text:"",position:"bottom-right",offsetX:24,offsetY:24,size:"medium",showUnreadBadge:!0,pulseAnimation:!0},window:{width:400,height:600},autoOpen:{enabled:!1,trigger:"delay",delay:5e3,scrollPercentage:50,idleTime:3e4,conditions:{oncePerSession:!0,oncePerDay:!1,skipIfInteracted:!0,loggedInOnly:!1,guestOnly:!1,excludeMobile:!1}},targeting:{enabled:!1,mode:"all",priority:0,rules:[]},access:{requireLogin:!1,allowedRoles:[],deniedMessage:"Please log in to use this chat."},features:{fileUpload:!1,fileTypes:["image/jpeg","image/png","image/gif","application/pdf"],maxFileSize:10485760,showTypingIndicator:!0,enableHistory:!0,enableFeedback:!1},fallback:{enabled:!0,email:"",message:"Our chat is temporarily unavailable. Please leave a message."},connection:{auth:"none",username:"",password:"",bearerToken:"",enableStreaming:!0,timeout:30,chatInputKey:"chatInput",sessionKey:"sessionId"},messages:{showWelcomeScreen:!0,connectionError:"Sorry, I'm having trouble connecting. Please try again in a moment.",timeoutError:"The request took too long. Please try again.",rateLimitError:"You're sending messages too quickly. Please wait a moment."},appearance:{userBubbleColor:"#3b82f6",botBubbleColor:"#f3f4f6",backgroundColor:"#ffffff",textColor:"#1f2937",headerBackground:"#3b82f6",fontFamily:"system",fontSize:"medium",borderRadius:12},schedule:{enabled:!1,startTime:"09:00",endTime:"17:00",timezone:"site",days:["mon","tue","wed","thu","fri"],outsideHoursMessage:"We're currently offline. Leave a message and we'll respond when we're back online."},devices:{desktop:!0,tablet:!0,mobile:!0}},T=({instanceId:e,onBack:t,onSaved:n})=>{const{t:c}=l(),[r,o]=(0,a.useState)(S),[m,d]=(0,a.useState)("general"),[h,E]=(0,a.useState)(!!e),[b,g]=(0,a.useState)(!1),[N,v]=(0,a.useState)(null),[y,w]=(0,a.useState)(!1),[T,P]=(0,a.useState)("desktop"),I=!!e;(0,a.useEffect)(()=>{e&&F(e)},[e]),(0,a.useEffect)(()=>{const e=e=>{y&&(e.preventDefault(),e.returnValue="")};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[y]);const F=async e=>{E(!0),v(null);try{const t=await fetch(`${window.n8nChatAdmin.apiUrl}/instances/${e}`,{headers:{"X-WP-Nonce":window.n8nChatAdmin.nonce}});if(!t.ok)throw new Error("Failed to fetch instance");const a=await t.json();o({...S,...a})}catch(e){v(e instanceof Error?e.message:"An error occurred")}finally{E(!1)}},U=(0,a.useCallback)((e,t)=>{o(a=>{const n=JSON.parse(JSON.stringify(a)),l=e.split(".");let c=n;for(let e=0;e<l.length-1;e++)void 0===c[l[e]]&&(c[l[e]]={}),c=c[l[e]];return c[l[l.length-1]]=t,n}),w(!0)},[]),A=async(t=!1)=>{g(!0),v(null);try{const a={...r};t&&(a.isEnabled=!0);const l=I?`${window.n8nChatAdmin.apiUrl}/instances/${e}`:`${window.n8nChatAdmin.apiUrl}/instances`,c=await fetch(l,{method:I?"PUT":"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.n8nChatAdmin.nonce},body:JSON.stringify(a)});if(!c.ok){const e=await c.json();throw new Error(e.message||"Failed to save")}w(!1),n()}catch(e){v(e instanceof Error?e.message:"Failed to save")}finally{g(!1)}},$=()=>{y?confirm("You have unsaved changes. Are you sure you want to leave?")&&t():t()};return h?(0,a.createElement)("div",{className:"n8n-chat-instance-editor"},(0,a.createElement)("div",{className:"n8n-chat-loading"},(0,a.createElement)("div",{className:"n8n-chat-loading-spinner"}),(0,a.createElement)("p",null,"Loading instance..."))):(0,a.createElement)("div",{className:"n8n-chat-instance-editor"},(0,a.createElement)("div",{className:"n8n-chat-editor-header"},(0,a.createElement)("button",{className:"button n8n-chat-back-button",onClick:$},(0,a.createElement)("span",{className:"dashicons dashicons-arrow-left-alt"}),c("back","Back")),(0,a.createElement)("div",{className:"n8n-chat-editor-title"},(0,a.createElement)("h1",null,I?`Edit: ${r.name}`:"Create New Chat Bot"),y&&(0,a.createElement)("span",{className:"n8n-chat-unsaved-badge"},"Unsaved changes"))),N&&(0,a.createElement)("div",{className:"notice notice-error is-dismissible"},(0,a.createElement)("p",null,N),(0,a.createElement)("button",{type:"button",className:"notice-dismiss",onClick:()=>v(null)},(0,a.createElement)("span",{className:"screen-reader-text"},"Dismiss"))),(0,a.createElement)("div",{className:"n8n-chat-editor-layout"},(0,a.createElement)("div",{className:"n8n-chat-editor-form"},(0,a.createElement)("div",{className:"n8n-chat-editor-tabs",role:"tablist"},x.map(e=>(0,a.createElement)("button",{key:e.id,role:"tab","aria-selected":m===e.id,"aria-controls":`panel-${e.id}`,className:"n8n-chat-editor-tab "+(m===e.id?"is-active":""),onClick:()=>d(e.id)},(0,a.createElement)("span",{className:"n8n-chat-tab-icon"},e.icon),(0,a.createElement)("span",{className:"n8n-chat-tab-label"},c(e.labelKey,e.fallback))))),(0,a.createElement)("div",{className:"n8n-chat-editor-panel",role:"tabpanel",id:`panel-${m}`,"aria-labelledby":m},(()=>{const t={instance:r,updateField:U};switch(m){case"general":return(0,a.createElement)(s,{...t,instanceId:e});case"connection":return(0,a.createElement)(i,{...t});case"display":return(0,a.createElement)(u,{...t});case"messages":return(0,a.createElement)(p,{...t});case"appearance":return(0,a.createElement)(f,{...t});case"rules":return(0,a.createElement)(k,{...t});default:return null}})())),(0,a.createElement)("div",{className:"n8n-chat-editor-preview"},(0,a.createElement)("div",{className:"n8n-chat-preview-header"},(0,a.createElement)("h3",null,"Live Preview"),(0,a.createElement)("div",{className:"n8n-chat-preview-toggle"},(0,a.createElement)("button",{className:"n8n-chat-preview-btn "+("desktop"===T?"is-active":""),onClick:()=>P("desktop"),title:"Desktop preview"},(0,a.createElement)("span",{className:"dashicons dashicons-desktop"})),(0,a.createElement)("button",{className:"n8n-chat-preview-btn "+("mobile"===T?"is-active":""),onClick:()=>P("mobile"),title:"Mobile preview"},(0,a.createElement)("span",{className:"dashicons dashicons-smartphone"})))),(0,a.createElement)(C,{instance:r,mode:T}))),(0,a.createElement)("div",{className:"n8n-chat-editor-footer"},(0,a.createElement)("div",{className:"n8n-chat-footer-left"},e&&(0,a.createElement)("code",{className:"n8n-chat-shortcode-display"},'[n8n-chat id="',e,'"]')),(0,a.createElement)("div",{className:"n8n-chat-footer-right"},(0,a.createElement)("button",{className:"button",onClick:$,disabled:b},c("cancel","Cancel")),(0,a.createElement)("button",{className:"button",onClick:()=>A(!1),disabled:b},b?c("loading","Saving..."):c("save","Save Draft")),(0,a.createElement)("button",{className:"button button-primary",onClick:()=>A(!0),disabled:b},b?c("loading","Saving..."):c("save","Save & Activate")))))},P=({onNavigate:e})=>{const{t}=l(),[n,c]=(0,a.useState)([]),[s,r]=(0,a.useState)({totalBots:0,activeBots:0,totalChats:0,todayChats:0}),[o,i]=(0,a.useState)(!0),[m,d]=(0,a.useState)(null);(0,a.useEffect)(()=>{h()},[]);const h=async()=>{i(!0),d(null);try{const e=await fetch(`${window.n8nChatAdmin.apiUrl}/instances`,{headers:{"X-WP-Nonce":window.n8nChatAdmin.nonce}});if(!e.ok)throw new Error("Failed to fetch instances");const t=await e.json();c(t);const a=t.length,n=t.filter(e=>e.isEnabled).length;let l=0,s=0;try{const e=await fetch(`${window.n8nChatAdmin.apiUrl}/sessions?per_page=1`,{headers:{"X-WP-Nonce":window.n8nChatAdmin.nonce}});if(e.ok){const t=e.headers.get("X-WP-Total");l=t?parseInt(t,10):0}}catch{}r({totalBots:a,activeBots:n,totalChats:l,todayChats:s})}catch(e){d(e instanceof Error?e.message:"An error occurred")}finally{i(!1)}};return o?(0,a.createElement)("div",{className:"n8n-chat-dashboard"},(0,a.createElement)("div",{className:"n8n-chat-loading"},(0,a.createElement)("div",{className:"n8n-chat-loading-spinner"}),(0,a.createElement)("p",null,t("loadingDashboard","Loading dashboard...")))):(0,a.createElement)("div",{className:"n8n-chat-dashboard"},(0,a.createElement)("div",{className:"n8n-chat-welcome-banner"},(0,a.createElement)("div",{className:"n8n-chat-welcome-content"},(0,a.createElement)("h1",null,t("welcomeToN8nChat","Welcome to n8n Chat")),(0,a.createElement)("p",null,"Connect your WordPress site to n8n AI workflows with beautiful, customizable chat widgets.")),(0,a.createElement)("div",{className:"n8n-chat-welcome-actions"},(0,a.createElement)("button",{className:"button button-primary button-hero",onClick:()=>e("instances",{action:"new"})},(0,a.createElement)("span",{className:"dashicons dashicons-plus-alt2"}),t("createFirstInstance","Create Your First Chat Bot")),(0,a.createElement)("a",{href:"https://docs.n8n-chat.dev/getting-started",target:"_blank",rel:"noopener noreferrer",className:"button button-hero"},(0,a.createElement)("span",{className:"dashicons dashicons-book"}),"View Documentation"))),m&&(0,a.createElement)("div",{className:"notice notice-error"},(0,a.createElement)("p",null,m)),(0,a.createElement)("div",{className:"n8n-chat-stats-grid"},(0,a.createElement)("div",{className:"n8n-chat-stat-card"},(0,a.createElement)("div",{className:"n8n-chat-stat-icon"},(0,a.createElement)("span",{className:"dashicons dashicons-format-chat"})),(0,a.createElement)("div",{className:"n8n-chat-stat-content"},(0,a.createElement)("span",{className:"n8n-chat-stat-value"},s.totalBots),(0,a.createElement)("span",{className:"n8n-chat-stat-label"},t("totalChatBots","Total Chat Bots")))),(0,a.createElement)("div",{className:"n8n-chat-stat-card"},(0,a.createElement)("div",{className:"n8n-chat-stat-icon n8n-chat-stat-icon-success"},(0,a.createElement)("span",{className:"dashicons dashicons-yes-alt"})),(0,a.createElement)("div",{className:"n8n-chat-stat-content"},(0,a.createElement)("span",{className:"n8n-chat-stat-value"},s.activeBots),(0,a.createElement)("span",{className:"n8n-chat-stat-label"},t("activeBots","Active Bots")))),(0,a.createElement)("div",{className:"n8n-chat-stat-card"},(0,a.createElement)("div",{className:"n8n-chat-stat-icon n8n-chat-stat-icon-info"},(0,a.createElement)("span",{className:"dashicons dashicons-admin-comments"})),(0,a.createElement)("div",{className:"n8n-chat-stat-content"},(0,a.createElement)("span",{className:"n8n-chat-stat-value"},s.totalChats),(0,a.createElement)("span",{className:"n8n-chat-stat-label"},t("totalConversations","Total Conversations")))),(0,a.createElement)("div",{className:"n8n-chat-stat-card"},(0,a.createElement)("div",{className:"n8n-chat-stat-icon n8n-chat-stat-icon-warning"},(0,a.createElement)("span",{className:"dashicons dashicons-clock"})),(0,a.createElement)("div",{className:"n8n-chat-stat-content"},(0,a.createElement)("span",{className:"n8n-chat-stat-value"},s.todayChats),(0,a.createElement)("span",{className:"n8n-chat-stat-label"},t("todaysChats","Today's Chats"))))),(0,a.createElement)("div",{className:"n8n-chat-quick-actions"},(0,a.createElement)("h2",null,t("quickActions","Quick Actions")),(0,a.createElement)("div",{className:"n8n-chat-quick-actions-grid"},(0,a.createElement)("button",{className:"n8n-chat-quick-action",onClick:()=>e("instances",{action:"new"})},(0,a.createElement)("span",{className:"dashicons dashicons-plus-alt2"}),(0,a.createElement)("span",null,t("newInstance","New Chat Bot"))),(0,a.createElement)("button",{className:"n8n-chat-quick-action",onClick:()=>e("templates")},(0,a.createElement)("span",{className:"dashicons dashicons-layout"}),(0,a.createElement)("span",null,"Browse Templates")),(0,a.createElement)("button",{className:"n8n-chat-quick-action",onClick:()=>e("settings")},(0,a.createElement)("span",{className:"dashicons dashicons-admin-generic"}),(0,a.createElement)("span",null,"Settings")),(0,a.createElement)("button",{className:"n8n-chat-quick-action",onClick:()=>e("tools")},(0,a.createElement)("span",{className:"dashicons dashicons-admin-tools"}),(0,a.createElement)("span",null,"Import / Export")))),(0,a.createElement)("div",{className:"n8n-chat-dashboard-bots"},(0,a.createElement)("div",{className:"n8n-chat-section-header"},(0,a.createElement)("h2",null,t("chatBots","Your Chat Bots")),(0,a.createElement)("button",{className:"button",onClick:()=>e("instances")},t("viewAll","View All"))),0===n.length?(0,a.createElement)("div",{className:"n8n-chat-empty-state"},(0,a.createElement)("span",{className:"dashicons dashicons-format-chat"}),(0,a.createElement)("h3",null,t("noChatBotsYet","No chat bots yet")),(0,a.createElement)("p",null,t("createYourFirstBot","Create your first chat bot to get started.")),(0,a.createElement)("button",{className:"button button-primary",onClick:()=>e("instances",{action:"new"})},t("create","Create Chat Bot"))):(0,a.createElement)("div",{className:"n8n-chat-bots-grid"},n.slice(0,6).map(n=>{const l=(e=>e.isEnabled?{label:t("active","Active"),className:"status-active"}:{label:t("inactive","Inactive"),className:"status-inactive"})(n);return(0,a.createElement)("div",{key:n.id,className:"n8n-chat-bot-card"},(0,a.createElement)("div",{className:"n8n-chat-bot-card-header"},(0,a.createElement)("div",{className:"n8n-chat-bot-avatar",style:{backgroundColor:n.primaryColor||"#3b82f6"}},n.avatarUrl?(0,a.createElement)("img",{src:n.avatarUrl,alt:""}):(0,a.createElement)("span",{className:"dashicons dashicons-format-chat"})),(0,a.createElement)("div",{className:"n8n-chat-bot-info"},(0,a.createElement)("h3",null,n.name),(0,a.createElement)("span",{className:`n8n-chat-bot-status ${l.className}`},l.label)),(0,a.createElement)("label",{className:"n8n-chat-toggle"},(0,a.createElement)("input",{type:"checkbox",checked:n.isEnabled,onChange:()=>(async e=>{try{(await fetch(`${window.n8nChatAdmin.apiUrl}/instances/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-WP-Nonce":window.n8nChatAdmin.nonce},body:JSON.stringify({...e,isEnabled:!e.isEnabled})})).ok&&h()}catch(e){console.error("Failed to toggle instance:",e)}})(n)}),(0,a.createElement)("span",{className:"n8n-chat-toggle-slider"}))),(0,a.createElement)("div",{className:"n8n-chat-bot-card-meta"},(0,a.createElement)("span",{className:"n8n-chat-bot-meta-item"},(0,a.createElement)("span",{className:"dashicons dashicons-visibility"}),(e=>e.bubble?.enabled?t("bubble","Bubble"):t("inline","Inline"))(n)),n.targeting?.enabled&&(0,a.createElement)("span",{className:"n8n-chat-bot-meta-item"},(0,a.createElement)("span",{className:"dashicons dashicons-filter"}),"Targeted")),(0,a.createElement)("div",{className:"n8n-chat-bot-card-shortcode"},(0,a.createElement)("code",null,'[n8n-chat id="',n.id,'"]')),(0,a.createElement)("div",{className:"n8n-chat-bot-card-actions"},(0,a.createElement)("button",{className:"button",onClick:()=>e("instances",{edit:n.id})},(0,a.createElement)("span",{className:"dashicons dashicons-edit"}),t("edit","Edit")),(0,a.createElement)("button",{className:"button",onClick:()=>{navigator.clipboard.writeText(`[n8n-chat id="${n.id}"]`)}},(0,a.createElement)("span",{className:"dashicons dashicons-clipboard"}),t("copy","Copy")," ",t("shortcode","Shortcode"))))}))),0===n.length&&(0,a.createElement)("div",{className:"n8n-chat-getting-started"},(0,a.createElement)("h2",null,t("gettingStarted","Getting Started")),(0,a.createElement)("div",{className:"n8n-chat-steps"},(0,a.createElement)("div",{className:"n8n-chat-step"},(0,a.createElement)("div",{className:"n8n-chat-step-number"},"1"),(0,a.createElement)("div",{className:"n8n-chat-step-content"},(0,a.createElement)("h3",null,"Create a Chat Bot"),(0,a.createElement)("p",null,'Set up your first chat bot by clicking "Create Your First Chat Bot" above or navigating to Chat Bots â†’ Add New.'))),(0,a.createElement)("div",{className:"n8n-chat-step"},(0,a.createElement)("div",{className:"n8n-chat-step-number"},"2"),(0,a.createElement)("div",{className:"n8n-chat-step-content"},(0,a.createElement)("h3",null,"Configure n8n Webhook"),(0,a.createElement)("p",null,"Enter your n8n webhook URL. Create a workflow in n8n with a Chat Trigger node to handle conversations."))),(0,a.createElement)("div",{className:"n8n-chat-step"},(0,a.createElement)("div",{className:"n8n-chat-step-number"},"3"),(0,a.createElement)("div",{className:"n8n-chat-step-content"},(0,a.createElement)("h3",null,"Add to Your Site"),(0,a.createElement)("p",null,"Use the shortcode ",(0,a.createElement)("code",null,"[n8n-chat]")," in any page or post, or enable bubble mode for site-wide display."))))))},I=[{id:"all",label:"All Templates",icon:"ðŸ“‹"},{id:"customer_support",label:"Customer Support",icon:"ðŸŽ§"},{id:"sales",label:"Sales",icon:"ðŸ’°"},{id:"lead_generation",label:"Lead Generation",icon:"ðŸ“Š"},{id:"faq",label:"FAQ & Knowledge",icon:"â“"},{id:"ecommerce",label:"E-commerce",icon:"ðŸ›’"},{id:"custom",label:"My Templates",icon:"â­"}],F={customer_support:"ðŸŽ§",sales:"ðŸ’°",lead_generation:"ðŸ“Š",faq:"â“",ecommerce:"ðŸ›’",technical_support:"ðŸ”§",hr_assistant:"ðŸ‘¥",booking:"ðŸ“…",feedback:"ðŸ“",onboarding:"ðŸš€",custom:"â­"},U=({onNavigate:e})=>{const[t,n]=(0,a.useState)([]),[l,c]=(0,a.useState)(!0),[s,r]=(0,a.useState)(null),[o,i]=(0,a.useState)("all"),[m,d]=(0,a.useState)(""),[h,u]=(0,a.useState)(null);(0,a.useEffect)(()=>{p()},[]);const p=async()=>{c(!0),r(null);try{const e=await fetch(`${window.n8nChatAdmin.publicApiUrl}/templates`,{headers:{"X-WP-Nonce":window.n8nChatAdmin.nonce}});if(!e.ok)throw new Error("Failed to fetch templates");const t=await e.json();if(!t.success||!Array.isArray(t.templates))throw new Error("Invalid response format");{const e=t.templates.map(e=>({id:e.id,name:e.name,description:e.description||"",category:e.category||"custom",thumbnail:e.thumbnail,config:e.config||{},tags:e.tags||[],isBuiltIn:!e.custom}));n(e)}}catch(e){r(e instanceof Error?e.message:"An error occurred")}finally{c(!1)}},E=async t=>{try{const a=await fetch(`${window.n8nChatAdmin.apiUrl}/instances`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.n8nChatAdmin.nonce},body:JSON.stringify({...t.config,name:`${t.name} (Copy)`,isEnabled:!1})});if(!a.ok)throw new Error("Failed to create instance from template");const n=await a.json();e("instances",{edit:n.id})}catch(e){alert(e instanceof Error?e.message:"Failed to use template")}},b=t.filter(e=>{const t="all"===o||e.category===o||"custom"===o&&!e.isBuiltIn,a=!m||e.name.toLowerCase().includes(m.toLowerCase())||e.description.toLowerCase().includes(m.toLowerCase())||e.tags.some(e=>e.toLowerCase().includes(m.toLowerCase()));return t&&a});return l?(0,a.createElement)("div",{className:"n8n-chat-templates"},(0,a.createElement)("div",{className:"n8n-chat-loading"},(0,a.createElement)("div",{className:"n8n-chat-loading-spinner"}),(0,a.createElement)("p",null,"Loading templates..."))):(0,a.createElement)("div",{className:"n8n-chat-templates"},(0,a.createElement)("div",{className:"n8n-chat-page-header"},(0,a.createElement)("div",{className:"n8n-chat-page-header-content"},(0,a.createElement)("h1",null,"Template Gallery"),(0,a.createElement)("p",null,"Choose a pre-built template to quickly create a new chat bot. Customize it after to match your needs."))),s&&(0,a.createElement)("div",{className:"notice notice-error"},(0,a.createElement)("p",null,s)),(0,a.createElement)("div",{className:"n8n-chat-templates-filters"},(0,a.createElement)("div",{className:"n8n-chat-templates-search"},(0,a.createElement)("span",{className:"dashicons dashicons-search"}),(0,a.createElement)("input",{type:"text",placeholder:"Search templates...",value:m,onChange:e=>d(e.target.value)})),(0,a.createElement)("div",{className:"n8n-chat-templates-categories"},I.map(e=>(0,a.createElement)("button",{key:e.id,className:"n8n-chat-category-btn "+(o===e.id?"is-active":""),onClick:()=>i(e.id)},e.label)))),0===b.length?(0,a.createElement)("div",{className:"n8n-chat-empty-state"},(0,a.createElement)("span",{className:"dashicons dashicons-layout"}),(0,a.createElement)("h3",null,"No templates found"),(0,a.createElement)("p",null,m?"Try a different search term.":"No templates in this category.")):(0,a.createElement)("div",{className:"n8n-chat-templates-grid"},b.map(e=>(0,a.createElement)("div",{key:e.id,className:"n8n-chat-template-card"},(0,a.createElement)("div",{className:"n8n-chat-template-preview"},e.thumbnail?(0,a.createElement)("img",{src:e.thumbnail,alt:e.name}):(0,a.createElement)("div",{className:"n8n-chat-template-preview-placeholder"},(0,a.createElement)("span",{className:"n8n-chat-template-icon"},F[e.category]||"ðŸ’¬")),!e.isBuiltIn&&(0,a.createElement)("span",{className:"n8n-chat-template-badge"},"Custom")),(0,a.createElement)("div",{className:"n8n-chat-template-info"},(0,a.createElement)("h3",null,e.name),(0,a.createElement)("p",null,e.description),e.tags.length>0&&(0,a.createElement)("div",{className:"n8n-chat-template-tags"},e.tags.slice(0,3).map(e=>(0,a.createElement)("span",{key:e,className:"n8n-chat-template-tag"},e)))),(0,a.createElement)("div",{className:"n8n-chat-template-actions"},(0,a.createElement)("button",{className:"button",onClick:()=>u(e)},(0,a.createElement)("span",{className:"dashicons dashicons-visibility"}),"Preview"),(0,a.createElement)("button",{className:"button button-primary",onClick:()=>E(e)},(0,a.createElement)("span",{className:"dashicons dashicons-plus-alt2"}),"Use Template"))))),h&&(0,a.createElement)("div",{className:"n8n-chat-modal-overlay",onClick:()=>u(null)},(0,a.createElement)("div",{className:"n8n-chat-modal n8n-chat-template-preview-modal",onClick:e=>e.stopPropagation()},(0,a.createElement)("div",{className:"n8n-chat-modal-header"},(0,a.createElement)("h2",null,h.name),(0,a.createElement)("button",{className:"n8n-chat-modal-close",onClick:()=>u(null)},(0,a.createElement)("span",{className:"dashicons dashicons-no-alt"}))),(0,a.createElement)("div",{className:"n8n-chat-modal-body"},(0,a.createElement)("div",{className:"n8n-chat-template-detail"},(0,a.createElement)("div",{className:"n8n-chat-template-detail-preview"},h.thumbnail?(0,a.createElement)("img",{src:h.thumbnail,alt:""}):(0,a.createElement)("div",{className:"n8n-chat-template-preview-placeholder large"},(0,a.createElement)("span",{className:"n8n-chat-template-icon"},F[h.category]||"ðŸ’¬"))),(0,a.createElement)("div",{className:"n8n-chat-template-detail-info"},(0,a.createElement)("p",{className:"n8n-chat-template-detail-description"},h.description),(0,a.createElement)("div",{className:"n8n-chat-template-detail-meta"},(0,a.createElement)("div",{className:"n8n-chat-template-meta-item"},(0,a.createElement)("strong",null,"Category:"),(0,a.createElement)("span",null,I.find(e=>e.id===h.category)?.label||h.category)),(0,a.createElement)("div",{className:"n8n-chat-template-meta-item"},(0,a.createElement)("strong",null,"Type:"),(0,a.createElement)("span",null,h.isBuiltIn?"Built-in":"Custom"))),h.tags.length>0&&(0,a.createElement)("div",{className:"n8n-chat-template-detail-tags"},(0,a.createElement)("strong",null,"Tags:"),(0,a.createElement)("div",{className:"n8n-chat-template-tags"},h.tags.map(e=>(0,a.createElement)("span",{key:e,className:"n8n-chat-template-tag"},e)))),(0,a.createElement)("h4",null,"Includes:"),(0,a.createElement)("ul",{className:"n8n-chat-template-features"},(0,a.createElement)("li",null,(0,a.createElement)("span",{className:"dashicons dashicons-yes"}),"Pre-configured welcome message"),(0,a.createElement)("li",null,(0,a.createElement)("span",{className:"dashicons dashicons-yes"}),"Suggested prompts for common questions"),(0,a.createElement)("li",null,(0,a.createElement)("span",{className:"dashicons dashicons-yes"}),"Optimized styling and colors"),(0,a.createElement)("li",null,(0,a.createElement)("span",{className:"dashicons dashicons-yes"}),"System prompt template"))))),(0,a.createElement)("div",{className:"n8n-chat-modal-footer"},(0,a.createElement)("button",{className:"button",onClick:()=>u(null)},"Cancel"),(0,a.createElement)("button",{className:"button button-primary",onClick:()=>{E(h),u(null)}},(0,a.createElement)("span",{className:"dashicons dashicons-plus-alt2"}),"Use This Template")))))},A=[{id:"general",label:"General",icon:"admin-generic"},{id:"performance",label:"Performance",icon:"performance"},{id:"privacy",label:"Privacy",icon:"shield"},{id:"advanced",label:"Advanced",icon:"admin-tools"}],$={n8nBaseUrl:"",defaultTimeout:30,enableLogging:!1,includeUserName:!0,includeUserEmail:!1,includeUserRole:!0,includePageTitle:!0,includePageUrl:!0,includeSiteName:!0,includeDateTime:!0,lazyLoadWidget:!0,preconnectWebhook:!0,cacheResponses:!1,cacheDuration:300,historyStorage:"session",historyRetention:30,anonymizeData:!1,respectDnt:!0,cookieConsent:!1,debugMode:!1,customHeaders:"",webhookRetries:3,retryDelay:1e3,enableFallback:!0,fallbackEmail:"",deleteDataOnUninstall:!1},D=()=>{const[e,t]=(0,a.useState)($),[n,l]=(0,a.useState)("general"),[c,s]=(0,a.useState)(!0),[r,o]=(0,a.useState)(!1),[i,m]=(0,a.useState)(!1),[d,h]=(0,a.useState)(null);(0,a.useEffect)(()=>{u()},[]);const u=async()=>{s(!0),h(null);try{const e=await fetch(`${window.n8nChatAdmin.apiUrl}/settings`,{headers:{"X-WP-Nonce":window.n8nChatAdmin.nonce}});if(!e.ok)throw new Error("Failed to fetch settings");const a=await e.json();t({...$,...a})}catch(e){h(e instanceof Error?e.message:"An error occurred")}finally{s(!1)}},p=(e,a)=>{t(t=>({...t,[e]:a}))};return c?(0,a.createElement)("div",{className:"n8n-chat-settings"},(0,a.createElement)("div",{className:"n8n-chat-loading"},(0,a.createElement)("div",{className:"n8n-chat-loading-spinner"}),(0,a.createElement)("p",null,"Loading settings..."))):(0,a.createElement)("div",{className:"n8n-chat-settings"},(0,a.createElement)("div",{className:"n8n-chat-page-header"},(0,a.createElement)("h1",null,"Settings"),(0,a.createElement)("p",null,"Configure global n8n Chat settings.")),d&&(0,a.createElement)("div",{className:"notice notice-error"},(0,a.createElement)("p",null,d)),i&&(0,a.createElement)("div",{className:"notice notice-success is-dismissible"},(0,a.createElement)("p",null,"Settings saved successfully!")),(0,a.createElement)("div",{className:"n8n-chat-settings-layout"},(0,a.createElement)("div",{className:"n8n-chat-settings-tabs"},A.map(e=>(0,a.createElement)("button",{key:e.id,className:"n8n-chat-settings-tab "+(n===e.id?"is-active":""),onClick:()=>l(e.id)},(0,a.createElement)("span",{className:`dashicons dashicons-${e.icon}`}),(0,a.createElement)("span",null,e.label)))),(0,a.createElement)("div",{className:"n8n-chat-settings-content"},(()=>{switch(n){case"general":return(0,a.createElement)("div",{className:"n8n-chat-settings-section"},(0,a.createElement)("h2",null,"n8n Configuration"),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-n8n-base-url"},"n8n Base URL (Optional)"),(0,a.createElement)("input",{type:"url",id:"fc-n8n-base-url",value:e.n8nBaseUrl,onChange:e=>p("n8nBaseUrl",e.target.value),className:"large-text",placeholder:"https://your-n8n-instance.com"}),(0,a.createElement)("p",{className:"description"},"If all your webhooks share the same base URL, set it here. Instance webhook URLs can be relative paths.")),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-default-timeout"},"Default Timeout (seconds)"),(0,a.createElement)("input",{type:"number",id:"fc-default-timeout",value:e.defaultTimeout,onChange:e=>p("defaultTimeout",parseInt(e.target.value,10)),min:5,max:120,className:"small-text"}),(0,a.createElement)("p",{className:"description"},"Default timeout for webhook requests. Can be overridden per instance.")),(0,a.createElement)("h2",null,"Context Data (Sent to n8n)"),(0,a.createElement)("p",{className:"n8n-chat-settings-description"},"Choose what information is automatically included with each chat message."),(0,a.createElement)("div",{className:"n8n-chat-checkbox-grid"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:e.includeSiteName,onChange:e=>p("includeSiteName",e.target.checked)}),(0,a.createElement)("span",null,"Site Name")),(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:e.includePageTitle,onChange:e=>p("includePageTitle",e.target.checked)}),(0,a.createElement)("span",null,"Page Title")),(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:e.includePageUrl,onChange:e=>p("includePageUrl",e.target.checked)}),(0,a.createElement)("span",null,"Page URL")),(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:e.includeDateTime,onChange:e=>p("includeDateTime",e.target.checked)}),(0,a.createElement)("span",null,"Date/Time")),(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:e.includeUserName,onChange:e=>p("includeUserName",e.target.checked)}),(0,a.createElement)("span",null,"User Name (if logged in)")),(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:e.includeUserEmail,onChange:e=>p("includeUserEmail",e.target.checked)}),(0,a.createElement)("span",null,"User Email (if logged in)")),(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:e.includeUserRole,onChange:e=>p("includeUserRole",e.target.checked)}),(0,a.createElement)("span",null,"User Role (if logged in)"))),(0,a.createElement)("h2",null,"Logging"),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:e.enableLogging,onChange:e=>p("enableLogging",e.target.checked)}),(0,a.createElement)("span",null,"Enable activity logging")),(0,a.createElement)("p",{className:"description"},"Log chat events and errors to WordPress debug.log file.")));case"performance":return(0,a.createElement)("div",{className:"n8n-chat-settings-section"},(0,a.createElement)("h2",null,"Widget Loading"),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:e.lazyLoadWidget,onChange:e=>p("lazyLoadWidget",e.target.checked)}),(0,a.createElement)("span",null,"Lazy load chat widget")),(0,a.createElement)("p",{className:"description"},"Only load the chat widget when the user scrolls near it or clicks the bubble.")),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:e.preconnectWebhook,onChange:e=>p("preconnectWebhook",e.target.checked)}),(0,a.createElement)("span",null,"Preconnect to webhook URL")),(0,a.createElement)("p",{className:"description"},"Add preconnect hint to speed up the first webhook request.")),(0,a.createElement)("h2",null,"Response Caching"),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:e.cacheResponses,onChange:e=>p("cacheResponses",e.target.checked)}),(0,a.createElement)("span",null,"Cache identical responses")),(0,a.createElement)("p",{className:"description"},"Cache responses for identical messages to reduce API calls. Only enable for FAQ-style bots.")),e.cacheResponses&&(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-cache-duration"},"Cache Duration (seconds)"),(0,a.createElement)("input",{type:"number",id:"fc-cache-duration",value:e.cacheDuration,onChange:e=>p("cacheDuration",parseInt(e.target.value,10)),min:60,max:86400,className:"small-text"})));case"privacy":return(0,a.createElement)("div",{className:"n8n-chat-settings-section"},(0,a.createElement)("h2",null,"Chat History Storage"),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",null,"Where to store chat history"),(0,a.createElement)("div",{className:"n8n-chat-radio-group n8n-chat-radio-group-vertical"},(0,a.createElement)("label",{className:"n8n-chat-radio"},(0,a.createElement)("input",{type:"radio",name:"historyStorage",checked:"none"===e.historyStorage,onChange:()=>p("historyStorage","none")}),(0,a.createElement)("div",{className:"n8n-chat-radio-content"},(0,a.createElement)("span",{className:"n8n-chat-radio-label"},"None"),(0,a.createElement)("span",{className:"n8n-chat-radio-desc"},"No history saved. Chat resets on each visit."))),(0,a.createElement)("label",{className:"n8n-chat-radio"},(0,a.createElement)("input",{type:"radio",name:"historyStorage",checked:"session"===e.historyStorage,onChange:()=>p("historyStorage","session")}),(0,a.createElement)("div",{className:"n8n-chat-radio-content"},(0,a.createElement)("span",{className:"n8n-chat-radio-label"},"Session Storage"),(0,a.createElement)("span",{className:"n8n-chat-radio-desc"},"History kept until browser tab closes."))),(0,a.createElement)("label",{className:"n8n-chat-radio"},(0,a.createElement)("input",{type:"radio",name:"historyStorage",checked:"local"===e.historyStorage,onChange:()=>p("historyStorage","local")}),(0,a.createElement)("div",{className:"n8n-chat-radio-content"},(0,a.createElement)("span",{className:"n8n-chat-radio-label"},"Local Storage"),(0,a.createElement)("span",{className:"n8n-chat-radio-desc"},"History persists across visits (browser only)."))),(0,a.createElement)("label",{className:"n8n-chat-radio"},(0,a.createElement)("input",{type:"radio",name:"historyStorage",checked:"database"===e.historyStorage,onChange:()=>p("historyStorage","database")}),(0,a.createElement)("div",{className:"n8n-chat-radio-content"},(0,a.createElement)("span",{className:"n8n-chat-radio-label"},"Database"),(0,a.createElement)("span",{className:"n8n-chat-radio-desc"},"History saved server-side. Enables analytics and export."))))),"database"===e.historyStorage&&(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-retention"},"Data Retention (days)"),(0,a.createElement)("input",{type:"number",id:"fc-retention",value:e.historyRetention,onChange:e=>p("historyRetention",parseInt(e.target.value,10)),min:1,max:365,className:"small-text"}),(0,a.createElement)("p",{className:"description"},"Automatically delete chat history older than this many days.")),(0,a.createElement)("h2",null,"Privacy Options"),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:e.anonymizeData,onChange:e=>p("anonymizeData",e.target.checked)}),(0,a.createElement)("span",null,"Anonymize user data in stored history")),(0,a.createElement)("p",{className:"description"},"Remove personally identifiable information when storing chat history.")),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:e.respectDnt,onChange:e=>p("respectDnt",e.target.checked)}),(0,a.createElement)("span",null,"Respect Do Not Track browser setting")),(0,a.createElement)("p",{className:"description"},"Disable history storage for users with DNT enabled.")),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:e.cookieConsent,onChange:e=>p("cookieConsent",e.target.checked)}),(0,a.createElement)("span",null,"Require cookie consent before storing data")),(0,a.createElement)("p",{className:"description"},"Integrates with popular cookie consent plugins.")));case"advanced":return(0,a.createElement)("div",{className:"n8n-chat-settings-section"},(0,a.createElement)("h2",null,"Debug Mode"),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:e.debugMode,onChange:e=>p("debugMode",e.target.checked)}),(0,a.createElement)("span",null,"Enable debug mode")),(0,a.createElement)("p",{className:"description"},"Shows additional debugging information in browser console. Disable in production.")),(0,a.createElement)("h2",null,"Webhook Settings"),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-retries"},"Retry Attempts"),(0,a.createElement)("input",{type:"number",id:"fc-retries",value:e.webhookRetries,onChange:e=>p("webhookRetries",parseInt(e.target.value,10)),min:0,max:5,className:"small-text"}),(0,a.createElement)("p",{className:"description"},"Number of times to retry failed webhook requests.")),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-retry-delay"},"Retry Delay (ms)"),(0,a.createElement)("input",{type:"number",id:"fc-retry-delay",value:e.retryDelay,onChange:e=>p("retryDelay",parseInt(e.target.value,10)),min:100,max:1e4,step:100,className:"small-text"}),(0,a.createElement)("p",{className:"description"},"Initial delay between retries. Uses exponential backoff.")),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-custom-headers"},"Custom Headers (JSON)"),(0,a.createElement)("textarea",{id:"fc-custom-headers",value:e.customHeaders,onChange:e=>p("customHeaders",e.target.value),rows:4,className:"large-text code",placeholder:'{"X-Custom-Header": "value"}'}),(0,a.createElement)("p",{className:"description"},"Additional headers to send with webhook requests.")),(0,a.createElement)("h2",null,"Fallback Settings"),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:e.enableFallback,onChange:e=>p("enableFallback",e.target.checked)}),(0,a.createElement)("span",null,"Enable global fallback form")),(0,a.createElement)("p",{className:"description"},"Show a contact form when webhook is unavailable.")),e.enableFallback&&(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-fallback-email"},"Fallback Notification Email"),(0,a.createElement)("input",{type:"email",id:"fc-fallback-email",value:e.fallbackEmail,onChange:e=>p("fallbackEmail",e.target.value),className:"regular-text",placeholder:"admin@example.com"})),(0,a.createElement)("h2",null,"Data Management"),(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{className:"n8n-chat-checkbox n8n-chat-checkbox-danger"},(0,a.createElement)("input",{type:"checkbox",checked:e.deleteDataOnUninstall,onChange:e=>p("deleteDataOnUninstall",e.target.checked)}),(0,a.createElement)("span",null,"Delete all data when plugin is uninstalled")),(0,a.createElement)("p",{className:"description n8n-chat-warning"},"This will permanently delete all chat instances, history, and settings.")));default:return null}})(),(0,a.createElement)("div",{className:"n8n-chat-settings-footer"},(0,a.createElement)("button",{className:"button button-primary button-large",onClick:async()=>{o(!0),h(null),m(!1);try{if(!(await fetch(`${window.n8nChatAdmin.apiUrl}/settings`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.n8nChatAdmin.nonce},body:JSON.stringify(e)})).ok)throw new Error("Failed to save settings");m(!0),setTimeout(()=>m(!1),3e3)}catch(e){h(e instanceof Error?e.message:"Failed to save")}finally{o(!1)}},disabled:r},r?"Saving...":"Save Settings")))))},R=()=>{const[e,t]=(0,a.useState)("import-export"),[n,l]=(0,a.useState)(!1),[c,s]=(0,a.useState)(!1),[r,o]=(0,a.useState)(null),[i,m]=(0,a.useState)(!1),[d,h]=(0,a.useState)(null),[u,p]=(0,a.useState)(null),[E,b]=(0,a.useState)([]),[g,f]=(0,a.useState)(!1),[N,v]=(0,a.useState)(""),[y,w]=(0,a.useState)(null),k=(0,a.useRef)(null);(0,a.useEffect)(()=>{"system"===e&&C()},[e]);const C=async()=>{m(!0);try{const e=await fetch(`${window.n8nChatAdmin.apiUrl}/system-info`,{headers:{"X-WP-Nonce":window.n8nChatAdmin.nonce}});if(e.ok){const t=await e.json();o(t)}}catch(e){console.error("Failed to fetch system info:",e)}finally{m(!1)}},x=(e,t)=>{const a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(a),l=document.createElement("a");l.href=n,l.download=t,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(n)};return(0,a.createElement)("div",{className:"n8n-chat-tools"},(0,a.createElement)("div",{className:"n8n-chat-page-header"},(0,a.createElement)("h1",null,"Tools"),(0,a.createElement)("p",null,"Import, export, and debug your n8n Chat installation.")),d&&(0,a.createElement)("div",{className:"notice notice-error is-dismissible"},(0,a.createElement)("p",null,d),(0,a.createElement)("button",{type:"button",className:"notice-dismiss",onClick:()=>h(null)},(0,a.createElement)("span",{className:"screen-reader-text"},"Dismiss"))),u&&(0,a.createElement)("div",{className:"notice notice-success is-dismissible"},(0,a.createElement)("p",null,u),(0,a.createElement)("button",{type:"button",className:"notice-dismiss",onClick:()=>p(null)},(0,a.createElement)("span",{className:"screen-reader-text"},"Dismiss"))),(0,a.createElement)("div",{className:"n8n-chat-tools-tabs"},(0,a.createElement)("button",{className:"n8n-chat-tools-tab "+("import-export"===e?"is-active":""),onClick:()=>t("import-export")},(0,a.createElement)("span",{className:"dashicons dashicons-upload"}),"Import / Export"),(0,a.createElement)("button",{className:"n8n-chat-tools-tab "+("debug"===e?"is-active":""),onClick:()=>t("debug")},(0,a.createElement)("span",{className:"dashicons dashicons-admin-tools"}),"Debug"),(0,a.createElement)("button",{className:"n8n-chat-tools-tab "+("system"===e?"is-active":""),onClick:()=>t("system")},(0,a.createElement)("span",{className:"dashicons dashicons-info"}),"System Info")),(0,a.createElement)("div",{className:"n8n-chat-tools-content"},"import-export"===e&&(0,a.createElement)("div",{className:"n8n-chat-tools-section"},(0,a.createElement)("h2",null,"Export"),(0,a.createElement)("p",{className:"n8n-chat-tools-description"},"Export your n8n Chat configuration to a JSON file for backup or migration."),(0,a.createElement)("div",{className:"n8n-chat-export-options"},(0,a.createElement)("div",{className:"n8n-chat-export-option"},(0,a.createElement)("h4",null,"Export All"),(0,a.createElement)("p",null,"Includes all instances, settings, and templates."),(0,a.createElement)("button",{className:"button button-primary",onClick:async()=>{s(!0),h(null);try{const e=await fetch(`${window.n8nChatAdmin.apiUrl}/export?type=all`,{headers:{"X-WP-Nonce":window.n8nChatAdmin.nonce}});if(!e.ok)throw new Error("Export failed");const t=await e.json();x(t,"n8n-chat-export-all.json"),p("Export completed successfully!")}catch(e){h(e instanceof Error?e.message:"Export failed")}finally{s(!1)}},disabled:c},c?"Exporting...":"Export Everything")),(0,a.createElement)("div",{className:"n8n-chat-export-option"},(0,a.createElement)("h4",null,"Export Instances Only"),(0,a.createElement)("p",null,"Export all chat bot configurations."),(0,a.createElement)("button",{className:"button",onClick:async()=>{s(!0),h(null);try{const e=await fetch(`${window.n8nChatAdmin.apiUrl}/export?type=instances`,{headers:{"X-WP-Nonce":window.n8nChatAdmin.nonce}});if(!e.ok)throw new Error("Export failed");const t=await e.json();x(t,"n8n-chat-instances.json"),p("Instances exported successfully!")}catch(e){h(e instanceof Error?e.message:"Export failed")}finally{s(!1)}},disabled:c},"Export Instances")),(0,a.createElement)("div",{className:"n8n-chat-export-option"},(0,a.createElement)("h4",null,"Export Settings Only"),(0,a.createElement)("p",null,"Export global plugin settings."),(0,a.createElement)("button",{className:"button",onClick:async()=>{s(!0),h(null);try{const e=await fetch(`${window.n8nChatAdmin.apiUrl}/export?type=settings`,{headers:{"X-WP-Nonce":window.n8nChatAdmin.nonce}});if(!e.ok)throw new Error("Export failed");const t=await e.json();x(t,"n8n-chat-settings.json"),p("Settings exported successfully!")}catch(e){h(e instanceof Error?e.message:"Export failed")}finally{s(!1)}},disabled:c},"Export Settings"))),(0,a.createElement)("hr",null),(0,a.createElement)("h2",null,"Import"),(0,a.createElement)("p",{className:"n8n-chat-tools-description"},"Import a previously exported n8n Chat configuration file."),(0,a.createElement)("div",{className:"n8n-chat-import-section"},(0,a.createElement)("input",{ref:k,type:"file",accept:".json",onChange:async e=>{const t=e.target.files?.[0];if(t){l(!0),h(null),p(null);try{const e=await t.text(),a=JSON.parse(e),n=await fetch(`${window.n8nChatAdmin.apiUrl}/import`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.n8nChatAdmin.nonce},body:JSON.stringify(a)});if(!n.ok){const e=await n.json();throw new Error(e.message||"Import failed")}const l=await n.json();p(`Import completed! ${l.instances_imported||0} instances imported.`)}catch(e){h(e instanceof Error?e.message:"Import failed")}finally{l(!1),k.current&&(k.current.value="")}}},style:{display:"none"}}),(0,a.createElement)("button",{className:"button button-primary",onClick:()=>k.current?.click(),disabled:n},n?(0,a.createElement)(a.Fragment,null,(0,a.createElement)("span",{className:"spinner is-active"}),"Importing..."):(0,a.createElement)(a.Fragment,null,(0,a.createElement)("span",{className:"dashicons dashicons-upload"}),"Choose File to Import")),(0,a.createElement)("p",{className:"description"},"Supported formats: n8n Chat export files (.json)")),(0,a.createElement)("div",{className:"n8n-chat-import-warning"},(0,a.createElement)("span",{className:"dashicons dashicons-warning"}),(0,a.createElement)("div",null,(0,a.createElement)("strong",null,"Warning:")," Importing will merge with existing data. Instances with the same ID will be overwritten."))),"debug"===e&&(0,a.createElement)("div",{className:"n8n-chat-tools-section"},(0,a.createElement)("h2",null,"Webhook Tester"),(0,a.createElement)("p",{className:"n8n-chat-tools-description"},"Test connectivity to an n8n webhook URL."),(0,a.createElement)("div",{className:"n8n-chat-debug-test"},(0,a.createElement)("div",{className:"n8n-chat-field"},(0,a.createElement)("label",{htmlFor:"fc-test-webhook"},"Webhook URL"),(0,a.createElement)("div",{className:"n8n-chat-input-group"},(0,a.createElement)("input",{type:"url",id:"fc-test-webhook",value:N,onChange:e=>v(e.target.value),className:"large-text",placeholder:"https://your-n8n.example.com/webhook/..."}),(0,a.createElement)("button",{className:"button button-primary",onClick:async()=>{if(N){f(!0),w(null);try{const e=await fetch(`${window.n8nChatAdmin.apiUrl}/test-webhook`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.n8nChatAdmin.nonce},body:JSON.stringify({url:N})}),t=await e.json();w({success:t.success,message:t.message||(t.success?"Connection successful!":"Connection failed")})}catch(e){w({success:!1,message:e instanceof Error?e.message:"Test failed"})}finally{f(!1)}}else w({success:!1,message:"Please enter a webhook URL"})},disabled:g},g?"Testing...":"Test Connection"))),y&&(0,a.createElement)("div",{className:"n8n-chat-test-result "+(y.success?"is-success":"is-error")},(0,a.createElement)("span",{className:"dashicons "+(y.success?"dashicons-yes-alt":"dashicons-warning")}),(0,a.createElement)("span",null,y.message))),(0,a.createElement)("hr",null),(0,a.createElement)("h2",null,"Debug Logs"),(0,a.createElement)("p",{className:"n8n-chat-tools-description"},"Recent n8n Chat activity logs (requires logging enabled in Settings)."),(0,a.createElement)("div",{className:"n8n-chat-debug-logs"},0===E.length?(0,a.createElement)("div",{className:"n8n-chat-debug-empty"},(0,a.createElement)("span",{className:"dashicons dashicons-info"}),(0,a.createElement)("p",null,"No debug logs available. Enable logging in Settings to see activity here.")):(0,a.createElement)("pre",{className:"n8n-chat-log-viewer"},E.join("\n")))),"system"===e&&(0,a.createElement)("div",{className:"n8n-chat-tools-section"},(0,a.createElement)("h2",null,"System Information"),(0,a.createElement)("p",{className:"n8n-chat-tools-description"},"Technical details about your WordPress environment."),i?(0,a.createElement)("div",{className:"n8n-chat-loading-inline"},(0,a.createElement)("span",{className:"spinner is-active"}),"Loading system information..."):r?(0,a.createElement)(a.Fragment,null,(0,a.createElement)("div",{className:"n8n-chat-system-grid"},(0,a.createElement)("div",{className:"n8n-chat-system-card"},(0,a.createElement)("h3",null,"Server Environment"),(0,a.createElement)("table",{className:"n8n-chat-system-table"},(0,a.createElement)("tbody",null,(0,a.createElement)("tr",null,(0,a.createElement)("td",null,"PHP Version"),(0,a.createElement)("td",null,r.php_version)),(0,a.createElement)("tr",null,(0,a.createElement)("td",null,"WordPress Version"),(0,a.createElement)("td",null,r.wp_version)),(0,a.createElement)("tr",null,(0,a.createElement)("td",null,"n8n Chat Version"),(0,a.createElement)("td",null,r.plugin_version)),(0,a.createElement)("tr",null,(0,a.createElement)("td",null,"Server"),(0,a.createElement)("td",null,r.server_info)),(0,a.createElement)("tr",null,(0,a.createElement)("td",null,"Memory Limit"),(0,a.createElement)("td",null,r.memory_limit)),(0,a.createElement)("tr",null,(0,a.createElement)("td",null,"Max Execution Time"),(0,a.createElement)("td",null,r.max_execution_time,"s")),(0,a.createElement)("tr",null,(0,a.createElement)("td",null,"cURL Version"),(0,a.createElement)("td",null,r.curl_version)),(0,a.createElement)("tr",null,(0,a.createElement)("td",null,"SSL Enabled"),(0,a.createElement)("td",null,r.ssl_enabled?(0,a.createElement)("span",{className:"n8n-chat-status-ok"},"Yes"):(0,a.createElement)("span",{className:"n8n-chat-status-warning"},"No")))))),(0,a.createElement)("div",{className:"n8n-chat-system-card"},(0,a.createElement)("h3",null,"PHP Extensions"),(0,a.createElement)("table",{className:"n8n-chat-system-table"},(0,a.createElement)("tbody",null,Object.entries(r.php_extensions).map(([e,t])=>(0,a.createElement)("tr",{key:e},(0,a.createElement)("td",null,e),(0,a.createElement)("td",null,t?(0,a.createElement)("span",{className:"n8n-chat-status-ok"},(0,a.createElement)("span",{className:"dashicons dashicons-yes"})):(0,a.createElement)("span",{className:"n8n-chat-status-error"},(0,a.createElement)("span",{className:"dashicons dashicons-no"})))))))),(0,a.createElement)("div",{className:"n8n-chat-system-card"},(0,a.createElement)("h3",null,"Database Tables"),(0,a.createElement)("table",{className:"n8n-chat-system-table"},(0,a.createElement)("tbody",null,Object.entries(r.database_tables).map(([e,t])=>(0,a.createElement)("tr",{key:e},(0,a.createElement)("td",null,e),(0,a.createElement)("td",null,t.exists?(0,a.createElement)("span",{className:"n8n-chat-status-ok"},"OK (",t.rows," rows)"):(0,a.createElement)("span",{className:"n8n-chat-status-error"},"Missing"))))))),(0,a.createElement)("div",{className:"n8n-chat-system-card"},(0,a.createElement)("h3",null,"Active Theme"),(0,a.createElement)("p",null,r.active_theme),(0,a.createElement)("h3",{style:{marginTop:"16px"}},"Active Plugins"),(0,a.createElement)("ul",{className:"n8n-chat-plugin-list"},r.active_plugins.slice(0,10).map(e=>(0,a.createElement)("li",{key:e},e)),r.active_plugins.length>10&&(0,a.createElement)("li",{className:"n8n-chat-plugin-more"},"+",r.active_plugins.length-10," more")))),(0,a.createElement)("div",{className:"n8n-chat-system-actions"},(0,a.createElement)("button",{className:"button",onClick:()=>{r&&(navigator.clipboard.writeText(JSON.stringify(r,null,2)),p("System info copied to clipboard!"),setTimeout(()=>p(null),3e3))}},(0,a.createElement)("span",{className:"dashicons dashicons-clipboard"}),"Copy to Clipboard"),(0,a.createElement)("button",{className:"button",onClick:async()=>{if(!r)return;const e=`\nn8n Chat System Report\nGenerated: ${(new Date).toISOString()}\n\n== Server Environment ==\nPHP Version: ${r.php_version}\nWordPress Version: ${r.wp_version}\nn8n Chat Version: ${r.plugin_version}\nServer: ${r.server_info}\nMemory Limit: ${r.memory_limit}\nMax Execution Time: ${r.max_execution_time}\ncURL Version: ${r.curl_version}\nSSL Enabled: ${r.ssl_enabled?"Yes":"No"}\n\n== PHP Extensions ==\n${Object.entries(r.php_extensions).map(([e,t])=>`${e}: ${t?"Enabled":"Disabled"}`).join("\n")}\n\n== Database Tables ==\n${Object.entries(r.database_tables).map(([e,t])=>`${e}: ${t.exists?`OK (${t.rows} rows)`:"MISSING"}`).join("\n")}\n\n== Active Theme ==\n${r.active_theme}\n\n== Active Plugins ==\n${r.active_plugins.join("\n")}\n`.trim(),t=new Blob([e],{type:"text/plain"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download="n8n-chat-system-report.txt",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)}},(0,a.createElement)("span",{className:"dashicons dashicons-download"}),"Download Report"))):(0,a.createElement)("div",{className:"n8n-chat-debug-empty"},(0,a.createElement)("span",{className:"dashicons dashicons-warning"}),(0,a.createElement)("p",null,"Failed to load system information."),(0,a.createElement)("button",{className:"button",onClick:C},"Retry")))))},B=({initialPage:e})=>{const[t,n]=(0,a.useState)(e),[l,s]=(0,a.useState)("list"),[r,o]=(0,a.useState)(null),[i,m]=(0,a.useState)(!1),[d,h]=(0,a.useState)(null);(0,a.useEffect)(()=>{const e=new URLSearchParams(window.location.search),t=e.get("action"),a=e.get("id"),n=e.get("edit");"edit"===t&&a?(s("edit"),o(a)):n?(s("edit"),o(n)):"create"!==t&&"new"!==t||(s("create"),o(null))},[]);const u=(e,t)=>{const a={dashboard:"n8n-chat",instances:"n8n-chat-instances",templates:"n8n-chat-templates",settings:"n8n-chat-settings",tools:"n8n-chat-tools"},n=a[e]||a.dashboard,l=new URL(window.location.href);l.searchParams.set("page",n),l.searchParams.delete("action"),l.searchParams.delete("id"),l.searchParams.delete("edit"),t&&Object.entries(t).forEach(([e,t])=>{"edit"===e?l.searchParams.set("edit",t):l.searchParams.set(e,t)}),window.location.href=l.toString()},p=e=>{o(e),s("edit");const t=new URL(window.location.href);t.searchParams.set("action","edit"),t.searchParams.set("id",e),window.history.pushState({},"",t.toString())},E=()=>{o(null),s("create");const e=new URL(window.location.href);e.searchParams.set("action","create"),e.searchParams.delete("id"),window.history.pushState({},"",e.toString())},b=()=>{s("list"),o(null);const e=new URL(window.location.href);e.searchParams.delete("action"),e.searchParams.delete("id"),e.searchParams.delete("edit"),window.history.pushState({},"",e.toString())};return(0,a.createElement)("div",{className:"n8n-chat-admin"},d&&(0,a.createElement)("div",{className:"notice notice-error is-dismissible"},(0,a.createElement)("p",null,d),(0,a.createElement)("button",{type:"button",className:"notice-dismiss",onClick:()=>h(null)},(0,a.createElement)("span",{className:"screen-reader-text"},"Dismiss"))),i&&(0,a.createElement)("div",{className:"n8n-chat-admin-loading"},(0,a.createElement)("div",{className:"n8n-chat-loading-spinner"})),(0,a.createElement)("div",{className:"n8n-chat-admin-content"},(()=>{switch(t){case"dashboard":default:return(0,a.createElement)(P,{onNavigate:u});case"instances":return"edit"===l||"create"===l?(0,a.createElement)(T,{instanceId:r,onBack:b,onSaved:b}):(0,a.createElement)(c,{onEdit:p,onCreate:E});case"templates":return(0,a.createElement)(U,{onNavigate:u});case"settings":return(0,a.createElement)(D,null);case"tools":return(0,a.createElement)(R,null)}})()))};document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("n8n-chat-admin-root");if(!e)return void console.error("n8n Chat Admin: Container not found");const t=e.dataset.page||"dashboard";(0,n.H)(e).render((0,a.createElement)(B,{initialPage:t}))})})();
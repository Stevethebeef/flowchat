var N8nChat=function(e,t,n){"use strict";var r,s,i,o,a,c,l=Object.defineProperty,u=e=>{throw TypeError(e)},d=(e,t,n)=>((e,t,n)=>t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n),h=(e,t,n)=>t.has(e)||u("Cannot "+n),p=(e,t,n)=>(h(e,t,"read from private field"),n?n.call(e):t.get(e)),f=(e,t,n)=>t.has(e)?u("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),m=(e,t,n,r)=>(h(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n);function g(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e)for(const n in e)if("default"!==n){const r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:()=>e[n]})}return t.default=e,Object.freeze(t)}const v=g(t),y=g(n);function b(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var w={exports:{}},x={},_=t,S=Symbol.for("react.element"),E=Symbol.for("react.fragment"),I=Object.prototype.hasOwnProperty,T=_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,C={key:!0,ref:!0,__self:!0,__source:!0};function R(e,t,n){var r,s={},i=null,o=null;for(r in void 0!==n&&(i=""+n),void 0!==t.key&&(i=""+t.key),void 0!==t.ref&&(o=t.ref),t)I.call(t,r)&&!C.hasOwnProperty(r)&&(s[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===s[r]&&(s[r]=t[r]);return{$$typeof:S,type:e,key:i,ref:o,props:s,_owner:T.current}}x.Fragment=E,x.jsx=R,x.jsxs=R,w.exports=x;var k,A=w.exports,j=n;k=j.createRoot,j.hydrateRoot;class M{constructor(){d(this,"_providers",new Set),d(this,"_subscribers",new Set)}getModelContext(){return e=this._providers,Array.from(e).map(e=>e.getModelContext()).sort((e,t)=>(t.priority??0)-(e.priority??0)).reduce((e,t)=>{var n;if(t.system&&(e.system?e.system+=`\n\n${t.system}`:e.system=t.system),t.tools)for(const[r,s]of Object.entries(t.tools)){const t=null==(n=e.tools)?void 0:n[r];if(t&&t!==s)throw new Error(`You tried to define a tool with the name ${r}, but it already exists.`);e.tools||(e.tools={}),e.tools[r]=s}return t.config&&(e.config={...e.config,...t.config}),t.callSettings&&(e.callSettings={...e.callSettings,...t.callSettings}),e},{});var e}registerModelContextProvider(e){var t;this._providers.add(e);const n=null==(t=e.subscribe)?void 0:t.call(e,()=>{this.notifySubscribers()});return this.notifySubscribers(),()=>{this._providers.delete(e),null==n||n(),this.notifySubscribers()}}notifySubscribers(){for(const e of this._subscribers)e()}subscribe(e){return this._subscribers.add(e),()=>this._subscribers.delete(e)}}class N{constructor(){d(this,"_contextProvider",new M)}registerModelContextProvider(e){return this._contextProvider.registerModelContextProvider(e)}getModelContextProvider(){return this._contextProvider}}class P{constructor(){d(this,"_subscribers",new Set)}subscribe(e){return this._subscribers.add(e),()=>this._subscribers.delete(e)}waitForUpdate(){return new Promise(e=>{const t=this.subscribe(()=>{t(),e()})})}_notifySubscribers(){const e=[];for(const n of this._subscribers)try{n()}catch(t){e.push(t)}if(e.length>0)throw 1===e.length?e[0]:new AggregateError(e)}}class O extends P{constructor(){super(...arguments),d(this,"isEditing",!0),d(this,"_attachments",[]),d(this,"_text",""),d(this,"_role","user"),d(this,"_runConfig",{}),d(this,"_eventSubscribers",new Map)}get attachmentAccept(){var e;return(null==(e=this.getAttachmentAdapter())?void 0:e.accept)??"*"}get attachments(){return this._attachments}setAttachments(e){this._attachments=e,this._notifySubscribers()}get isEmpty(){return!this.text.trim()&&!this.attachments.length}get text(){return this._text}get role(){return this._role}get runConfig(){return this._runConfig}setText(e){this._text!==e&&(this._text=e,this._notifySubscribers())}setRole(e){this._role!==e&&(this._role=e,this._notifySubscribers())}setRunConfig(e){this._runConfig!==e&&(this._runConfig=e,this._notifySubscribers())}_emptyTextAndAttachments(){this._attachments=[],this._text="",this._notifySubscribers()}async _onClearAttachments(){const e=this.getAttachmentAdapter();e&&await Promise.all(this._attachments.map(t=>e.remove(t)))}async reset(){if(0===this._attachments.length&&""===this._text&&"user"===this._role&&0===Object.keys(this._runConfig).length)return;this._role="user",this._runConfig={};const e=this._onClearAttachments();this._emptyTextAndAttachments(),await e}async clearAttachments(){const e=this._onClearAttachments();this.setAttachments([]),await e}async send(){const e=this.getAttachmentAdapter(),t=e&&this.attachments.length>0?Promise.all(this.attachments.map(async t=>{if((e=>"complete"===e.status.type)(t))return t;return await e.send(t)})):[],n=this.text;this._emptyTextAndAttachments();const r={createdAt:new Date,role:this.role,content:n?[{type:"text",text:n}]:[],attachments:await t,runConfig:this.runConfig,metadata:{custom:{}}};this.handleSend(r),this._notifyEventSubscribers("send")}cancel(){this.handleCancel()}async addAttachment(e){const t=this.getAttachmentAdapter();if(!t)throw new Error("Attachments are not supported");const n=e=>{const t=this._attachments.findIndex(t=>t.id===e.id);this._attachments=-1!==t?[...this._attachments.slice(0,t),e,...this._attachments.slice(t+1)]:[...this._attachments,e],this._notifySubscribers()},r=t.add({file:e});if(Symbol.asyncIterator in r)for await(const s of r)n(s);else n(await r);this._notifyEventSubscribers("attachment-add"),this._notifySubscribers()}async removeAttachment(e){const t=this.getAttachmentAdapter();if(!t)throw new Error("Attachments are not supported");const n=this._attachments.findIndex(t=>t.id===e);if(-1===n)throw new Error("Attachment not found");const r=this._attachments[n];await t.remove(r),this._attachments=[...this._attachments.slice(0,n),...this._attachments.slice(n+1)],this._notifySubscribers()}_notifyEventSubscribers(e){const t=this._eventSubscribers.get(e);if(t)for(const n of t)n()}unstable_on(e,t){const n=this._eventSubscribers.get(e);return n?n.add(t):this._eventSubscribers.set(e,new Set([t])),()=>{const n=this._eventSubscribers.get(e);n&&n.delete(t)}}}class L extends O{constructor(e){super(),d(this,"runtime"),d(this,"_canCancel",!1),this.runtime=e,this.connect()}get canCancel(){return this._canCancel}get attachments(){return super.attachments}getAttachmentAdapter(){var e;return null==(e=this.runtime.adapters)?void 0:e.attachments}connect(){return this.runtime.subscribe(()=>{this.canCancel!==this.runtime.capabilities.cancel&&(this._canCancel=this.runtime.capabilities.cancel,this._notifySubscribers())})}async handleSend(e){var t;this.runtime.append({...e,parentId:(null==(t=this.runtime.messages.at(-1))?void 0:t.id)??null,sourceId:null})}async handleCancel(){this.runtime.cancelRun()}}let B=(e,t=21)=>(n=t)=>{let r="",s=0|n;for(;s--;)r+=e[Math.random()*e.length|0];return r};const D=B("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",7),F=()=>`__optimistic__${D()}`,$=Symbol("autoStatus"),U=Object.freeze(Object.assign({type:"running"},{[$]:!0})),z=Object.freeze(Object.assign({type:"complete",reason:"unknown"},{[$]:!0})),W=Object.freeze(Object.assign({type:"requires-action",reason:"tool-calls"},{[$]:!0})),H=Object.freeze(Object.assign({type:"requires-action",reason:"interrupt"},{[$]:!0}));var V={exports:{}};const q="undefined"!=typeof Buffer,J=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,Y=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function K(e,t,n){null==n&&null!==t&&"object"==typeof t&&(n=t,t=void 0),q&&Buffer.isBuffer(e)&&(e=e.toString()),e&&65279===e.charCodeAt(0)&&(e=e.slice(1));const r=JSON.parse(e,t);if(null===r||"object"!=typeof r)return r;const s=n&&n.protoAction||"error",i=n&&n.constructorAction||"error";if("ignore"===s&&"ignore"===i)return r;if("ignore"!==s&&"ignore"!==i){if(!1===J.test(e)&&!1===Y.test(e))return r}else if("ignore"!==s&&"ignore"===i){if(!1===J.test(e))return r}else if(!1===Y.test(e))return r;return G(r,{protoAction:s,constructorAction:i,safe:n&&n.safe})}function G(e,{protoAction:t="error",constructorAction:n="error",safe:r}={}){let s=[e];for(;s.length;){const e=s;s=[];for(const i of e){if("ignore"!==t&&Object.prototype.hasOwnProperty.call(i,"__proto__")){if(!0===r)return null;if("error"===t)throw new SyntaxError("Object contains forbidden prototype property");delete i.__proto__}if("ignore"!==n&&Object.prototype.hasOwnProperty.call(i,"constructor")&&null!==i.constructor&&"object"==typeof i.constructor&&Object.prototype.hasOwnProperty.call(i.constructor,"prototype")){if(!0===r)return null;if("error"===n)throw new SyntaxError("Object contains forbidden prototype property");delete i.constructor}for(const e in i){const t=i[e];t&&"object"==typeof t&&s.push(t)}}}return e}function X(e,t,n){const{stackTraceLimit:r}=Error;Error.stackTraceLimit=0;try{return K(e,t,n)}finally{Error.stackTraceLimit=r}}V.exports=X,V.exports.default=X,V.exports.parse=X,V.exports.safeParse=function(e,t){const{stackTraceLimit:n}=Error;Error.stackTraceLimit=0;try{return K(e,t,{safe:!0})}catch{return}finally{Error.stackTraceLimit=n}},V.exports.scan=G;const Z=b(V.exports);const Q=Symbol("aui.parse-partial-json-object.meta"),ee=e=>{if(0===e.length)return{[Q]:{state:"partial",partialPath:[]}};try{const t=Z.parse(e);if("object"!=typeof t||null===t)throw new Error("argsText is expected to be an object");return t[Q]={state:"complete",partialPath:[]},t}catch{try{const[t,n]=function(e){const t=["ROOT"];let n=-1,r=null;const s=[];let i;function o(){void 0!==i&&(s.push(JSON.parse(`"${i}"`)),i=void 0)}function a(e,s,i){switch(e){case'"':n=s,t.pop(),t.push(i),t.push("INSIDE_STRING"),o();break;case"f":case"t":case"n":n=s,r=s,t.pop(),t.push(i),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(i),t.push("INSIDE_NUMBER"),o();break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n=s,t.pop(),t.push(i),t.push("INSIDE_NUMBER"),o();break;case"{":n=s,t.pop(),t.push(i),t.push("INSIDE_OBJECT_START"),o();break;case"[":n=s,t.pop(),t.push(i),t.push("INSIDE_ARRAY_START"),o()}}function c(e,r){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":n=r,t.pop(),i=s.pop()}}function l(e,r){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA"),i=(Number(i)+1).toString();break;case"]":n=r,t.pop(),i=s.pop()}}for(let d=0;d<e.length;d++){const o=e[d];switch(t[t.length-1]){case"ROOT":a(o,d,"FINISH");break;case"INSIDE_OBJECT_START":switch(o){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY"),i="";break;case"}":n=d,t.pop(),i=s.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===o&&(t.pop(),t.push("INSIDE_OBJECT_KEY"),i="");break;case"INSIDE_OBJECT_KEY":switch(o){case'"':t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY");break;case"\\":t.push("INSIDE_STRING_ESCAPE"),i+=o;break;default:i+=o}break;case"INSIDE_OBJECT_AFTER_KEY":":"===o&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":a(o,d,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":c(o,d);break;case"INSIDE_STRING":switch(o){case'"':t.pop(),n=d,i=s.pop();break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:n=d}break;case"INSIDE_ARRAY_START":"]"===o?(n=d,t.pop(),i=s.pop()):(n=d,i="0",a(o,d,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(o){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA"),i=(Number(i)+1).toString();break;case"]":n=d,t.pop(),i=s.pop();break;default:n=d}break;case"INSIDE_ARRAY_AFTER_COMMA":a(o,d,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),"INSIDE_STRING"===t[t.length-1]?n=d:"INSIDE_OBJECT_KEY"===t[t.length-1]&&(i+=o);break;case"INSIDE_NUMBER":switch(o){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n=d;break;case"e":case"E":case"-":case".":break;case",":t.pop(),i=s.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&l(o,d),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&c(o,d);break;case"}":t.pop(),i=s.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&c(o,d);break;case"]":t.pop(),i=s.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&l(o,d);break;default:t.pop(),i=s.pop()}break;case"INSIDE_LITERAL":{const s=e.substring(r,d+1);"false".startsWith(s)||"true".startsWith(s)||"null".startsWith(s)?n=d:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?c(o,d):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&l(o,d));break}}}let u=e.slice(0,n+1);for(let d=t.length-1;d>=0;d--)switch(t[d]){case"INSIDE_STRING":u+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":u+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":u+="]";break;case"INSIDE_LITERAL":{const t=e.substring(r,e.length);"true".startsWith(t)?u+="true".slice(t.length):"false".startsWith(t)?u+="false".slice(t.length):"null".startsWith(t)&&(u+="null".slice(t.length))}}return[u,s]}(e),r=Z.parse(t);if("object"!=typeof r||null===r)throw new Error("argsText is expected to be an object");return r[Q]={state:"partial",partialPath:n},r}catch{return}}},te={toResponse:(e,t)=>new Response(te.toByteStream(e,t),{headers:t.headers??{}}),fromResponse:(e,t)=>te.fromByteStream(e.body,t),toByteStream:(e,t)=>e.pipeThrough(t),fromByteStream:(e,t)=>e.pipeThrough(t)},ne=function(){let e,t;const n=new Promise((n,r)=>{e=n,t=r});if(!e||!t)throw new Error("Failed to create promise");return{promise:n,resolve:e,reject:t}},re=()=>{const e=[];let t,n,r=!1;const s=s=>{s.promise||(s.promise=s.reader.read().then(({done:i,value:o})=>{s.promise=void 0,i?(e.splice(e.indexOf(s),1),r&&0===e.length&&t.close()):t.enqueue(o),null==n||n.resolve(),n=void 0}).catch(r=>{e.forEach(e=>{e.reader.cancel()}),e.length=0,t.error(r),null==n||n.reject(r),n=void 0}))};return{readable:new ReadableStream({start(e){t=e},pull:()=>(n=ne(),e.forEach(e=>{s(e)}),n.promise),cancel(){e.forEach(e=>{e.reader.cancel()}),e.length=0}}),isSealed:()=>r,seal(){r=!0,0===e.length&&t.close()},addStream(t){if(r)throw new Error("Cannot add streams after the run callback has settled.");const n={reader:t.getReader()};e.push(n),s(n)},enqueue(e){this.addStream(new ReadableStream({start(t){t.enqueue(e),t.close()}}))}}};class se{constructor(e){d(this,"_controller"),d(this,"_isClosed",!1),this._controller=e}append(e){return this._controller.enqueue({type:"text-delta",path:[],textDelta:e}),this}close(){this._isClosed||(this._isClosed=!0,this._controller.enqueue({type:"part-finish",path:[]}),this._controller.close())}}const ie=e=>new ReadableStream({start(t){var n;return null==(n=e.start)?void 0:n.call(e,new se(t))},pull(t){var n;return null==(n=e.pull)?void 0:n.call(e,new se(t))},cancel(t){var n;return null==(n=e.cancel)?void 0:n.call(e,t)}}),oe=()=>{let e;return[ie({start(t){e=t}}),e]};class ae{constructor(e){d(this,"_controller"),d(this,"_isClosed",!1),d(this,"_mergeTask"),d(this,"_argsTextController"),this._controller=e;const t=ie({start:e=>{this._argsTextController=e}});let n=!1;this._mergeTask=t.pipeTo(new WritableStream({write:e=>{switch(e.type){case"text-delta":n=!0,this._controller.enqueue(e);break;case"part-finish":n||this._controller.enqueue({type:"text-delta",textDelta:"{}",path:[]}),this._controller.enqueue({type:"tool-call-args-text-finish",path:[]});break;default:throw new Error(`Unexpected chunk type: ${e.type}`)}}}))}get argsText(){return this._argsTextController}async setResponse(e){this._argsTextController.close(),await Promise.resolve(),this._controller.enqueue({type:"result",path:[],...void 0!==e.artifact?{artifact:e.artifact}:{},result:e.result,isError:e.isError??!1})}async close(){this._isClosed||(this._isClosed=!0,this._argsTextController.close(),await this._mergeTask,this._controller.enqueue({type:"part-finish",path:[]}),this._controller.close())}}const ce=()=>{let e;var t;return[(t={start(t){e=t}},new ReadableStream({start(e){var n;return null==(n=t.start)?void 0:n.call(t,new ae(e))},pull(e){var n;return null==(n=t.pull)?void 0:n.call(t,new ae(e))},cancel(e){var n;return null==(n=t.cancel)?void 0:n.call(t,e)}})),e]};class le{constructor(){d(this,"value",-1)}up(){return++this.value}}class ue extends TransformStream{constructor(e){super({transform(t,n){n.enqueue({...t,path:[e,...t.path]})}})}}TransformStream;class de extends TransformStream{constructor(e){const t=new le,n=new Map;super({transform(r,s){"part-start"===r.type&&0===r.path.length&&n.set(t.up(),e.up());const[i,...o]=r.path;if(void 0===i)return void s.enqueue(r);const a=n.get(i);if(void 0===a)throw new Error("Path not found");s.enqueue({...r,path:[a,...o]})}})}}class he extends TransformStream{constructor(e){super();const t=e(super.readable);Object.defineProperty(this,"readable",{value:t,writable:!1})}}const pe=B("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",7);class fe{constructor(e){d(this,"_state"),d(this,"_parentId"),this._state=e||{merger:re(),contentCounter:new le}}get __internal_isClosed(){return this._state.merger.isSealed()}__internal_getReadable(){return this._state.merger.readable}__internal_subscribeToClose(e){this._state.closeSubscriber=e}_addPart(e,t){this._state.append&&(this._state.append.controller.close(),this._state.append=void 0),this.enqueue({type:"part-start",part:e,path:[]}),this._state.merger.addStream(t.pipeThrough(new ue(this._state.contentCounter.value)))}merge(e){this._state.merger.addStream(e.pipeThrough(new de(this._state.contentCounter)))}appendText(e){var t;"text"!==(null==(t=this._state.append)?void 0:t.kind)&&(this._state.append={kind:"text",controller:this.addTextPart()}),this._state.append.controller.append(e)}appendReasoning(e){var t;"reasoning"!==(null==(t=this._state.append)?void 0:t.kind)&&(this._state.append={kind:"reasoning",controller:this.addReasoningPart()}),this._state.append.controller.append(e)}addTextPart(){const[e,t]=oe();return this._addPart({type:"text"},e),t}addReasoningPart(){const[e,t]=oe();return this._addPart({type:"reasoning"},e),t}addToolCallPart(e){const t="string"==typeof e?{toolName:e}:e,n=t.toolName,r=t.toolCallId??pe(),[s,i]=ce();return this._addPart({type:"tool-call",toolName:n,toolCallId:r,...this._parentId&&{parentId:this._parentId}},s),void 0!==t.argsText&&(i.argsText.append(t.argsText),i.argsText.close()),void 0!==t.args&&(i.argsText.append(JSON.stringify(t.args)),i.argsText.close()),void 0!==t.response&&i.setResponse(t.response),i}appendSource(e){this._addPart({...e,...this._parentId&&{parentId:this._parentId}},new ReadableStream({start(e){e.enqueue({type:"part-finish",path:[]}),e.close()}}))}appendFile(e){this._addPart(e,new ReadableStream({start(e){e.enqueue({type:"part-finish",path:[]}),e.close()}}))}enqueue(e){this._state.merger.enqueue(e),"part-start"===e.type&&0===e.path.length&&this._state.contentCounter.up()}withParentId(e){const t=new fe(this._state);return t._parentId=e,t}close(){var e,t,n,r;null==(t=null==(e=this._state.append)?void 0:e.controller)||t.close(),this._state.merger.seal(),null==(r=(n=this._state).closeSubscriber)||r.call(n)}}function me(){const{resolve:e,promise:t}=ne();let n;return[function(e){const t=new fe;return(async()=>{try{await e(t)}catch(n){throw t.__internal_isClosed||t.enqueue({type:"error",path:[],error:String(n)}),n}finally{t.__internal_isClosed||t.close()}})(),t.__internal_getReadable()}(r=>(n=r,n.__internal_subscribeToClose(e),t)),n]}class ge extends TransformStream{constructor(e,t,n){const[r,s]=me();let i;super({start(t){var n;return i=r.pipeTo(new WritableStream({write(e){t.enqueue(e)},abort(e){t.error(e)},close(){t.terminate()}})).catch(e=>{t.error(e)}),null==(n=e.start)?void 0:n.call(e,s)},transform(t){var n;return null==(n=e.transform)?void 0:n.call(e,t,s)},async flush(){var t;await(null==(t=e.flush)?void 0:t.call(e,s)),s.close(),await i}},t,n)}}const ve=(e,t,n)=>{const{role:r,id:s,createdAt:i,attachments:o,status:a,metadata:c}=e,l={id:s??t,createdAt:i??new Date},u="string"==typeof e.content?[{type:"text",text:e.content}]:e.content;if("user"!==r&&(null==o?void 0:o.length))throw new Error("attachments are only supported for user messages");if("assistant"!==r&&a)throw new Error("status is only supported for assistant messages");if("assistant"!==r&&(null==c?void 0:c.steps))throw new Error("metadata.steps is only supported for assistant messages");switch(r){case"assistant":return{...l,role:r,content:u.map(e=>{const t=e.type;switch(t){case"text":case"reasoning":return 0===e.text.trim().length?null:e;case"file":case"source":case"data":return e;case"image":return(({image:e,...t})=>e.match(/^data:image\/(png|jpeg|jpg|gif|webp);base64,(.*)$/)?{...t,image:e}:null)(e);case"tool-call":{const{parentId:t,messages:n,...r}=e,s={...r,toolCallId:e.toolCallId??`tool-${D()}`,...void 0!==t&&{parentId:t},...void 0!==n&&{messages:n}};return e.args?{...s,args:e.args,argsText:e.argsText??JSON.stringify(e.args)}:{...s,args:ee(e.argsText??"")??{},argsText:e.argsText??""}}default:throw new Error(`Unsupported assistant message part type: ${t}`)}}).filter(e=>!!e),status:a??n,metadata:{unstable_state:(null==c?void 0:c.unstable_state)??null,unstable_annotations:(null==c?void 0:c.unstable_annotations)??[],unstable_data:(null==c?void 0:c.unstable_data)??[],custom:(null==c?void 0:c.custom)??{},steps:(null==c?void 0:c.steps)??[],...(null==c?void 0:c.submittedFeedback)&&{submittedFeedback:c.submittedFeedback}}};case"user":return{...l,role:r,content:u.map(e=>{const t=e.type;switch(t){case"text":case"image":case"audio":case"file":return e;default:throw new Error(`Unsupported user message part type: ${t}`)}}),attachments:o??[],metadata:{custom:(null==c?void 0:c.custom)??{}}};case"system":if(1!==u.length||"text"!==u[0].type)throw new Error("System messages must have exactly one text message part.");return{...l,role:r,content:u,metadata:{custom:(null==c?void 0:c.custom)??{}}};default:throw new Error(`Unknown message role: ${r}`)}},ye=e=>{const t=e.map(e=>{return ve(e,D(),(t=!1,n=!1,r=!1,!1&&t?U:n?H:r?W:z));var t,n,r});return{messages:t.map((e,n)=>({parentId:n>0?t[n-1].id:null,message:e}))}},be=e=>e.next?be(e.next):"current"in e?e:null;class we{constructor(e){d(this,"func"),d(this,"_value",null),this.func=e}get value(){return null===this._value&&(this._value=this.func()),this._value}dirty(){this._value=null}}class xe{constructor(){d(this,"messages",new Map),d(this,"head",null),d(this,"root",{children:[],next:null}),d(this,"_messages",new we(()=>{var e;const t=new Array(((null==(e=this.head)?void 0:e.level)??-1)+1);for(let n=this.head;n;n=n.prev)t[n.level]=n.current;return t}))}updateLevels(e,t){e.level=t;for(const n of e.children){const e=this.messages.get(n);e&&this.updateLevels(e,t+1)}}performOp(e,t,n){const r=t.prev??this.root,s=e??this.root;if("relink"!==n||r!==s){if("link"!==n&&(r.children=r.children.filter(e=>e!==t.current.id),r.next===t)){const e=r.children.at(-1),t=e?this.messages.get(e):null;if(void 0===t)throw new Error("MessageRepository(performOp/cut): Fallback sibling message not found. This is likely an internal bug in assistant-ui.");r.next=t}if("cut"!==n){for(let r=e;r;r=r.prev)if(r.current.id===t.current.id)throw new Error("MessageRepository(performOp/link): A message with the same id already exists in the parent tree. This error occurs if the same message id is found multiple times. This is likely an internal bug in assistant-ui.");s.children=[...s.children,t.current.id],be(t)!==this.head&&null!==s.next||(s.next=t),t.prev=e;const n=e?e.level+1:0;this.updateLevels(t,n)}}}get headId(){var e;return(null==(e=this.head)?void 0:e.current.id)??null}getMessages(e){var t;if(void 0===e||e===(null==(t=this.head)?void 0:t.current.id))return this._messages.value;const n=this.messages.get(e);if(!n)throw new Error("MessageRepository(getMessages): Head message not found. This is likely an internal bug in assistant-ui.");const r=new Array(n.level+1);for(let s=n;s;s=s.prev)r[s.level]=s.current;return r}addOrUpdateMessage(e,t){const n=this.messages.get(t.id),r=e?this.messages.get(e):null;if(void 0===r)throw new Error("MessageRepository(addOrUpdateMessage): Parent message not found. This is likely an internal bug in assistant-ui.");if(n)return n.current=t,this.performOp(r,n,"relink"),void this._messages.dirty();const s={prev:r,current:t,next:null,children:[],level:r?r.level+1:0};this.messages.set(t.id,s),this.performOp(r,s,"link"),this.head===r&&(this.head=s),this._messages.dirty()}getMessage(e){var t;const n=this.messages.get(e);if(!n)throw new Error("MessageRepository(updateMessage): Message not found. This is likely an internal bug in assistant-ui.");return{parentId:(null==(t=n.prev)?void 0:t.current.id)??null,message:n.current,index:n.level}}appendOptimisticMessage(e,t){let n;do{n=F()}while(this.messages.has(n));return this.addOrUpdateMessage(e,ve(t,n,{type:"running"})),n}deleteMessage(e,t){const n=this.messages.get(e);if(!n)throw new Error("MessageRepository(deleteMessage): Message not found. This is likely an internal bug in assistant-ui.");const r=void 0===t?n.prev:null===t?null:this.messages.get(t);if(void 0===r)throw new Error("MessageRepository(deleteMessage): Replacement not found. This is likely an internal bug in assistant-ui.");for(const s of n.children){const e=this.messages.get(s);if(!e)throw new Error("MessageRepository(deleteMessage): Child message not found. This is likely an internal bug in assistant-ui.");this.performOp(r,e,"relink")}this.performOp(null,n,"cut"),this.messages.delete(e),this.head===n&&(this.head=be(r??this.root)),this._messages.dirty()}getBranches(e){const t=this.messages.get(e);if(!t)throw new Error("MessageRepository(getBranches): Message not found. This is likely an internal bug in assistant-ui.");const{children:n}=t.prev??this.root;return n}switchToBranch(e){const t=this.messages.get(e);if(!t)throw new Error("MessageRepository(switchToBranch): Branch not found. This is likely an internal bug in assistant-ui.");(t.prev??this.root).next=t,this.head=be(t),this._messages.dirty()}resetHead(e){if(null===e)return void this.clear();const t=this.messages.get(e);if(!t)throw new Error("MessageRepository(resetHead): Branch not found. This is likely an internal bug in assistant-ui.");if(t.children.length>0){const e=t=>{for(const n of t.children){const t=this.messages.get(n);t&&(e(t),this.messages.delete(n))}};e(t),t.children=[],t.next=null}this.head=t;for(let n=t;n;n=n.prev)n.prev&&(n.prev.next=n);this._messages.dirty()}clear(){this.messages.clear(),this.head=null,this.root={children:[],next:null},this._messages.dirty()}export(){var e,t;const n=[];for(const[,r]of this.messages)n.push({message:r.current,parentId:(null==(e=r.prev)?void 0:e.current.id)??null});return{headId:(null==(t=this.head)?void 0:t.current.id)??null,messages:n}}import({headId:e,messages:t}){var n;for(const{message:r,parentId:s}of t)this.addOrUpdateMessage(s,r);this.resetHead(e??(null==(n=t.at(-1))?void 0:n.message.id)??null)}}class _e{constructor(){d(this,"_subscriptions",new Set),d(this,"_connection")}get isConnected(){return!!this._connection}notifySubscribers(){for(const e of this._subscriptions)e()}_updateConnection(){var e;if(this._subscriptions.size>0){if(this._connection)return;this._connection=this._connect()}else null==(e=this._connection)||e.call(this),this._connection=void 0}subscribe(e){return this._subscriptions.add(e),this._updateConnection(),()=>{this._subscriptions.delete(e),this._updateConnection()}}}const Se=Symbol("skip-update");class Ee extends _e{constructor(e){super(),d(this,"binding"),d(this,"_previousStateDirty",!0),d(this,"_previousState"),d(this,"getState",()=>{if(!this.isConnected||this._previousStateDirty){const e=this.binding.getState();e!==Se&&(this._previousState=e),this._previousStateDirty=!1}if(void 0===this._previousState)throw new Error("Entry not available in the store");return this._previousState}),this.binding=e}get path(){return this.binding.path}_connect(){return this.binding.subscribe(()=>{this._previousStateDirty=!0,this.notifySubscribers()})}}class Ie{constructor(e,t){d(this,"_core"),d(this,"_threadListBinding"),this._core=e,this._threadListBinding=t,this.__internal_bindMethods()}get path(){return this._core.path}__internal_bindMethods(){this.switchTo=this.switchTo.bind(this),this.rename=this.rename.bind(this),this.archive=this.archive.bind(this),this.unarchive=this.unarchive.bind(this),this.delete=this.delete.bind(this),this.initialize=this.initialize.bind(this),this.generateTitle=this.generateTitle.bind(this),this.subscribe=this.subscribe.bind(this),this.unstable_on=this.unstable_on.bind(this),this.getState=this.getState.bind(this),this.detach=this.detach.bind(this)}getState(){return this._core.getState()}switchTo(){const e=this._core.getState();return this._threadListBinding.switchToThread(e.id)}rename(e){const t=this._core.getState();return this._threadListBinding.rename(t.id,e)}archive(){const e=this._core.getState();return this._threadListBinding.archive(e.id)}unarchive(){const e=this._core.getState();return this._threadListBinding.unarchive(e.id)}delete(){const e=this._core.getState();return this._threadListBinding.delete(e.id)}initialize(){const e=this._core.getState();return this._threadListBinding.initialize(e.id)}generateTitle(){const e=this._core.getState();return this._threadListBinding.generateTitle(e.id)}unstable_on(e,t){let n=this._core.getState().isMain,r=this._core.getState().id;return this.subscribe(()=>{const s=this._core.getState(),i=s.isMain,o=s.id;n===i&&r===o||(n=i,r=o,("switched-to"!==e||i)&&("switched-away"===e&&i||t()))})}subscribe(e){return this._core.subscribe(e)}detach(){const e=this._core.getState();this._threadListBinding.detach(e.id)}__internal_getRuntime(){return this}}class Te extends _e{constructor(e){super(),d(this,"binding"),d(this,"_previousState"),d(this,"getState",()=>(this.isConnected||this._syncState(),this._previousState)),this.binding=e;const t=e.getState();if(t===Se)throw new Error("Entry not available in the store");this._previousState=t}get path(){return this.binding.path}_syncState(){const e=this.binding.getState();return e!==Se&&(!function(e,t){if(void 0===e&&void 0===t)return!0;if(void 0===e)return!1;if(void 0===t)return!1;for(const n of Object.keys(e)){const r=e[n],s=t[n];if(!Object.is(r,s))return!1}return!0}(e,this._previousState)&&(this._previousState=e,!0))}_connect(){return this.binding.subscribe(()=>{this._syncState()&&this.notifySubscribers()})}}const Ce=Symbol("innerMessage"),Re=e=>e.content.filter(e=>"text"===e.type).map(e=>e.text).join("\n\n");class ke{constructor(e){d(this,"_core"),this._core=e,this.__internal_bindMethods()}get path(){return this._core.path}__internal_bindMethods(){this.getState=this.getState.bind(this),this.remove=this.remove.bind(this),this.subscribe=this.subscribe.bind(this)}getState(){return this._core.getState()}subscribe(e){return this._core.subscribe(e)}}class Ae extends ke{constructor(e,t){super(e),d(this,"_composerApi"),this._composerApi=t}remove(){const e=this._composerApi.getState();if(!e)throw new Error("Composer is not available");return e.removeAttachment(this.getState().id)}}class je extends Ae{get source(){return"thread-composer"}}class Me extends Ae{get source(){return"edit-composer"}}class Ne extends ke{get source(){return"message"}constructor(e){super(e)}remove(){throw new Error("Message attachments cannot be removed")}}class Pe extends _e{constructor(e){super(),d(this,"config"),this.config=e}getState(){return this.config.binding.getState()}outerSubscribe(e){return this.config.binding.subscribe(e)}_connect(){const e=()=>{this.notifySubscribers()};let t=this.config.binding.getState(),n=null==t?void 0:t.unstable_on(this.config.event,e);const r=this.outerSubscribe(()=>{var r;const s=this.config.binding.getState();s!==t&&(t=s,null==n||n(),n=null==(r=this.config.binding.getState())?void 0:r.unstable_on(this.config.event,e))});return()=>{null==r||r(),null==n||n()}}}const Oe=Object.freeze([]),Le=Object.freeze({});class Be{constructor(e){d(this,"_core"),d(this,"_eventSubscriptionSubjects",new Map),this._core=e}get path(){return this._core.path}__internal_bindMethods(){this.setText=this.setText.bind(this),this.setRunConfig=this.setRunConfig.bind(this),this.getState=this.getState.bind(this),this.subscribe=this.subscribe.bind(this),this.addAttachment=this.addAttachment.bind(this),this.reset=this.reset.bind(this),this.clearAttachments=this.clearAttachments.bind(this),this.send=this.send.bind(this),this.cancel=this.cancel.bind(this),this.setRole=this.setRole.bind(this),this.getAttachmentByIndex=this.getAttachmentByIndex.bind(this),this.unstable_on=this.unstable_on.bind(this)}setText(e){const t=this._core.getState();if(!t)throw new Error("Composer is not available");t.setText(e)}setRunConfig(e){const t=this._core.getState();if(!t)throw new Error("Composer is not available");t.setRunConfig(e)}addAttachment(e){const t=this._core.getState();if(!t)throw new Error("Composer is not available");return t.addAttachment(e)}reset(){const e=this._core.getState();if(!e)throw new Error("Composer is not available");return e.reset()}clearAttachments(){const e=this._core.getState();if(!e)throw new Error("Composer is not available");return e.clearAttachments()}send(){const e=this._core.getState();if(!e)throw new Error("Composer is not available");e.send()}cancel(){const e=this._core.getState();if(!e)throw new Error("Composer is not available");e.cancel()}setRole(e){const t=this._core.getState();if(!t)throw new Error("Composer is not available");t.setRole(e)}subscribe(e){return this._core.subscribe(e)}unstable_on(e,t){let n=this._eventSubscriptionSubjects.get(e);return n||(n=new Pe({event:e,binding:this._core}),this._eventSubscriptionSubjects.set(e,n)),n.subscribe(t)}}class De extends Be{constructor(e){const t=new Ee({path:e.path,getState:()=>{return t=e.getState(),Object.freeze({type:"thread",isEditing:(null==t?void 0:t.isEditing)??!1,canCancel:(null==t?void 0:t.canCancel)??!1,isEmpty:(null==t?void 0:t.isEmpty)??!0,attachments:(null==t?void 0:t.attachments)??Oe,text:(null==t?void 0:t.text)??"",role:(null==t?void 0:t.role)??"user",runConfig:(null==t?void 0:t.runConfig)??Le,attachmentAccept:(null==t?void 0:t.attachmentAccept)??"",value:(null==t?void 0:t.text)??""});var t},subscribe:t=>e.subscribe(t)});super({path:e.path,getState:()=>e.getState(),subscribe:e=>t.subscribe(e)}),d(this,"_getState"),this._getState=t.getState.bind(t),this.__internal_bindMethods()}get path(){return this._core.path}get type(){return"thread"}getState(){return this._getState()}getAttachmentByIndex(e){return new je(new Te({path:{...this.path,attachmentSource:"thread-composer",attachmentSelector:{type:"index",index:e},ref:`${this.path.ref}${this.path.ref}.attachments[${e}]`},getState:()=>{const t=this.getState().attachments[e];return t?{...t,source:"thread-composer"}:Se},subscribe:e=>this._core.subscribe(e)}),this._core)}}class Fe extends Be{constructor(e,t){const n=new Ee({path:e.path,getState:()=>{return t=e.getState(),Object.freeze({type:"edit",isEditing:(null==t?void 0:t.isEditing)??!1,canCancel:(null==t?void 0:t.canCancel)??!1,isEmpty:(null==t?void 0:t.isEmpty)??!0,text:(null==t?void 0:t.text)??"",role:(null==t?void 0:t.role)??"user",attachments:(null==t?void 0:t.attachments)??Oe,runConfig:(null==t?void 0:t.runConfig)??Le,attachmentAccept:(null==t?void 0:t.attachmentAccept)??"",value:(null==t?void 0:t.text)??""});var t},subscribe:t=>e.subscribe(t)});super({path:e.path,getState:()=>e.getState(),subscribe:e=>n.subscribe(e)}),d(this,"_beginEdit"),d(this,"_getState"),this._beginEdit=t,this._getState=n.getState.bind(n),this.__internal_bindMethods()}get path(){return this._core.path}get type(){return"edit"}__internal_bindMethods(){super.__internal_bindMethods(),this.beginEdit=this.beginEdit.bind(this)}getState(){return this._getState()}beginEdit(){this._beginEdit()}getAttachmentByIndex(e){return new Me(new Te({path:{...this.path,attachmentSource:"edit-composer",attachmentSelector:{type:"index",index:e},ref:`${this.path.ref}${this.path.ref}.attachments[${e}]`},getState:()=>{const t=this.getState().attachments[e];return t?{...t,source:"edit-composer"}:Se},subscribe:e=>this._core.subscribe(e)}),this._core)}}class $e{constructor(e=null){d(this,"_state"),this._state=e}get state(){return this._state}append(e){this._state=e.reduce((e,t)=>$e.apply(e,t),this._state)}static apply(e,t){const n=t.type;switch(n){case"set":return $e.updatePath(e,t.path,()=>t.value);case"append-text":return $e.updatePath(e,t.path,e=>{if("string"!=typeof e)throw new Error(`Expected string at path [${t.path.join(", ")}]`);return e+t.value});default:throw new Error(`Invalid operation type: ${n}`)}}static updatePath(e,t,n){if(0===t.length)return n(e);if(e??(e={}),"object"!=typeof e)throw new Error(`Invalid path: [${t.join(", ")}]`);const[r,...s]=t;if(Array.isArray(e)){const i=Number(r);if(Number.isNaN(i))throw new Error(`Expected array index at [${t.join(", ")}]`);if(i>e.length||i<0)throw new Error("Insert array index out of bounds");const o=[...e];return o[i]=this.updatePath(o[i],s,n),o}const i={...e};return i[r]=this.updatePath(i[r],s,n),i}}const Ue=({unstable_state:e=null}={})=>({role:"assistant",status:{type:"running"},parts:[],get content(){return this.parts},metadata:{unstable_state:e,unstable_data:[],unstable_annotations:[],steps:[],custom:{}}}),ze=(e,t,n)=>{if(0===e.parts.length)throw new Error("No parts available to update.");if(1!==t.path.length)throw new Error("Nested paths are not supported yet.");const r=t.path[0],s=n(e.parts[r]);return{...e,parts:[...e.parts.slice(0,r),s,...e.parts.slice(r+1)],get content(){return this.parts}}},We=(e,t)=>{const n=t.part;if("text"===n.type||"reasoning"===n.type){const t={type:n.type,text:"",status:{type:"running"},...n.parentId&&{parentId:n.parentId}};return{...e,parts:[...e.parts,t],get content(){return this.parts}}}if("tool-call"===n.type){const t={type:"tool-call",state:"partial-call",status:{type:"running",isArgsComplete:!1},toolCallId:n.toolCallId,toolName:n.toolName,argsText:"",args:{},...n.parentId&&{parentId:n.parentId}};return{...e,parts:[...e.parts,t],get content(){return this.parts}}}if("source"===n.type){const t={type:"source",sourceType:n.sourceType,id:n.id,url:n.url,...n.title?{title:n.title}:void 0,...n.parentId&&{parentId:n.parentId}};return{...e,parts:[...e.parts,t],get content(){return this.parts}}}if("file"===n.type){const t={type:"file",mimeType:n.mimeType,data:n.data};return{...e,parts:[...e.parts,t],get content(){return this.parts}}}throw new Error(`Unsupported part type: ${n.type}`)},He=(e,t)=>{var n,r;if("incomplete"===(null==(n=e.status)?void 0:n.type)&&"error"===(null==(r=e.status)?void 0:r.reason))return e;const s=Ve(t);return{...e,status:s}},Ve=e=>"tool-calls"===e.finishReason?{type:"requires-action",reason:"tool-calls"}:"stop"===e.finishReason||"unknown"===e.finishReason?{type:"complete",reason:e.finishReason}:{type:"incomplete",reason:e.finishReason};class qe extends TransformStream{constructor({initialMessage:e,throttle:t,onError:n}={}){let r,s=e??Ue();const i=t?(e=>{let t=!1;return()=>{t||(t=!0,queueMicrotask(()=>{t=!1,e()}))}})(()=>{null==r||r.enqueue(s)}):()=>{null==r||r.enqueue(s)};super({start(e){r=e},transform(e){const t=e.type;switch(t){case"part-start":s=We(s,e);break;case"tool-call-args-text-finish":s=((e,t)=>ze(e,t,e=>{if("tool-call"!==e.type)throw new Error("Last is not a tool call");return"partial-call"!==e.state?e:{...e,state:"call"}}))(s,e);break;case"part-finish":s=((e,t)=>ze(e,t,e=>({...e,status:{type:"complete",reason:"unknown"}})))(s,e);break;case"text-delta":s=((e,t)=>ze(e,t,e=>{if("text"===e.type||"reasoning"===e.type)return{...e,text:e.text+t.textDelta};if("tool-call"===e.type){const n=e.argsText+t.textDelta,r=ee(n)??e.args;return{...e,argsText:n,args:r}}throw new Error("text-delta received but part is neither text nor tool-call")}))(s,e);break;case"result":s=((e,t)=>ze(e,t,e=>{if("tool-call"===e.type)return{...e,state:"result",...void 0!==t.artifact?{artifact:t.artifact}:{},result:t.result,isError:t.isError??!1,status:{type:"complete",reason:"stop"}};throw new Error("Result chunk received but part is not a tool-call")}))(s,e);break;case"message-finish":s=He(s,e);break;case"annotations":s=((e,t)=>({...e,metadata:{...e.metadata,unstable_annotations:[...e.metadata.unstable_annotations,...t.annotations]}}))(s,e);break;case"data":s=((e,t)=>({...e,metadata:{...e.metadata,unstable_data:[...e.metadata.unstable_data,...t.data]}}))(s,e);break;case"step-start":s=((e,t)=>({...e,metadata:{...e.metadata,steps:[...e.metadata.steps,{state:"started",messageId:t.messageId}]}}))(s,e);break;case"step-finish":s=((e,t)=>{var n;const r=e.metadata.steps.slice(),s=r.length-1;return r.length>0&&"started"===(null==(n=r[s])?void 0:n.state)?r[s]={...r[s],state:"finished",finishReason:t.finishReason,usage:t.usage,isContinued:t.isContinued}:r.push({state:"finished",messageId:pe(),finishReason:t.finishReason,usage:t.usage,isContinued:t.isContinued}),{...e,metadata:{...e.metadata,steps:r}}})(s,e);break;case"error":s=((e,t)=>({...e,status:{type:"incomplete",reason:"error",error:t.error}}))(s,e),null==n||n(e.error);break;case"update-state":s=((e,t)=>{const n=new $e(e.metadata.unstable_state);return n.append(t.operations),{...e,metadata:{...e.metadata,unstable_state:n.state}}})(s,e);break;default:throw new Error(`Unsupported chunk type: ${t}`)}i()},flush(e){var t,n;if("running"===(null==(t=s.status)?void 0:t.type)){const t=(null==(n=s.parts)?void 0:n.some(e=>"tool-call"===e.type&&("call"===e.state||"partial-call"===e.state)&&void 0===e.result))??!1;s=He(s,{finishReason:t?"tool-calls":"unknown"}),e.enqueue(s)}}})}}class Je extends he{constructor(){super(e=>{const t=new ge({transform(e,t){t.appendText(e)}});return e.pipeThrough(new TextDecoderStream).pipeThrough(t)})}}class Ye{constructor(e){d(this,"readable"),this.readable=e,this.readable=e}static fromAssistantStream(e){return new Ye(e.pipeThrough(new qe))}async unstable_result(){let e;for await(const t of this)e=t;return e||{role:"assistant",status:{type:"complete",reason:"unknown"},parts:[],content:[],metadata:{unstable_state:null,unstable_data:[],unstable_annotations:[],steps:[],custom:{}}}}[Symbol.asyncIterator](){const e=this.readable.getReader();return{async next(){const{done:t,value:n}=await e.read();return t?{done:!0,value:void 0}:{done:!1,value:n}}}}tee(){const[e,t]=this.readable.tee();return[new Ye(e),new Ye(t)]}}const Ke=Symbol.for("aui.tool-response");class Ge{constructor(e){d(this,"artifact"),d(this,"result"),d(this,"isError"),void 0!==e.artifact&&(this.artifact=e.artifact),this.result=e.result,this.isError=e.isError??!1}get[Ke](){return!0}static[Symbol.hasInstance](e){return"object"==typeof e&&null!==e&&Ke in e}static toResponse(e){return e instanceof Ge?e:new Ge({result:void 0===e?"<no result>":e})}}class Xe{constructor(e,t,n){d(this,"contentBinding"),d(this,"messageApi"),d(this,"threadApi"),this.contentBinding=e,this.messageApi=t,this.threadApi=n,this.__internal_bindMethods()}get path(){return this.contentBinding.path}__internal_bindMethods(){this.addToolResult=this.addToolResult.bind(this),this.resumeToolCall=this.resumeToolCall.bind(this),this.getState=this.getState.bind(this),this.subscribe=this.subscribe.bind(this)}getState(){return this.contentBinding.getState()}addToolResult(e){const t=this.contentBinding.getState();if(!t)throw new Error("Message part is not available");if("tool-call"!==t.type)throw new Error("Tried to add tool result to non-tool message part");if(!this.messageApi)throw new Error("Message API is not available. This is likely a bug in assistant-ui.");if(!this.threadApi)throw new Error("Thread API is not available");const n=this.messageApi.getState();if(!n)throw new Error("Message is not available");const r=t.toolName,s=t.toolCallId,i=Ge.toResponse(e);this.threadApi.getState().addToolResult({messageId:n.id,toolName:r,toolCallId:s,result:i.result,artifact:i.artifact,isError:i.isError})}resumeToolCall(e){const t=this.contentBinding.getState();if(!t)throw new Error("Message part is not available");if("tool-call"!==t.type)throw new Error("Tried to resume tool call on non-tool message part");if(!this.threadApi)throw new Error("Thread API is not available");const n=t.toolCallId;this.threadApi.getState().resumeToolCall({toolCallId:n,payload:e})}subscribe(e){return this.contentBinding.subscribe(e)}}class Ze extends _e{constructor(e){super(),d(this,"binding"),this.binding=e}get path(){return this.binding.path}getState(){return this.binding.getState()}outerSubscribe(e){return this.binding.subscribe(e)}_connect(){const e=()=>{this.notifySubscribers()};let t=this.binding.getState(),n=null==t?void 0:t.subscribe(e);const r=this.outerSubscribe(()=>{var r;const s=this.binding.getState();s!==t&&(t=s,null==n||n(),n=null==(r=this.binding.getState())?void 0:r.subscribe(e),e())});return()=>{null==r||r(),null==n||n()}}}const Qe=Object.freeze({type:"complete"}),et=(e,t)=>{const n=e.content[t];if(!n)return Se;const r=((e,t,n)=>{if("assistant"!==e.role)return Qe;if("tool-call"===n.type)return n.result?Qe:e.status;const r=t===Math.max(0,e.content.length-1);return"requires-action"===e.status.type?Qe:r?e.status:Qe})(e,t,n);return Object.freeze({...n,[Ce]:n[Ce],status:r})};class tt{constructor(e,t){d(this,"_core"),d(this,"_threadBinding"),d(this,"composer"),d(this,"_getEditComposerRuntimeCore",()=>this._threadBinding.getState().getEditComposer(this._core.getState().id)),this._core=e,this._threadBinding=t,this.composer=new Fe(new Ze({path:{...this.path,ref:`${this.path.ref}${this.path.ref}.composer`,composerSource:"edit"},getState:this._getEditComposerRuntimeCore,subscribe:e=>this._threadBinding.subscribe(e)}),()=>this._threadBinding.getState().beginEdit(this._core.getState().id)),this.__internal_bindMethods()}get path(){return this._core.path}__internal_bindMethods(){this.reload=this.reload.bind(this),this.getState=this.getState.bind(this),this.subscribe=this.subscribe.bind(this),this.getMessagePartByIndex=this.getMessagePartByIndex.bind(this),this.getMessagePartByToolCallId=this.getMessagePartByToolCallId.bind(this),this.getAttachmentByIndex=this.getAttachmentByIndex.bind(this),this.unstable_getCopyText=this.unstable_getCopyText.bind(this),this.speak=this.speak.bind(this),this.stopSpeaking=this.stopSpeaking.bind(this),this.submitFeedback=this.submitFeedback.bind(this),this.switchToBranch=this.switchToBranch.bind(this)}getState(){return this._core.getState()}reload(e={}){const t=this._getEditComposerRuntimeCore(),n=t??this._threadBinding.getState().composer,r=t??n,{runConfig:s=r.runConfig}=e,i=this._core.getState();if("assistant"!==i.role)throw new Error("Can only reload assistant messages");this._threadBinding.getState().startRun({parentId:i.parentId,sourceId:i.id,runConfig:s})}speak(){const e=this._core.getState();return this._threadBinding.getState().speak(e.id)}stopSpeaking(){var e;const t=this._core.getState();if((null==(e=this._threadBinding.getState().speech)?void 0:e.messageId)!==t.id)throw new Error("Message is not being spoken");this._threadBinding.getState().stopSpeaking()}submitFeedback({type:e}){const t=this._core.getState();this._threadBinding.getState().submitFeedback({messageId:t.id,type:e})}switchToBranch({position:e,branchId:t}){const n=this._core.getState();if(t&&e)throw new Error("May not specify both branchId and position");if(!t&&!e)throw new Error("Must specify either branchId or position");const r=this._threadBinding.getState().getBranches(n.id);let s=t;if("previous"===e?s=r[n.branchNumber-2]:"next"===e&&(s=r[n.branchNumber]),!s)throw new Error("Branch not found");this._threadBinding.getState().switchToBranch(s)}unstable_getCopyText(){return Re(this.getState())}subscribe(e){return this._core.subscribe(e)}getMessagePartByIndex(e){if(e<0)throw new Error("Message part index must be >= 0");return new Xe(new Te({path:{...this.path,ref:`${this.path.ref}${this.path.ref}.content[${e}]`,messagePartSelector:{type:"index",index:e}},getState:()=>et(this.getState(),e),subscribe:e=>this._core.subscribe(e)}),this._core,this._threadBinding)}getMessagePartByToolCallId(e){return new Xe(new Te({path:{...this.path,ref:this.path.ref+`${this.path.ref}.content[toolCallId=${JSON.stringify(e)}]`,messagePartSelector:{type:"toolCallId",toolCallId:e}},getState:()=>{const t=this._core.getState(),n=t.content.findIndex(t=>"tool-call"===t.type&&t.toolCallId===e);return-1===n?Se:et(t,n)},subscribe:e=>this._core.subscribe(e)}),this._core,this._threadBinding)}getAttachmentByIndex(e){return new Ne(new Te({path:{...this.path,ref:`${this.path.ref}${this.path.ref}.attachments[${e}]`,attachmentSource:"message",attachmentSelector:{type:"index",index:e}},getState:()=>{const t=this.getState().attachments,n=null==t?void 0:t[e];return n?{...n,source:"message"}:Se},subscribe:e=>this._core.subscribe(e)}))}}class nt{constructor(e,t){d(this,"_threadBinding"),d(this,"composer"),d(this,"_eventSubscriptionSubjects",new Map);const n=new Te({path:e.path,getState:()=>((e,t)=>{const n=e.messages.at(-1);return Object.freeze({threadId:t.id,metadata:t,capabilities:e.capabilities,isDisabled:e.isDisabled,isLoading:e.isLoading,isRunning:"assistant"===(null==n?void 0:n.role)&&"running"===n.status.type,messages:e.messages,state:e.state,suggestions:e.suggestions,extras:e.extras,speech:e.speech})})(e.getState(),t.getState()),subscribe:n=>{const r=e.subscribe(n),s=t.subscribe(n);return()=>{r(),s()}}});this._threadBinding={path:e.path,getState:()=>e.getState(),getStateState:()=>n.getState(),outerSubscribe:t=>e.outerSubscribe(t),subscribe:t=>e.subscribe(t)},this.composer=new De(new Ze({path:{...this.path,ref:`${this.path.ref}${this.path.ref}.composer`,composerSource:"thread"},getState:()=>this._threadBinding.getState().composer,subscribe:e=>this._threadBinding.subscribe(e)})),this.__internal_bindMethods()}get path(){return this._threadBinding.path}get __internal_threadBinding(){return this._threadBinding}__internal_bindMethods(){this.append=this.append.bind(this),this.unstable_resumeRun=this.unstable_resumeRun.bind(this),this.unstable_loadExternalState=this.unstable_loadExternalState.bind(this),this.startRun=this.startRun.bind(this),this.cancelRun=this.cancelRun.bind(this),this.stopSpeaking=this.stopSpeaking.bind(this),this.export=this.export.bind(this),this.import=this.import.bind(this),this.reset=this.reset.bind(this),this.getMessageByIndex=this.getMessageByIndex.bind(this),this.getMessageById=this.getMessageById.bind(this),this.subscribe=this.subscribe.bind(this),this.unstable_on=this.unstable_on.bind(this),this.getModelContext=this.getModelContext.bind(this),this.getModelConfig=this.getModelConfig.bind(this),this.getState=this.getState.bind(this)}getState(){return this._threadBinding.getStateState()}append(e){this._threadBinding.getState().append(((e,t)=>{var n,r;return"string"==typeof t?{createdAt:new Date,parentId:(null==(n=e.at(-1))?void 0:n.id)??null,sourceId:null,runConfig:{},role:"user",content:[{type:"text",text:t}],attachments:[],metadata:{custom:{}}}:{createdAt:t.createdAt??new Date,parentId:t.parentId??(null==(r=e.at(-1))?void 0:r.id)??null,sourceId:t.sourceId??null,role:t.role??"user",content:t.content,attachments:t.attachments??[],metadata:t.metadata??{custom:{}},runConfig:t.runConfig??{},startRun:t.startRun}})(this._threadBinding.getState().messages,e))}subscribe(e){return this._threadBinding.subscribe(e)}getModelContext(){return this._threadBinding.getState().getModelContext()}getModelConfig(){return this.getModelContext()}startRun(e){const t=null===e||"string"==typeof e?{parentId:e}:e;return this._threadBinding.getState().startRun({parentId:(n=t).parentId??null,sourceId:n.sourceId??null,runConfig:n.runConfig??{}});var n}unstable_resumeRun(e){return this._threadBinding.getState().resumeRun({parentId:(t=e).parentId??null,sourceId:t.sourceId??null,runConfig:t.runConfig??{},...t.stream?{stream:t.stream}:{}});var t}unstable_loadExternalState(e){this._threadBinding.getState().unstable_loadExternalState(e)}cancelRun(){this._threadBinding.getState().cancelRun()}stopSpeaking(){return this._threadBinding.getState().stopSpeaking()}export(){return this._threadBinding.getState().export()}import(e){this._threadBinding.getState().import(e)}reset(e){this._threadBinding.getState().reset(e)}getMessageByIndex(e){if(e<0)throw new Error("Message index must be >= 0");return this._getMessageRuntime({...this.path,ref:`${this.path.ref}${this.path.ref}.messages[${e}]`,messageSelector:{type:"index",index:e}},()=>{var t;const n=this._threadBinding.getState().messages,r=n[e];if(r)return{message:r,parentId:(null==(t=n[e-1])?void 0:t.id)??null,index:e}})}getMessageById(e){return this._getMessageRuntime({...this.path,ref:this.path.ref+`${this.path.ref}.messages[messageId=${JSON.stringify(e)}]`,messageSelector:{type:"messageId",messageId:e}},()=>this._threadBinding.getState().getMessageById(e))}_getMessageRuntime(e,t){return new tt(new Te({path:e,getState:()=>{var e;const{message:n,parentId:r,index:s}=t()??{},{messages:i,speech:o}=this._threadBinding.getState();if(!n||void 0===r||void 0===s)return Se;const a=this._threadBinding.getState().getBranches(n.id),c=n.metadata.submittedFeedback;return{...n,[Ce]:n[Ce],index:s,isLast:(null==(e=i.at(-1))?void 0:e.id)===n.id,parentId:r,branchNumber:a.indexOf(n.id)+1,branchCount:a.length,speech:(null==o?void 0:o.messageId)===n.id?o:void 0,submittedFeedback:c}},subscribe:e=>this._threadBinding.subscribe(e)}),this._threadBinding)}unstable_on(e,t){let n=this._eventSubscriptionSubjects.get(e);return n||(n=new Pe({event:e,binding:this._threadBinding}),this._eventSubscriptionSubjects.set(e,n)),n.subscribe(t)}}const rt=(e,t)=>{if(void 0===t)return Se;const n=e.getItemById(t);return n?{id:n.id,threadId:n.id,remoteId:n.remoteId,externalId:n.externalId,title:n.title,status:n.status,isMain:n.id===e.mainThreadId}:Se};class st{constructor(e,t=nt){d(this,"_core"),d(this,"_runtimeFactory"),d(this,"_getState"),d(this,"_mainThreadListItemRuntime"),d(this,"main"),this._core=e,this._runtimeFactory=t;const n=new Ee({path:{},getState:()=>{return{mainThreadId:(t=e).mainThreadId,newThread:t.newThreadId,threads:t.threadIds,archivedThreads:t.archivedThreadIds,isLoading:t.isLoading,threadItems:t.threadData};var t},subscribe:t=>e.subscribe(t)});this._getState=n.getState.bind(n),this._mainThreadListItemRuntime=new Ie(new Te({path:{ref:"threadItems[main]",threadSelector:{type:"main"}},getState:()=>rt(this._core,this._core.mainThreadId),subscribe:e=>this._core.subscribe(e)}),this._core),this.main=new t(new Ze({path:{ref:"threads.main",threadSelector:{type:"main"}},getState:()=>e.getMainThreadRuntimeCore(),subscribe:t=>e.subscribe(t)}),this._mainThreadListItemRuntime),this.__internal_bindMethods()}__internal_bindMethods(){this.switchToThread=this.switchToThread.bind(this),this.switchToNewThread=this.switchToNewThread.bind(this),this.getState=this.getState.bind(this),this.subscribe=this.subscribe.bind(this),this.getById=this.getById.bind(this),this.getItemById=this.getItemById.bind(this),this.getItemByIndex=this.getItemByIndex.bind(this),this.getArchivedItemByIndex=this.getArchivedItemByIndex.bind(this)}switchToThread(e){return this._core.switchToThread(e)}switchToNewThread(){return this._core.switchToNewThread()}getState(){return this._getState()}subscribe(e){return this._core.subscribe(e)}get mainItem(){return this._mainThreadListItemRuntime}getById(e){return new this._runtimeFactory(new Ze({path:{ref:`threads[threadId=${JSON.stringify(e)}]`,threadSelector:{type:"threadId",threadId:e}},getState:()=>this._core.getThreadRuntimeCore(e),subscribe:e=>this._core.subscribe(e)}),this.mainItem)}getItemByIndex(e){return new Ie(new Te({path:{ref:`threadItems[${e}]`,threadSelector:{type:"index",index:e}},getState:()=>rt(this._core,this._core.threadIds[e]),subscribe:e=>this._core.subscribe(e)}),this._core)}getArchivedItemByIndex(e){return new Ie(new Te({path:{ref:`archivedThreadItems[${e}]`,threadSelector:{type:"archiveIndex",index:e}},getState:()=>rt(this._core,this._core.archivedThreadIds[e]),subscribe:e=>this._core.subscribe(e)}),this._core)}getItemById(e){return new Ie(new Te({path:{ref:`threadItems[threadId=${e}]`,threadSelector:{type:"threadId",threadId:e}},getState:()=>rt(this._core,e),subscribe:e=>this._core.subscribe(e)}),this._core)}}class it{constructor(e){d(this,"cloud"),d(this,"accept","*"),d(this,"uploadedUrls",new Map),this.cloud=e}async*add({file:e}){const t=crypto.randomUUID();var n;let r={id:t,type:(n=e.type).startsWith("image/")?"image":n.startsWith("text/")?"document":"file",name:e.name,contentType:e.type,file:e,status:{type:"running",reason:"uploading",progress:0}};yield r;try{const{signedUrl:n,publicUrl:s}=await this.cloud.files.generatePresignedUploadUrl({filename:e.name});await fetch(n,{method:"PUT",body:e,headers:{"Content-Type":e.type},mode:"cors"}),this.uploadedUrls.set(t,s),r={...r,status:{type:"requires-action",reason:"composer-send"}},yield r}catch{r={...r,status:{type:"incomplete",reason:"error"}},yield r}}async remove(e){this.uploadedUrls.delete(e.id)}async send(e){const t=this.uploadedUrls.get(e.id);if(!t)throw new Error("Attachment not uploaded");let n;return this.uploadedUrls.delete(e.id),n="image"===e.type?[{type:"image",image:t,filename:e.name}]:[{type:"file",data:t,mimeType:e.contentType,filename:e.name}],{...e,status:{type:"complete"},content:n}}}const ot=t.createContext(null),at=({adapters:e,children:n})=>{const r=t.useContext(ot);return A.jsx(ot.Provider,{value:{...r,...e},children:n})};class ct extends O{constructor(e,t,{parentId:n,message:r}){super(),d(this,"runtime"),d(this,"endEditCallback"),d(this,"_nonTextParts"),d(this,"_previousText"),d(this,"_parentId"),d(this,"_sourceId"),this.runtime=e,this.endEditCallback=t,this._parentId=n,this._sourceId=r.id,this._previousText=Re(r),this.setText(this._previousText),this.setRole(r.role),this.setAttachments(r.attachments??[]),this._nonTextParts=r.content.filter(e=>"text"!==e.type),this.setRunConfig({...e.composer.runConfig})}get canCancel(){return!0}getAttachmentAdapter(){var e;return null==(e=this.runtime.adapters)?void 0:e.attachments}async handleSend(e){Re(e)!==this._previousText&&this.runtime.append({...e,content:[...e.content,...this._nonTextParts],parentId:this._parentId,sourceId:this._sourceId}),this.handleCancel()}handleCancel(){this.endEditCallback(),this._notifySubscribers()}}class lt{constructor(e){d(this,"_contextProvider"),d(this,"_subscriptions",new Set),d(this,"_isInitialized",!1),d(this,"repository",new xe),d(this,"composer",new L(this)),d(this,"_editComposers",new Map),d(this,"_stopSpeaking"),d(this,"speech"),d(this,"_eventSubscribers",new Map),this._contextProvider=e}get messages(){return this.repository.getMessages()}get state(){let e;for(const t of this.messages)if("assistant"===t.role){e=t;break}return(null==e?void 0:e.metadata.unstable_state)??null}getModelContext(){return this._contextProvider.getModelContext()}getEditComposer(e){return this._editComposers.get(e)}beginEdit(e){if(this._editComposers.has(e))throw new Error("Edit already in progress");this._editComposers.set(e,new ct(this,()=>this._editComposers.delete(e),this.repository.getMessage(e))),this._notifySubscribers()}getMessageById(e){try{return this.repository.getMessage(e)}catch{return}}getBranches(e){return this.repository.getBranches(e)}switchToBranch(e){this.repository.switchToBranch(e),this._notifySubscribers()}_notifySubscribers(){for(const e of this._subscriptions)e()}_notifyEventSubscribers(e){const t=this._eventSubscribers.get(e);if(t)for(const n of t)n()}subscribe(e){return this._subscriptions.add(e),()=>this._subscriptions.delete(e)}submitFeedback({messageId:e,type:t}){var n;const r=null==(n=this.adapters)?void 0:n.feedback;if(!r)throw new Error("Feedback adapter not configured");const{message:s,parentId:i}=this.repository.getMessage(e);if(r.submit({message:s,type:t}),"assistant"===s.role){const e={...s,metadata:{...s.metadata,submittedFeedback:{type:t}}};this.repository.addOrUpdateMessage(i,e)}this._notifySubscribers()}speak(e){var t,n;const r=null==(t=this.adapters)?void 0:t.speech;if(!r)throw new Error("Speech adapter not configured");const{message:s}=this.repository.getMessage(e);null==(n=this._stopSpeaking)||n.call(this);const i=r.speak(Re(s)),o=i.subscribe(()=>{"ended"===i.status.type?(this._stopSpeaking=void 0,this.speech=void 0):this.speech={messageId:e,status:i.status},this._notifySubscribers()});this.speech={messageId:e,status:i.status},this._notifySubscribers(),this._stopSpeaking=()=>{i.cancel(),o(),this.speech=void 0,this._stopSpeaking=void 0}}stopSpeaking(){if(!this._stopSpeaking)throw new Error("No message is being spoken");this._stopSpeaking(),this._notifySubscribers()}ensureInitialized(){this._isInitialized||(this._isInitialized=!0,this._notifyEventSubscribers("initialize"))}export(){return this.repository.export()}import(e){this.ensureInitialized(),this.repository.clear(),this.repository.import(e),this._notifySubscribers()}reset(e){this.import(ye(e??[]))}unstable_on(e,t){var n,r;if("model-context-update"===e)return(null==(r=(n=this._contextProvider).subscribe)?void 0:r.call(n,t))??(()=>{});const s=this._eventSubscribers.get(e);return s?s.add(t):this._eventSubscribers.set(e,new Set([t])),()=>{this._eventSubscribers.get(e).delete(t)}}}class ut{list(){return Promise.resolve({threads:[]})}rename(){return Promise.resolve()}archive(){return Promise.resolve()}unarchive(){return Promise.resolve()}delete(){return Promise.resolve()}initialize(e){return Promise.resolve({remoteId:e,externalId:void 0})}generateTitle(){return Promise.resolve(new ReadableStream)}fetch(e){return Promise.reject(new Error("Thread not found"))}}let dt=null;function ht(){if(!dt)throw new Error("No resource fiber available");return dt}function pt(e,t){const n=e[ft];if(!n)throw new Error("ResourceElement.type is not a valid Resource");return n(t)}const ft=Symbol("fnSymbol");function mt(e,t){return{resource:e,scheduleRerender:t,cells:[],currentIndex:0,renderContext:void 0,isFirstRender:!0,isMounted:!1,isNeverMounted:!0}}function gt(e){e.isMounted=!1,function(e){let t=null;for(let r=e.cells.length-1;r>=0;r--){const s=e.cells[r];if("effect"===(null==s?void 0:s.type)&&s.mounted&&s.cleanup)try{s.cleanup()}catch(n){null==t&&(t=n)}finally{s.mounted=!1}}if(null!=t)throw t}(e)}function vt(e,t){const n={commitTasks:[],props:t,state:void 0};return function(e,t){e.currentIndex=0;const n=dt;dt=e;try{if(t(),e.isFirstRender=!1,e.cells.length!==e.currentIndex)throw new Error(`Rendered ${e.currentIndex} hooks but expected ${e.cells.length}. Hooks must be called in the exact same order in every render.`)}finally{dt=n}}(e,()=>{e.renderContext=n;try{n.state=pt(e.resource,t)}finally{e.renderContext=void 0}}),n}function yt(e,t){e.isMounted=!0,e.isNeverMounted=!1,function(e,t){e.commitTasks.forEach(e=>{const n=e.cellIndex,r=t.cells[n];if("effect"!==r.type)throw new Error("Cannot find effect cell");let s=!0;if(void 0!==r.deps&&void 0!==e.deps&&(s=r.deps.length!==e.deps.length||r.deps.some((t,n)=>!Object.is(t,e.deps[n]))),s){if(r.mounted){if(typeof r.deps!=typeof e.deps)throw new Error("tapEffect called with and without dependencies across re-renders");try{r.mounted&&r.cleanup&&r.cleanup()}finally{r.mounted=!1}}const t=e.effect();if(void 0!==t&&"function"!=typeof t)throw new Error("An effect function must either return a cleanup function or nothing. Received: "+typeof t);r.mounted=!0,r.cleanup="function"==typeof t?t:void 0,r.deps=e.deps}})}(t,e)}const bt=!0===globalThis.__ASSISTANT_UI_DISABLE_LAYOUT_EFFECT__?t.useEffect:t.useLayoutEffect;function wt(e){const[,n]=t.useState({}),r=t.useMemo(()=>mt(e.type,()=>n({})),[e.type]),s=vt(r,e.props);return bt(()=>()=>gt(r),[r]),bt(()=>{yt(r,s)}),s.state}const xt=e=>{if("string"==typeof e){return{scope:e.split(".")[0],event:e}}return{scope:e.scope,event:e.event}},_t=(e,t,n)=>t===e;let St;const Et=()=>{if(St)return St;const e=()=>({apis:new Map,nextId:0,listeners:new Set});if("undefined"==typeof window)return St=e(),St;const t=window.__ASSISTANT_UI_DEVTOOLS_HOOK__;if(t)return St=t,t;const n=e();return window.__ASSISTANT_UI_DEVTOOLS_HOOK__=n,St=n,n},It=class e{static register(t){var n,r;const s=Et();for(const e of s.apis.values())if(e.api===t)return()=>{};const i=s.nextId++,o={api:t,logs:[]},a=null==(n=t.on)?void 0:n.call(t,"*",t=>{const n=s.apis.get(i);n&&(n.logs.push({time:new Date,event:t.event,data:t.payload}),n.logs.length>e.MAX_EVENT_LOGS_PER_API&&(n.logs=n.logs.slice(-200)),e.notifyListeners(i))}),c=null==(r=t.subscribe)?void 0:r.call(t,()=>{e.notifyListeners(i)});return s.apis.set(i,o),e.notifyListeners(i),()=>{const t=Et();t.apis.get(i)&&(null==a||a(),null==c||c(),t.apis.delete(i),e.notifyListeners(i))}}static notifyListeners(e){Et().listeners.forEach(t=>t(e))}};d(It,"MAX_EVENT_LOGS_PER_API",200);let Tt=It;function Ct(e){const t=e=>({type:t,props:e});return t[ft]=e,t}function Rt(e){const t=ht(),n=t.currentIndex++;if(!t.isFirstRender&&n>=t.cells.length)throw new Error("Rendered more hooks than during the previous render. Hooks must be called in the exact same order in every render.");if(!t.cells[n]){const r={type:"state",value:"function"==typeof e?e():e,set:e=>{const n=r.value,s="function"==typeof e?e(n):e;Object.is(n,s)||(r.value=s,(e=>{if(e.renderContext)throw new Error("Resource updated during render");if(e.isMounted)e.scheduleRerender();else if(e.isNeverMounted)throw new Error("Resource updated before mount")})(t))}};t.cells[n]=r}const r=t.cells[n];if("state"!==r.type)throw new Error("Hook order changed between renders");return r}function kt(e){const t=Rt(e);return[t.value,t.set]}function At(e,t){const n=ht(),r=function(){const e=ht(),t=e.currentIndex++;if(!e.isFirstRender&&t>=e.cells.length)throw new Error("Rendered more hooks than during the previous render. Hooks must be called in the exact same order in every render.");if(!e.cells[t]){const n={type:"effect",mounted:!1};e.cells[t]=n}if("effect"!==e.cells[t].type)throw new Error("Hook order changed between renders");return t}();n.renderContext.commitTasks.push({effect:e,deps:t,cellIndex:r})}function jt(e){const[t]=kt(()=>({current:e}));return t}const Mt=(e,t)=>{const n=jt();return n.current||(n.current={value:e(),deps:t}),((e,t)=>{if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Object.is(e[n],t[n]))return!1;return!0})(n.current.deps,t)||(n.current.value=e(),n.current.deps=t),n.current.value};function Nt(e,t){const[n,r]=kt({}),s=Mt(()=>mt(e.type,()=>r({})),[e.type]),i=t?Mt(()=>e.props,t):e.props,o=Mt(()=>vt(s,i),[s,i,n]);return At(()=>()=>gt(s),[s]),At(()=>{yt(s,o)},[s,o]),o.state}function Pt(e){return pt(e.type,e.props)}function Ot(e,t,n){const[r,s]=kt(0),i=(o=()=>s(e=>e+1),Mt(()=>o,[]));var o;const[a]=kt(()=>new Map),c=Mt(()=>t,n),l=Mt(()=>{const t={remove:[],add:[],commit:[],return:{}};for(const n in e){const r=e[n],s=c(r,n);let o=a.get(n);o&&o.resource===s.type||(o&&t.remove.push(n),o=mt(s.type,i),t.add.push([n,o]));const l=vt(o,s.props);t.commit.push([n,l]),t.return[n]=l.state}if(a.size>t.commit.length-t.add.length+t.remove.length)for(const n of a.keys())n in e||t.remove.push(n);return t},[e,c,r]);return At(()=>()=>{for(const e of a.keys())gt(a.get(e)),a.delete(e)},[]),At(()=>{for(const e of l.remove)gt(a.get(e)),a.delete(e);for(const[e,t]of l.add)a.set(e,t);for(const[e,t]of l.commit)yt(a.get(e),t)},[l]),l.return}let Lt={schedulers:new Set([]),isScheduled:!1};class Bt{constructor(e){d(this,"_task"),d(this,"_isDirty",!1),this._task=e}get isDirty(){return this._isDirty}markDirty(){this._isDirty=!0,Lt.schedulers.add(this),Dt()}runTask(){this._isDirty=!1,this._task()}}const Dt=()=>{Lt.isScheduled||(Lt.isScheduled=!0,queueMicrotask(Ft))},Ft=()=>{try{const t=[];let n=0;for(const r of Lt.schedulers)if(Lt.schedulers.delete(r),r.isDirty){if(n++,n>50)throw new Error("Maximum update depth exceeded. This can happen when a resource repeatedly calls setState inside tapEffect.");try{r.runTask()}catch(e){t.push(e)}}if(t.length>0)throw 1===t.length?t[0]:new AggregateError(t,"Errors occurred during flushSync")}finally{Lt.schedulers.clear(),Lt.isScheduled=!1}},$t=e=>{const t=Lt;Lt={schedulers:new Set([]),isScheduled:!0};try{const t=e();return Ft(),t}finally{Lt=t}},Ut=Ct(e=>{const[,t]=kt(e.element),n=Nt(e.element),r=jt(new Set).current,s=jt(n);At(()=>{n!==s.current&&(s.current=n,r.forEach(e=>e()))});return Mt(()=>({getState:()=>s.current,subscribe:e=>(r.add(e),()=>r.delete(e)),render:n=>{const r=e.element!==n;e.element=n,e.onRender(r)&&t(n)},unmount:e.onUnmount}),[])}),zt=Symbol("tap.Context"),Wt=e=>({[zt]:e}),Ht=(e,t,n)=>{const r=e[zt];e[zt]=t;try{return n()}finally{e[zt]=r}},Vt=e=>e[zt],qt=e=>{let t;const n=new Set,r=(e,r)=>{const s="function"==typeof e?e(t):e;if(!Object.is(s,t)){const e=t;t=(null!=r?r:"object"!=typeof s||null===s)?s:Object.assign({},t,s),n.forEach(n=>n(t,e))}},s=()=>t,i={setState:r,getState:s,getInitialState:()=>o,subscribe:e=>(n.add(e),()=>n.delete(e))},o=t=e(r,s,i);return i},Jt=e=>e;const Yt=e=>{const n=(e=>e?qt(e):qt)(e),r=e=>function(e,n=Jt){const r=t.useSyncExternalStore(e.subscribe,t.useCallback(()=>n(e.getState()),[e,n]),t.useCallback(()=>n(e.getInitialState()),[e,n]));return t.useDebugValue(r),r}(n,e);return Object.assign(r,n),r},Kt=e=>e?Yt(e):Yt;function Gt(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function Xt(...e){return t=>{let n=!1;const r=e.map(e=>{const r=Gt(e,t);return n||"function"!=typeof r||(n=!0),r});if(n)return()=>{for(let t=0;t<r.length;t++){const n=r[t];"function"==typeof n?n():Gt(e[t],null)}}}}function Zt(...e){return v.useCallback(Xt(...e),e)}const Qt=Ct(e=>{const t=Mt(()=>((e,{mount:t=!0}={})=>{let n,r=t;const s={element:e,onRender:e=>r?e:(r=!0,$t(()=>{e&&(n=vt(o,s)),i.isDirty||yt(o,n)}),!1),onUnmount:()=>{if(!r)throw new Error("Resource not mounted");r=!1,gt(o)}},i=new Bt(()=>{n=vt(o,s),!i.isDirty&&r&&yt(o,n)}),o=mt(Ut,()=>i.markDirty());return $t(()=>{i.markDirty()}),n.state})(e,{mount:!1}),[e.type]);return At(()=>{t.render(e)}),t});class en{constructor(e){d(this,"ref"),this.ref=e}get(e,t){return this.ref.current[t]}ownKeys(){return Object.keys(this.ref.current)}has(e,t){return t in this.ref.current}getOwnPropertyDescriptor(e,t){return Object.getOwnPropertyDescriptor(this.ref.current,t)}set(){return!1}setPrototypeOf(){return!1}defineProperty(){return!1}deleteProperty(){return!1}preventExtensions(){return!1}}const tn=(e,t)=>{const n=jt(e);At(()=>{n.current=e});const r=Mt(()=>new Proxy({},new en(n)),[]),s=null==t?void 0:t.key,i=e.getState();return Mt(()=>({key:s,state:i,api:r}),[i,s])},nn=Ct(e=>{const t=jt(e.get);return At(()=>{t.current=e.get}),Mt(()=>mn({source:e.source,query:e.query,get:()=>t.current()}),[e.source,JSON.stringify(e.query)])}),rn=Ct(e=>{const t=Nt(e.scopeElement);return Mt(()=>[e.fieldName,t],[e.fieldName,t])}),sn=Ct(e=>{const{on:t,subscribe:n,...r}=e,s=jt({on:t,subscribe:n});At(()=>{s.current={on:t,subscribe:n}});const i=Ot(r,(e,t)=>rn({fieldName:t,scopeElement:e}),[]);return Mt(()=>{const e=Object.fromEntries(Object.values(i)),{on:t,subscribe:n}=s.current;return t&&(e.on=(e,n)=>t(e,n)),n&&(e.subscribe=e=>n(e)),e},[i])}),on=Wt(null),an=()=>{const e=Vt(on);if(!e)throw new Error("Model context is not available in this context");return e},cn=Ct(({toolkit:e})=>{const[t,n]=kt(()=>({tools:{}})),r=an();At(()=>{if(!e)return;const t=[];for(const[r,o]of Object.entries(e))o.render&&t.push(s(r,o.render));const n=Object.entries(e).reduce((e,[t,n])=>{const{render:r,...s}=n;return e[t]=s,e},{}),i={getModelContext:()=>({tools:n})};return t.push(r.register(i)),()=>{t.forEach(e=>e())}},[e,r]);const s=(e,t)=>(n(n=>({...n,tools:{...n.tools,[e]:[...n.tools[e]??[],t]}})),()=>{n(n=>{var r;return{...n,tools:{...n.tools,[e]:(null==(r=n.tools[e])?void 0:r.filter(e=>e!==t))??[]}}})});return tn({getState:()=>t,setToolUI:s})}),ln=Ct(()=>Mt(()=>{const e=new Map;return{on:(t,n)=>{e.has(t)||e.set(t,new Set);const r=e.get(t);return r.add(n),()=>{r.delete(n),0===r.size&&e.delete(t)}},emit:(t,n)=>{const r=e.get(t),s=e.get("*");(r||s)&&queueMicrotask(()=>{if(r)for(const e of r)e(n);if(s)for(const e of s)e({event:t,payload:n})})}}},[])),un=Wt(null),dn=()=>{const e=Vt(un);if(!e)throw new Error("Events context is not available");return e},hn=Ct(()=>{const[e]=kt(()=>({})),t=new M;return tn({getState:()=>e,getModelContext:()=>t.getModelContext(),subscribe:e=>t.subscribe(e),register:e=>t.registerModelContextProvider(e)})}),pn=Ct(({threads:e,modelContext:t,tools:n})=>{const r=Pt(ln()),{threads:s,tools:i,modelContext:o}=((e,t)=>Ht(un,e,t))(r,()=>{const r=Nt(t??hn(),[t]);return((e,t)=>Ht(on,e,t))(r.api,()=>({modelContext:r,tools:Nt(n??cn({}),[n]),threads:Nt(e,[e])}))}),a=Mt(()=>({threads:s.state,tools:i.state,modelContext:o.state}),[s.state,i.state,o.state]);return tn({getState:()=>a,threads:s.api,tools:i.api,modelContext:o.api,on:r.on})}),fn=e=>{const n=yn(),r=wt(Qt(pn(e))),s=t.useMemo(()=>(e=>{const t=()=>e.getState().api.threads.item("main");return{threads:mn({source:"root",query:{},get:()=>e.getState().api.threads}),tools:mn({source:"root",query:{},get:()=>e.getState().api.tools}),modelContext:mn({source:"root",query:{},get:()=>e.getState().api.modelContext}),thread:mn({source:"threads",query:{type:"main"},get:()=>e.getState().api.threads.thread("main")}),threadListItem:mn({source:"threads",query:{type:"main"},get:()=>t()}),composer:mn({source:"thread",query:{},get:()=>e.getState().api.threads.thread("main").composer}),on(n,r){const{event:s,scope:i}=xt(n);if("*"===i)return e.getState().api.on(s,r);if(_t("thread",i)||_t("thread-list-item",i)||_t("composer",i))return e.getState().api.on(s,e=>{e.threadId===t().getState().id&&r(e)});throw new Error(`Event scope is not available in this component: ${i}`)},subscribe:e.subscribe}})(r),[r]);return t.useMemo(()=>xn(n,s),[n,s])},mn=e=>{const t=e.get;return t.source=e.source,t.query=e.query,t},gn=()=>()=>{},vn=t.createContext({threads:mn({source:null,query:{},get:()=>{throw new Error("Threads is only available inside <AssistantProvider />")}}),tools:mn({source:null,query:{},get:()=>{throw new Error("Tools is only available inside <AssistantProvider />")}}),modelContext:mn({source:null,query:{},get:()=>{throw new Error("ModelContext is only available inside <AssistantProvider />")}}),threadListItem:mn({source:null,query:{},get:()=>{throw new Error("ThreadListItem is only available inside <AssistantProvider />")}}),thread:mn({source:null,query:{},get:()=>{throw new Error("Thread is only available inside <AssistantProvider />")}}),composer:mn({source:null,query:{},get:()=>{throw new Error("Composer is only available inside <AssistantProvider />")}}),message:mn({source:null,query:{},get:()=>{throw new Error("Message is only available inside <ThreadPrimitive.Messages />")}}),part:mn({source:null,query:{},get:()=>{throw new Error("Part is only available inside <MessagePrimitive.Parts />")}}),attachment:mn({source:null,query:{},get:()=>{throw new Error("Attachment is only available inside <MessagePrimitive.Attachments /> or <ComposerPrimitive.Attachments />")}}),subscribe:gn,on:e=>{const{scope:t}=xt(e);throw new Error(`Event scope is not available in this component: ${t}`)}}),yn=()=>t.useContext(vn),bn=e=>{const n=yn(),r=wt(sn(e));return t.useMemo(()=>xn(n,r),[n,r])};function wn(e){return e?(e=>fn(e))(e):yn()}const xn=(e,t)=>{const n=t.subscribe;return{...e,...t,subscribe:(r=e.subscribe,s=n??gn,r===gn?s:s===gn?r:(...e)=>{const t=r(...e),n=s(...e);return()=>{t(),n()}})};var r,s},_n=({api:e,children:n,devToolsVisible:r=!0})=>(t.useEffect(()=>{if(r&&e.subscribe)return Tt.register(e)},[e,r]),A.jsx(vn.Provider,{value:e,children:n}));class Sn{constructor(e){f(this,r),m(this,r,e)}get threads(){return p(this,r).threads().getState()}get tools(){return p(this,r).tools().getState()}get threadListItem(){return p(this,r).threadListItem().getState()}get thread(){return p(this,r).thread().getState()}get composer(){return p(this,r).composer().getState()}get message(){return p(this,r).message().getState()}get part(){return p(this,r).part().getState()}get attachment(){return p(this,r).attachment().getState()}}r=new WeakMap;const En=e=>{const n=wn(),r=t.useMemo(()=>new Sn(n),[n]),s=t.useSyncExternalStore(n.subscribe,()=>e(r),()=>e(r));if(t.useDebugValue(s),s instanceof Sn)throw new Error("You tried to return the entire AssistantState. This is not supported due to technical limitations.");return s},In=(e,n)=>{const r=wn(),s=t.useRef(n);t.useEffect(()=>{s.current=n});const{scope:i,event:o}=xt(e);t.useEffect(()=>r.on({scope:i,event:o},e=>s.current(e)),[r,i,o])};function Tn(e,t){function n(n){const r=e(n);return r?r[t]:null}return{[t]:function(e){let t,r=!1;"function"==typeof e?t=e:e&&"object"==typeof e&&(r=!!e.optional,t=e.selector);const s=n({optional:r});return s?t?s(t):s():null},[`${t}Store`]:n}}const Cn=t.createContext(null),Rn=(kn=Cn,An="ThreadPrimitive.Viewport",function(e){const n=t.useContext(kn);if(!(null==e?void 0:e.optional)&&!n)throw new Error(`This component must be used within ${An}.`);return n});var kn,An;const{useThreadViewport:jn,useThreadViewportStore:Mn}=Tn(Rn,"useThreadViewport");const Nn=e=>e;const Pn=(On=function(e){const t=wn(),n=En(()=>{var e,n;return t.message.source?(null==(n=(e=t.message()).__internal_getRuntime)?void 0:n.call(e))??null:null});if(!n&&!(null==e?void 0:e.optional))throw new Error("MessageRuntime is not available");return n},function(e){let n,r=!1;"function"==typeof e?n=e:e&&(r=!!e.optional,n=e.selector);const s=On({optional:r});return s?function(e,n=Nn){(e=>{var t;const n=e;n.__isBound||(null==(t=n.__internal_bindMethods)||t.call(n),n.__isBound=!0)})(e);const r=t.useSyncExternalStore(e.subscribe,()=>n(e.getState()),()=>n(e.getState()));return t.useDebugValue(r),r}(s,n):null});var On;const Ln=e=>{const[,t]=kt(e.getState);return At(()=>(t(e.getState()),e.subscribe(()=>{t(e.getState())})),[e]),e.getState()},Bn=Ct(({runtime:e})=>{const t=Ln(e),n=dn();return At(()=>{const t=[],r=["switched-to","switched-away"];for(const s of r){const r=e.unstable_on(s,()=>{n.emit(`thread-list-item.${s}`,{threadId:e.getState().id})});t.push(r)}return()=>{for(const e of t)e()}},[e,n]),tn({getState:()=>t,switchTo:e.switchTo,rename:e.rename,archive:e.archive,unarchive:e.unarchive,delete:e.delete,generateTitle:e.generateTitle,initialize:e.initialize,detach:e.detach,__internal_getRuntime:()=>e},{key:t.id})}),Dn=e=>{const t=Ot(Mt(()=>Object.fromEntries(e),[e]),e=>e,[]),n=Mt(()=>Object.keys(t),[t]);return{state:Mt(()=>{const e=new Array(n.length);for(let r=0;r<n.length;r++)e[r]=t[n[r]].state;return e},[n,t]),api:e=>{var r,s;const i="index"in e?null==(r=t[n[e.index]])?void 0:r.api:null==(s=t[e.key])?void 0:s.api;if(!i)throw new Error(`tapLookupResources: Resource not found for lookup: ${JSON.stringify(e)}`);return i}}},Fn=Ct(({runtime:e})=>{const t=Ln(e);return tn({getState:()=>t,remove:e.remove,__internal_getRuntime:()=>e},{key:t.id})}),$n=Ct(({runtime:e,index:t})=>{const n=Mt(()=>e.getAttachmentByIndex(t),[e,t]);return Pt(Fn({runtime:n}))}),Un=Ct(({threadIdRef:e,messageIdRef:t,runtime:n})=>{const r=Ln(n),s=dn();At(()=>{const r=[],i=["send","attachment-add"];for(const o of i){const i=n.unstable_on(o,()=>{s.emit(`composer.${o}`,{threadId:e.current,...t&&{messageId:t.current}})});r.push(i)}return()=>{for(const e of r)e()}},[n,s,e,t]);const i=Dn(r.attachments.map((e,t)=>[e.id,$n({runtime:n,index:t})])),o=Mt(()=>({text:r.text,role:r.role,attachments:i.state,runConfig:r.runConfig,isEditing:r.isEditing,canCancel:r.canCancel,attachmentAccept:r.attachmentAccept,isEmpty:r.isEmpty,type:r.type??"thread"}),[r,i.state]);return tn({getState:()=>o,setText:n.setText,setRole:n.setRole,setRunConfig:n.setRunConfig,addAttachment:n.addAttachment,reset:n.reset,clearAttachments:n.clearAttachments,send:n.send,cancel:n.cancel,beginEdit:n.beginEdit??(()=>{throw new Error("beginEdit is not supported in this runtime")}),attachment:e=>"id"in e?i.api({key:e.id}):i.api(e),__internal_getRuntime:()=>n})}),zn=Ct(({runtime:e})=>{const t=Ln(e);return tn({getState:()=>t,addToolResult:t=>e.addToolResult(t),resumeToolCall:t=>e.resumeToolCall(t),__internal_getRuntime:()=>e},{key:"tool-call"===t.type?`toolCallId-${t.toolCallId}`:void 0})}),Wn=Ct(({runtime:e,index:t})=>{const n=Mt(()=>e.getAttachmentByIndex(t),[e,t]);return Pt(Fn({runtime:n}))}),Hn=Ct(({runtime:e,index:t})=>{const n=Mt(()=>e.getMessagePartByIndex(t),[e,t]);return Pt(zn({runtime:n}))}),Vn=Ct(({runtime:e,threadIdRef:t})=>{var n;const r=Ln(e),[s,i]=kt(!1),[o,a]=kt(!1),c=Mt(()=>({get current(){return e.getState().id}}),[e]),l=Pt(Un({runtime:e.composer,threadIdRef:t,messageIdRef:c})),u=Dn(r.content.map((t,n)=>["toolCallId"in t&&null!=t.toolCallId?`toolCallId-${t.toolCallId}`:`index-${n}`,Hn({runtime:e,index:n})])),d=Dn((null==(n=r.attachments)?void 0:n.map((t,n)=>[t.id,Wn({runtime:e,index:n})]))??[]),h=Mt(()=>({...r,parts:u.state,composer:l.state,isCopied:s,isHovering:o}),[r,u.state,l.state,s,o]);return tn({getState:()=>h,composer:l.api,reload:t=>e.reload(t),speak:()=>e.speak(),stopSpeaking:()=>e.stopSpeaking(),submitFeedback:t=>e.submitFeedback(t),switchToBranch:t=>e.switchToBranch(t),getCopyText:()=>e.unstable_getCopyText(),part:e=>"index"in e?u.api({index:e.index}):u.api({key:`toolCallId-${e.toolCallId}`}),attachment:e=>"id"in e?d.api({key:e.id}):d.api(e),setIsCopied:i,setIsHovering:a,__internal_getRuntime:()=>e},{key:r.id})}),qn=Ct(({runtime:e,id:t,threadIdRef:n})=>{const r=Mt(()=>e.getMessageById(t),[e,t]);return Pt(Vn({runtime:r,threadIdRef:n}))}),Jn=Ct(({runtime:e})=>{const t=Ln(e),n=dn();At(()=>{const t=[],r=["run-start","run-end","initialize","model-context-update"];for(const s of r){const r=e.unstable_on(s,()=>{var t;const r=(null==(t=e.getState())?void 0:t.threadId)||"unknown";n.emit(`thread.${s}`,{threadId:r})});t.push(r)}return()=>{for(const e of t)e()}},[e]);const r=Mt(()=>({get current(){return e.getState().threadId}}),[e]),s=Pt(Un({runtime:e.composer,threadIdRef:r})),i=Dn(t.messages.map(t=>[t.id,qn({runtime:e,id:t.id,threadIdRef:r})])),o=Mt(()=>({isEmpty:0===i.state.length&&!t.isLoading,isDisabled:t.isDisabled,isLoading:t.isLoading,isRunning:t.isRunning,capabilities:t.capabilities,state:t.state,suggestions:t.suggestions,extras:t.extras,speech:t.speech,composer:s.state,messages:i.state}),[t,i,s.state]);return tn({getState:()=>o,composer:s.api,append:e.append,startRun:e.startRun,unstable_resumeRun:e.unstable_resumeRun,cancelRun:e.cancelRun,getModelContext:e.getModelContext,export:e.export,import:e.import,reset:e.reset,stopSpeaking:e.stopSpeaking,startVoice:async()=>{throw new Error("startVoice is not supported in this runtime")},stopVoice:async()=>{throw new Error("stopVoice is not supported in this runtime")},message:e=>"id"in e?i.api({key:e.id}):i.api(e),__internal_getRuntime:()=>e})}),Yn=Ct(({runtime:e,id:t})=>{const n=Mt(()=>e.getItemById(t),[e,t]);return Pt(Bn({runtime:n}))}),Kn=Ct(({runtime:e,__internal_assistantRuntime:t})=>{const n=Ln(e),r=Pt(Jn({runtime:e.main})),s=Dn(Object.keys(n.threadItems).map(t=>[t,Yn({runtime:e,id:t})])),i=Mt(()=>({mainThreadId:n.mainThreadId,newThreadId:n.newThread??null,isLoading:n.isLoading,threadIds:n.threads,archivedThreadIds:n.archivedThreads,threadItems:s.state,main:r.state}),[n,s.state,r.state]);return tn({getState:()=>i,thread:()=>r.api,item:e=>{if("main"===e)return s.api({key:i.mainThreadId});if("id"in e)return s.api({key:e.id});const{index:t,archived:n=!1}=e,r=n?i.archivedThreadIds[t]:i.threadIds[t];return s.api({key:r})},switchToThread:t=>{e.switchToThread(t)},switchToNewThread:()=>{e.switchToNewThread()},__internal_getAssistantRuntime:()=>t})}),Gn=Ct(e=>{const t=an();return At(()=>e.registerModelContextProvider(t),[e,t]),Pt(Kn({runtime:e.threads,__internal_assistantRuntime:e}))}),Xn=e=>{const t=new Map,n=()=>{let n=0;for(const e of t.values())n+=e;e(n)};return{register:()=>{const e=Symbol();return t.set(e,0),{setHeight:r=>{t.get(e)!==r&&(t.set(e,r),n())},unregister:()=>{t.delete(e),n()}}}}},Zn=e=>{const n=Mn({optional:!0}),[r]=t.useState(()=>((e={})=>{const t=new Set,n=Xn(e=>{i.setState({height:{...i.getState().height,viewport:e}})}),r=Xn(e=>{i.setState({height:{...i.getState().height,inset:e}})}),s=Xn(e=>{i.setState({height:{...i.getState().height,userMessage:e}})}),i=Kt(()=>({isAtBottom:!0,scrollToBottom:({behavior:e="auto"}={})=>{for(const n of t)n({behavior:e})},onScrollToBottom:e=>(t.add(e),()=>{t.delete(e)}),turnAnchor:e.turnAnchor??"bottom",height:{viewport:0,inset:0,userMessage:0},registerViewport:n.register,registerContentInset:r.register,registerUserMessageHeight:s.register}));return i})(e));return t.useEffect(()=>null==n?void 0:n.getState().onScrollToBottom(()=>{r.getState().scrollToBottom()}),[n,r]),t.useEffect(()=>{if(n)return r.subscribe(e=>{n.getState().isAtBottom!==e.isAtBottom&&n.setState({isAtBottom:e.isAtBottom})})},[r,n]),t.useEffect(()=>{const t={turnAnchor:e.turnAnchor??"bottom"};r.getState().turnAnchor!==t.turnAnchor&&r.setState(t)},[r,e.turnAnchor]),r},Qn=({children:e,options:n={}})=>{const r=Zn(n),[s]=t.useState(()=>({useThreadViewport:r}));return A.jsx(Cn.Provider,{value:s,children:e})},er=t.memo(({children:e,runtime:t})=>{const n=wn({threads:Gn(t)}),r=(e=>{var t;return null==(t=e._core)?void 0:t.RenderComponent})(t);return A.jsxs(_n,{api:n,children:[r&&A.jsx(r,{}),A.jsx(Qn,{children:e})]})}),tr=({id:e,children:t})=>{const n=wn(),r=bn({threadListItem:nn({source:"threads",query:{type:"id",id:e},get:()=>n.threads().item({id:e})}),on(t,r){const{event:s,scope:i}=xt(t);return _t("thread-list-item",i)?n.on({scope:"*",event:s},t=>{t.threadId===n.threads().item({id:e}).getState().id&&r(t)}):n.on(t,r)}});return A.jsx(_n,{api:r,children:t})},nr=({index:e,children:t})=>{const n=wn(),r=bn({message:nn({source:"thread",query:{type:"index",index:e},get:()=>n.thread().message({index:e})}),composer:nn({source:"message",query:{},get:()=>n.thread().message({index:e}).composer}),on(t,r){const{event:s,scope:i}=xt(t);return _t("composer",i)||_t("message",i)?n.on({scope:"thread",event:s},t=>{t.messageId===n.thread().message({index:e}).getState().id&&r(t)}):n.on(t,r)}});return A.jsx(_n,{api:r,children:t})},rr=({index:e,children:t})=>{const n=wn(),r=bn({part:nn({source:"message",query:{type:"index",index:e},get:()=>n.message().part({index:e})})});return A.jsx(_n,{api:r,children:t})},sr=Ct(({text:e,isRunning:t})=>{const n=Mt(()=>({type:"text",text:e,status:t?{type:"running"}:{type:"complete"}}),[e,t]);return tn({getState:()=>n,addToolResult:()=>{throw new Error("Not supported")},resumeToolCall:()=>{throw new Error("Not supported")}})}),ir=({text:e,isRunning:t=!1,children:n})=>{const r=wt(Qt(sr({text:e,isRunning:t}))),s=bn({part:nn({source:"root",query:{},get:()=>r.getState().api}),subscribe:r.subscribe});return A.jsx(_n,{api:s,children:n})},or=(e,t)=>{var n,r;return void 0===t?"requires-action"===(null==(n=e.status)?void 0:n.type)&&"tool-calls"===e.status.reason&&e.content.every(e=>"tool-call"!==e.type||!!e.result):"requires-action"===(null==(r=e.status)?void 0:r.type)&&"tool-calls"===e.status.reason&&e.content.every(e=>"tool-call"!==e.type||!!e.result||!t.includes(e.toolName))};class ar extends Error{constructor(e,t){super(t),d(this,"name","AbortError"),d(this,"detach"),this.detach=e}}class cr extends lt{constructor(e,t){super(e),d(this,"capabilities",{switchToBranch:!0,switchBranchDuringRun:!0,edit:!0,reload:!0,cancel:!0,unstable_copy:!0,speech:!1,attachments:!1,feedback:!1}),d(this,"abortController",null),d(this,"isDisabled",!1),d(this,"_isLoading",!1),d(this,"_suggestions",[]),d(this,"_suggestionsController",null),d(this,"_options"),d(this,"_lastRunConfig",{}),d(this,"_loadPromise"),this.__internal_setOptions(t)}get isLoading(){return this._isLoading}get suggestions(){return this._suggestions}get adapters(){return this._options.adapters}get extras(){}__internal_setOptions(e){var t,n,r;if(this._options===e)return;this._options=e;let s=!1;const i=void 0!==(null==(t=e.adapters)?void 0:t.speech);this.capabilities.speech!==i&&(this.capabilities.speech=i,s=!0);const o=void 0!==(null==(n=e.adapters)?void 0:n.attachments);this.capabilities.attachments!==o&&(this.capabilities.attachments=o,s=!0);const a=void 0!==(null==(r=e.adapters)?void 0:r.feedback);this.capabilities.feedback!==a&&(this.capabilities.feedback=a,s=!0),s&&this._notifySubscribers()}__internal_load(){var e;if(this._loadPromise)return this._loadPromise;const t=(null==(e=this.adapters.history)?void 0:e.load())??Promise.resolve(null);return this._isLoading=!0,this._notifySubscribers(),this._loadPromise=t.then(e=>{var t,n;if(!e)return;this.repository.import(e),this._notifySubscribers();const r=null==(n=null==(t=this.adapters.history)?void 0:t.resume)?void 0:n.bind(this.adapters.history);e.unstable_resume&&r&&this.startRun({parentId:this.repository.headId,sourceId:this.repository.headId,runConfig:this._lastRunConfig},r)}).finally(()=>{this._isLoading=!1,this._notifySubscribers()}),this._loadPromise}async append(e){var t;this.ensureInitialized();const n=ve(e,D(),{type:"complete",reason:"unknown"});this.repository.addOrUpdateMessage(e.parentId,n),null==(t=this._options.adapters.history)||t.append({parentId:e.parentId,message:n,...void 0!==e.runConfig&&{runConfig:e.runConfig}});e.startRun??"user"===e.role?await this.startRun({parentId:n.id,sourceId:e.sourceId,runConfig:e.runConfig??{}}):(this.repository.resetHead(n.id),this._notifySubscribers())}resumeRun({stream:e,...t}){if(!e)throw new Error("You must pass a stream parameter to resume runs.");return this.startRun(t,e)}unstable_loadExternalState(){throw new Error("Runtime does not support importing external states.")}async startRun({parentId:e,runConfig:t},n){var r,s,i;this.ensureInitialized();let o={id:D(),role:"assistant",status:{type:"running"},content:[],metadata:{unstable_state:this.state,unstable_annotations:[],unstable_data:[],steps:[],custom:{}},createdAt:new Date};this._notifyEventSubscribers("run-start");try{this._suggestions=[],null==(r=this._suggestionsController)||r.abort(),this._suggestionsController=null,this._notifySubscribers();do{o=await this.performRoundtrip(e,o,t,n),n=void 0}while(or(o,this._options.unstable_humanToolNames))}finally{this._notifyEventSubscribers("run-end")}this._suggestionsController=new AbortController;const a=this._suggestionsController.signal;if(this.adapters.suggestion&&"requires-action"!==(null==(s=o.status)?void 0:s.type)){const e=null==(i=this.adapters.suggestion)?void 0:i.generate({messages:this.messages});if(Symbol.asyncIterator in e)for await(const t of e){if(a.aborted)break;this._suggestions=t,this._notifySubscribers()}else{const t=await e;if(a.aborted)return;this._suggestions=t,this._notifySubscribers()}}}async performRoundtrip(e,t,n,r){var s,i,o,a,c,l,u,d;const h=e?this.repository.getMessages(e):[];null==(s=this.abortController)||s.abort(),this.abortController=new AbortController;const p=t.content,f=null==(i=t.metadata)?void 0:i.unstable_annotations,m=null==(o=t.metadata)?void 0:o.unstable_data,g=null==(a=t.metadata)?void 0:a.steps,v=null==(c=t.metadata)?void 0:c.custom,y=n=>{var r,s,i,o;const a=null==(r=n.metadata)?void 0:r.steps,c=a?[...g??[],...a]:void 0,l=null==(s=n.metadata)?void 0:s.unstable_annotations,u=null==(i=n.metadata)?void 0:i.unstable_data,d=l?[...f??[],...l]:void 0,h=u?[...m??[],...u]:void 0;t={...t,...n.content?{content:[...p,...n.content??[]]}:void 0,status:n.status??t.status,...n.metadata?{metadata:{...t.metadata,...n.metadata.unstable_state?{unstable_state:n.metadata.unstable_state}:void 0,...d?{unstable_annotations:d}:void 0,...h?{unstable_data:h}:void 0,...c?{steps:c}:void 0,...(null==(o=n.metadata)?void 0:o.custom)?{custom:{...v??{},...n.metadata.custom}}:void 0}}:void 0},this.repository.addOrUpdateMessage(e,t),this._notifySubscribers()},b=this._options.maxSteps??2;if(((null==(u=null==(l=t.metadata)?void 0:l.steps)?void 0:u.length)??0)>=b)return y({status:{type:"incomplete",reason:"tool-calls"}}),t;y({status:{type:"running"}}),this.repository.resetHead(t.id),this._notifySubscribers();try{this._lastRunConfig=n??{};const e=this.getModelContext();r=r??this.adapters.chatModel.run.bind(this.adapters.chatModel);const s=this.abortController.signal,i=r({messages:h,runConfig:this._lastRunConfig,abortSignal:s,context:e,config:e,unstable_assistantMessageId:t.id,unstable_getMessage:()=>t});if(Symbol.asyncIterator in i)for await(const t of i){if(s.aborted){y({status:{type:"incomplete",reason:"cancelled"}});break}y(t)}else y(await i);"running"===t.status.type&&y({status:{type:"complete",reason:"unknown"}})}catch(w){if(!(w instanceof ar))throw y({status:{type:"incomplete",reason:"error",error:w instanceof Error?w.message:`[${typeof w}] ${new String(w).toString()}`}}),w;y({status:{type:"incomplete",reason:"cancelled"}})}finally{this.abortController=null,"complete"!==t.status.type&&"incomplete"!==t.status.type||await(null==(d=this._options.adapters.history)?void 0:d.append({parentId:e,message:t,runConfig:this._lastRunConfig}))}return t}detach(){var e;const t=new ar(!0);null==(e=this.abortController)||e.abort(t),this.abortController=null}cancelRun(){var e;const t=new ar(!1);null==(e=this.abortController)||e.abort(t),this.abortController=null}addToolResult({messageId:e,toolCallId:t,result:n,isError:r,artifact:s}){const i=this.repository.getMessage(e),{parentId:o}=i;let{message:a}=i;if("assistant"!==a.role)throw new Error("Tried to add tool result to non-assistant message");let c=!1,l=!1;const u=a.content.map(e=>"tool-call"!==e.type||e.toolCallId!==t?e:(l=!0,e.result||(c=!0),{...e,result:n,artifact:s,isError:r}));if(!l)throw new Error("Tried to add tool result to non-existing tool call");a={...a,content:u},this.repository.addOrUpdateMessage(o,a),c&&or(a,this._options.unstable_humanToolNames)&&this.performRoundtrip(o,a,this._lastRunConfig)}resumeToolCall(e){throw new Error("Local runtime does not support resuming tool calls.")}}const lr=Object.freeze([]),ur="__DEFAULT_ID__",dr=Object.freeze({[ur]:{id:ur,remoteId:void 0,externalId:void 0,status:"regular",title:void 0}});class hr extends P{constructor(e){super(),d(this,"_mainThread"),this._mainThread=e()}get isLoading(){return!1}getMainThreadRuntimeCore(){return this._mainThread}get newThreadId(){throw new Error("Method not implemented.")}get threadIds(){throw lr}get archivedThreadIds(){throw lr}get mainThreadId(){return ur}get threadData(){return dr}getThreadRuntimeCore(){throw new Error("Method not implemented.")}getLoadThreadsPromise(){throw new Error("Method not implemented.")}getItemById(e){if(e===this.mainThreadId)return{status:"regular",id:this.mainThreadId,remoteId:this.mainThreadId,externalId:void 0,title:void 0,isMain:!0};throw new Error("Method not implemented")}async switchToThread(){throw new Error("Method not implemented.")}switchToNewThread(){throw new Error("Method not implemented.")}rename(){throw new Error("Method not implemented.")}archive(){throw new Error("Method not implemented.")}detach(){throw new Error("Method not implemented.")}unarchive(){throw new Error("Method not implemented.")}delete(){throw new Error("Method not implemented.")}initialize(e){return Promise.resolve({remoteId:e,externalId:void 0})}generateTitle(){throw new Error("Method not implemented.")}}class pr extends N{constructor(e,t){super(),d(this,"threads"),d(this,"Provider"),d(this,"_options"),this._options=e,this.threads=new hr(()=>new cr(this._contextProvider,this._options)),t&&this.threads.getMainThreadRuntimeCore().import(ye(t))}}const fr=e=>{try{const t=e.split(".")[1];if(!t)throw new Error("Invalid JWT format");let n=t.replace(/-/g,"+").replace(/_/g,"/");for(;n.length%4!=0;)n+="=";const r=atob(n),s=JSON.parse(r).exp;if(!s||"number"!=typeof s)throw new Error('JWT does not contain a valid "exp" field');return 1e3*s}catch(t){throw new Error(`Unable to determine the token expiry: ${t}`)}};class mr{constructor(e){d(this,"strategy","jwt"),d(this,"cachedToken",null),d(this,"tokenExpiry",null),f(this,s),m(this,s,e)}async getAuthHeaders(){const e=Date.now();if(this.cachedToken&&this.tokenExpiry&&this.tokenExpiry-e>3e4)return{Authorization:`Bearer ${this.cachedToken}`};const t=await p(this,s).call(this);return!!t&&(this.cachedToken=t,this.tokenExpiry=fr(t),{Authorization:`Bearer ${t}`})}readAuthHeaders(e){const t=e.get("Authorization");if(!t)return;const[n,r]=t.split(" ");if("Bearer"!==n||!r)throw new Error("Invalid auth header received");this.cachedToken=r,this.tokenExpiry=fr(r)}}s=new WeakMap;class gr{constructor(e,t,n){d(this,"strategy","api-key"),f(this,i),f(this,o),f(this,a),m(this,i,e),m(this,o,t),m(this,a,n)}async getAuthHeaders(){return{Authorization:`Bearer ${p(this,i)}`,"Aui-User-Id":p(this,o),"Aui-Workspace-Id":p(this,a)}}readAuthHeaders(){}}i=new WeakMap,o=new WeakMap,a=new WeakMap;const vr="aui:refresh_token";class yr{constructor(e){d(this,"strategy","anon"),d(this,"baseUrl"),d(this,"jwtStrategy"),this.baseUrl=e,this.jwtStrategy=new mr(async()=>{const e=Date.now(),t=localStorage.getItem(vr),n=t?JSON.parse(t):void 0;if(n){if(new Date(n.expires_at).getTime()-e>3e4){const e=await fetch(`${this.baseUrl}/v1/auth/tokens/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:n.token})});if(e.ok){const t=await e.json(),{access_token:n,refresh_token:r}=t;return r&&localStorage.setItem(vr,JSON.stringify(r)),n}}else localStorage.removeItem(vr)}const r=await fetch(`${this.baseUrl}/v1/auth/tokens/anonymous`,{method:"POST"});if(!r.ok)return null;const s=await r.json(),{access_token:i,refresh_token:o}=s;return i&&o?(localStorage.setItem(vr,JSON.stringify(o)),i):null})}async getAuthHeaders(){return this.jwtStrategy.getAuthHeaders()}readAuthHeaders(e){this.jwtStrategy.readAuthHeaders(e)}}class br extends Error{constructor(e){super(e),this.name="APIError"}}class wr{constructor(e){if(d(this,"_auth"),d(this,"_baseUrl"),"authToken"in e)this._baseUrl=e.baseUrl,this._auth=new mr(e.authToken);else if("apiKey"in e)this._baseUrl="https://backend.assistant-api.com",this._auth=new gr(e.apiKey,e.userId,e.workspaceId);else{if(!("anonymous"in e))throw new Error("Invalid configuration: Must provide authToken, apiKey, or anonymous configuration");this._baseUrl=e.baseUrl,this._auth=new yr(e.baseUrl)}}async initializeAuth(){return!!this._auth.getAuthHeaders()}async makeRawRequest(e,t={}){const n=await this._auth.getAuthHeaders();if(!n)throw new Error("Authorization failed");const r={...n,...t.headers,"Content-Type":"application/json"},s=new URLSearchParams;if(t.query)for(const[a,c]of Object.entries(t.query))!1!==c&&(!0===c?s.set(a,"true"):s.set(a,c.toString()));const i=new URL(`${this._baseUrl}/v1${e}`);i.search=s.toString();const o=await fetch(i,{method:t.method??"GET",headers:r,body:t.body?JSON.stringify(t.body):null});if(this._auth.readAuthHeaders(o.headers),!o.ok){const e=await o.text();try{const t=JSON.parse(e);throw new br(t.message)}catch{throw new Error(`Request failed with status ${o.status}, ${e}`)}}return o}async makeRequest(e,t={}){return(await this.makeRawRequest(e,t)).json()}}class xr{constructor(e){d(this,"cloud"),this.cloud=e}async create(){return this.cloud.makeRequest("/auth/tokens",{method:"POST"})}}class _r{constructor(e){d(this,"cloud"),this.cloud=e}__internal_getAssistantOptions(e){return{api:`${this.cloud._baseUrl}/v1/runs/stream`,headers:async()=>{const e=await this.cloud._auth.getAuthHeaders();if(!e)throw new Error("Authorization failed");return{...e,Accept:"text/plain"}},body:{assistant_id:e,response_format:"vercel-ai-data-stream/v1",thread_id:"unstable_todo"}}}async stream(e){const t=await this.cloud.makeRawRequest("/runs/stream",{method:"POST",headers:{Accept:"text/plain"},body:e});return te.fromResponse(t,new Je)}}class Sr{constructor(e){d(this,"cloud"),this.cloud=e}async list(e,t){return this.cloud.makeRequest(`/threads/${encodeURIComponent(e)}/messages`,{query:t})}async create(e,t){return this.cloud.makeRequest(`/threads/${encodeURIComponent(e)}/messages`,{method:"POST",body:t})}}class Er{constructor(e){d(this,"cloud"),d(this,"messages"),this.cloud=e,this.messages=new Sr(e)}async list(e){return this.cloud.makeRequest("/threads",{query:e})}async get(e){return this.cloud.makeRequest(`/threads/${encodeURIComponent(e)}`)}async create(e){return this.cloud.makeRequest("/threads",{method:"POST",body:e})}async update(e,t){return this.cloud.makeRequest(`/threads/${encodeURIComponent(e)}`,{method:"PUT",body:t})}async delete(e){return this.cloud.makeRequest(`/threads/${encodeURIComponent(e)}`,{method:"DELETE"})}}class Ir{constructor(e){d(this,"cloud"),this.cloud=e}async pdfToImages(e){return this.cloud.makeRequest("/files/pdf-to-images",{method:"POST",body:e})}async generatePresignedUploadUrl(e){return this.cloud.makeRequest("/files/attachments/generate-presigned-upload-url",{method:"POST",body:e})}}function Tr(e,t=0){return!(t>100)&&(null===e||"string"==typeof e||"boolean"==typeof e||("number"==typeof e?!Number.isNaN(e)&&Number.isFinite(e):Array.isArray(e)?e.every(e=>Tr(e,t+1)):"object"==typeof e&&Object.entries(e).every(([e,n])=>"string"==typeof e&&Tr(n,t+1))))}const Cr=e=>{var t;return{role:e.role,content:e.content.map(e=>{const t=e.type;switch(t){case"text":return{type:"text",text:e.text};case"reasoning":return{type:"reasoning",text:e.text};case"source":return{type:"source",sourceType:e.sourceType,id:e.id,url:e.url,...e.title?{title:e.title}:void 0};case"tool-call":return Tr(e.result),{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,...JSON.stringify(e.args)===e.argsText?{args:e.args}:{argsText:e.argsText},...e.result?{result:e.result}:{},...e.isError?{isError:!0}:{}};default:throw new Error(`Message part type not supported by aui/v0: ${t}`)}}),metadata:e.metadata,...e.status?{status:"running"===(null==(t=e.status)?void 0:t.type)?{type:"incomplete",reason:"cancelled"}:e.status}:void 0}},Rr=e=>{const t=e.content,n=ve({id:e.id,createdAt:e.created_at,...t},e.id,{type:"complete",reason:"unknown"});return{parentId:e.parent_id,message:n}},kr=new WeakMap;class Ar{constructor(e,t){d(this,"parent"),d(this,"formatAdapter"),this.parent=e,this.formatAdapter=t}async append(e){const t=this.formatAdapter.encode(e),n=this.formatAdapter.getId(e.message);return this.parent._appendWithFormat(e.parentId,n,this.formatAdapter.format,t)}async load(){return this.parent._loadWithFormat(this.formatAdapter.format,e=>this.formatAdapter.decode(e))}}class jr{constructor(e,t){d(this,"cloudRef"),d(this,"store"),this.cloudRef=e,this.store=t}get _getIdForLocalId(){return kr.has(this.store.threadListItem())||kr.set(this.store.threadListItem(),{}),kr.get(this.store.threadListItem())}withFormat(e){return new Ar(this,e)}async append({parentId:e,message:t}){const{remoteId:n}=await this.store.threadListItem().initialize(),r=this.cloudRef.current.threads.messages.create(n,{parent_id:e?await this._getIdForLocalId[e]??e:null,format:"aui/v0",content:Cr(t)}).then(({message_id:e})=>(this._getIdForLocalId[t.id]=e,e));return this._getIdForLocalId[t.id]=r,r.then(()=>{})}async load(){const e=this.store.threadListItem().getState().remoteId;if(!e)return{messages:[]};const{messages:t}=await this.cloudRef.current.threads.messages.list(e,{format:"aui/v0"});return{messages:t.filter(e=>"aui/v0"===e.format).map(Rr).reverse()}}async _appendWithFormat(e,t,n,r){const{remoteId:s}=await this.store.threadListItem().initialize(),i=this.cloudRef.current.threads.messages.create(s,{parent_id:e?await this._getIdForLocalId[e]??e:null,format:n,content:r}).then(({message_id:e})=>(this._getIdForLocalId[t]=e,e));return this._getIdForLocalId[t]=i,i.then(()=>{})}async _loadWithFormat(e,t){const n=this.store.threadListItem().getState().remoteId;if(!n)return{messages:[]};const{messages:r}=await this.cloudRef.current.threads.messages.list(n,{format:e});return{messages:r.filter(t=>t.format===e).map(e=>t({id:e.id,parent_id:e.parent_id,format:e.format,content:e.content})).reverse()}}}const Mr="undefined"!=typeof process&&(null==(c=null==process?void 0:process.env)?void 0:c.NEXT_PUBLIC_ASSISTANT_BASE_URL),Nr=Mr?new class{constructor(e){d(this,"threads"),d(this,"auth"),d(this,"runs"),d(this,"files");const t=new wr(e);this.threads=new Er(t),this.auth={tokens:new xr(t)},this.runs=new _r(t),this.files=new Ir(t)}}({baseUrl:Mr,anonymous:!0}):void 0,Pr=e=>{const n=t.useRef(e);t.useEffect(()=>{n.current=e},[e]);const r=t.useCallback(function({children:e}){const r=(e=>{const n=wn(),[r]=t.useState(()=>new jr(e,n));return r})({get current(){return n.current.cloud??Nr}}),s=n.current.cloud??Nr,i=t.useMemo(()=>new it(s),[s]),o=t.useMemo(()=>({history:r,attachments:i}),[r,i]);return A.jsx(at,{adapters:o,children:e})},[]),s=e.cloud??Nr;return s?{list:async()=>{const{threads:e}=await s.threads.list();return{threads:e.map(e=>({status:e.is_archived?"archived":"regular",remoteId:e.id,title:e.title,externalId:e.external_id??void 0}))}},initialize:async()=>{var t;const n=(null==(t=e.create)?void 0:t.call(e))??Promise.resolve(),r=await n,i=r?r.externalId:void 0,{thread_id:o}=await s.threads.create({last_message_at:new Date,external_id:i});return{externalId:i,remoteId:o}},rename:async(e,t)=>s.threads.update(e,{title:t}),archive:async e=>s.threads.update(e,{is_archived:!0}),unarchive:async e=>s.threads.update(e,{is_archived:!1}),delete:async t=>{var n;return await(null==(n=e.delete)?void 0:n.call(e,t)),s.threads.delete(t)},generateTitle:async(e,t)=>s.runs.stream({thread_id:e,assistant_id:"system/thread_title",messages:t}),fetch:async e=>{const t=await s.threads.get(e);return{status:t.is_archived?"archived":"regular",remoteId:t.id,title:t.title,externalId:t.external_id??void 0}},unstable_Provider:r}:new ut},Or=(e,{initialMessages:n,...r})=>{const{modelContext:s,...i}=t.useContext(ot)??{},o=t.useMemo(()=>({...r,adapters:{...i,...r.adapters,chatModel:e}}),[e,r,i]),[a]=t.useState(()=>new pr(o,n));return t.useEffect(()=>()=>{a.threads.getMainThreadRuntimeCore().detach()},[a]),t.useEffect(()=>{a.threads.getMainThreadRuntimeCore().__internal_setOptions(o),a.threads.getMainThreadRuntimeCore().__internal_load()},[a,o]),t.useEffect(()=>{if(s)return a.registerModelContextProvider(s)},[s,a]),t.useMemo(()=>new Br(a),[a])},Lr=(e,{cloud:t,...n}={})=>{const r=Pr({cloud:t});return es({runtimeHook:function(){return Or(e,n)},adapter:r,allowNesting:!0})};class Br{constructor(e){d(this,"_core"),d(this,"threads"),d(this,"_thread"),this._core=e,this.threads=new st(e.threads),this._thread=this.threads.main,this.__internal_bindMethods()}get threadList(){return this.threads}__internal_bindMethods(){this.switchToNewThread=this.switchToNewThread.bind(this),this.switchToThread=this.switchToThread.bind(this),this.registerModelContextProvider=this.registerModelContextProvider.bind(this),this.registerModelConfigProvider=this.registerModelConfigProvider.bind(this),this.reset=this.reset.bind(this)}get thread(){return this._thread}switchToNewThread(){return this._core.threads.switchToNewThread()}switchToThread(e){return this._core.threads.switchToThread(e)}registerModelContextProvider(e){return this._core.registerModelContextProvider(e)}registerModelConfigProvider(e){return this.registerModelContextProvider(e)}reset({initialMessages:e}={}){return this._core.threads.getMainThreadRuntimeCore().import(ye(e??[]))}}function Dr(e){const t=v.useRef(e);return v.useEffect(()=>{t.current=e}),v.useMemo(()=>(...e)=>{var n;return null==(n=t.current)?void 0:n.call(t,...e)},[])}const Fr=t.createContext(null);const{useSmoothStatus:$r,useSmoothStatusStore:Ur}=Tn(function(e){const n=t.useContext(Fr);if(!(null==e?void 0:e.optional)&&!n)throw new Error("This component must be used within a SmoothContextProvider.");return n},"useSmoothStatus");class zr{constructor(e,t){d(this,"currentText"),d(this,"setText"),d(this,"animationFrameId",null),d(this,"lastUpdateTime",Date.now()),d(this,"targetText",""),d(this,"animate",()=>{const e=Date.now();let t=e-this.lastUpdateTime;const n=this.targetText.length-this.currentText.length,r=Math.min(5,250/n);let s=0;for(;t>=r&&s<n;)s++,t-=r;this.animationFrameId=s!==n?requestAnimationFrame(this.animate):null,0!==s&&(this.currentText=this.targetText.slice(0,this.currentText.length+s),this.lastUpdateTime=e-t,this.setText(this.currentText))}),this.currentText=e,this.setText=t}start(){null===this.animationFrameId&&(this.lastUpdateTime=Date.now(),this.animate())}stop(){null!==this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}}const Wr=Object.freeze({type:"running"});class Hr extends P{constructor(e){super(),d(this,"useRuntimeHook"),d(this,"instances",new Map),d(this,"useAliveThreadsKeysChanged",Kt(()=>({}))),d(this,"_InnerActiveThreadProvider",({threadId:e})=>{const{useRuntime:n}=this.useRuntimeHook(),r=n(),s=r.thread.__internal_threadBinding,i=t.useCallback(()=>{const t=this.instances.get(e);if(!t)throw new Error("Thread not found. This is a bug in assistant-ui.");t.runtime=s.getState(),this._notifySubscribers()},[e,s]),o=t.useRef(!1);o.current||i(),t.useEffect(()=>(o.current=!0,i(),s.outerSubscribe(i)),[s,i]);const a=wn();return t.useEffect(()=>r.threads.main.unstable_on("initialize",()=>{if("new"===a.threadListItem().getState().status){a.threadListItem().initialize();const e=r.thread.unstable_on("run-end",()=>{e(),a.threadListItem().generateTitle()})}}),[r,a]),null}),d(this,"_OuterActiveThreadProvider",t.memo(({threadId:e,provider:t})=>A.jsx(tr,{id:e,children:A.jsx(t,{children:A.jsx(this._InnerActiveThreadProvider,{threadId:e})})}))),d(this,"__internal_RenderThreadRuntimes",({provider:e})=>(this.useAliveThreadsKeysChanged(),Array.from(this.instances.keys()).map(t=>A.jsx(this._OuterActiveThreadProvider,{threadId:t,provider:e},t)))),this.useRuntimeHook=Kt(()=>({useRuntime:e}))}startThreadRuntime(e){return this.instances.has(e)||(this.instances.set(e,{}),this.useAliveThreadsKeysChanged.setState({},!0)),new Promise((t,n)=>{const r=()=>{const r=this.instances.get(e);if(r){if(!r.runtime)return;s(),t(r.runtime)}else s(),n(new Error("Thread was deleted before runtime was started"))},s=this.subscribe(r);r()})}getThreadRuntimeCore(e){const t=this.instances.get(e);if(t)return t.runtime}stopThreadRuntime(e){this.instances.delete(e),this.useAliveThreadsKeysChanged.setState({},!0)}setRuntimeHook(e){this.useRuntimeHook.getState().useRuntime!==e&&this.useRuntimeHook.setState({useRuntime:e},!0)}}const Vr=new Error("This is the empty thread, a placeholder for the main thread. You cannot perform any actions on this thread instance. This error is probably because you tried to call a thread method in your render function. Call the method inside a `useEffect` hook instead."),qr={getMessageById(){},getBranches:()=>[],switchToBranch(){throw Vr},append(){throw Vr},startRun(){throw Vr},resumeRun(){throw Vr},cancelRun(){throw Vr},addToolResult(){throw Vr},resumeToolCall(){throw Vr},speak(){throw Vr},stopSpeaking(){throw Vr},submitFeedback(){throw Vr},getModelContext:()=>({}),unstable_loadExternalState(){throw Vr},composer:{attachments:[],attachmentAccept:"*",async addAttachment(){throw Vr},async removeAttachment(){throw Vr},isEditing:!0,canCancel:!1,isEmpty:!0,text:"",setText(){throw Vr},role:"user",setRole(){throw Vr},runConfig:{},setRunConfig(){throw Vr},async reset(){},async clearAttachments(){},send(){throw Vr},cancel(){},subscribe:()=>()=>{},unstable_on:()=>()=>{}},getEditComposer(){},beginEdit(){throw Vr},speech:void 0,capabilities:{switchToBranch:!1,switchBranchDuringRun:!1,edit:!1,reload:!1,cancel:!1,unstable_copy:!1,speech:!1,attachments:!1,feedback:!1},isDisabled:!1,isLoading:!1,messages:[],state:null,suggestions:[],extras:void 0,subscribe:()=>()=>{},import(){throw Vr},export:()=>({messages:[]}),reset(){throw Vr},unstable_on:()=>()=>{}},Jr=(e,t,n)=>n.reduce((e,n)=>(null==n?void 0:n(e,t))??e,e);class Yr extends P{constructor(e){super(),d(this,"_pendingTransforms",[]),d(this,"_baseValue"),d(this,"_cachedValue"),this._baseValue=e,this._cachedValue=e}_updateState(){this._cachedValue=this._pendingTransforms.reduce((e,t)=>Jr(e,t.task,[t.loading,t.optimistic]),this._baseValue),this._notifySubscribers()}get baseValue(){return this._baseValue}get value(){return this._cachedValue}update(e){this._baseValue=e,this._updateState()}async optimisticUpdate(e){const t=e.execute(),n={...e,task:t};try{this._pendingTransforms.push(n),this._updateState();const r=await t;return this._baseValue=Jr(this._baseValue,r,[e.optimistic,e.then]),r}finally{const e=this._pendingTransforms.indexOf(n);e>-1&&this._pendingTransforms.splice(e,1),this._updateState()}}}function Kr(e){return e}const Gr=(e,t)=>{const n=e.threadIdMap[t];if(void 0!==n)return e.threadData[n]},Xr=(e,t,n)=>{const r=Gr(e,t);if(!r)return e;const{id:s,remoteId:i,status:o}=r;if(o===n)return e;const a={...e};switch(o){case"new":a.newThreadId=void 0;break;case"regular":a.threadIds=a.threadIds.filter(e=>e!==s);break;case"archived":a.archivedThreadIds=a.archivedThreadIds.filter(e=>e!==s);break;default:throw new Error(`Unsupported state: ${o}`)}switch(n){case"regular":a.threadIds=[s,...a.threadIds];break;case"archived":a.archivedThreadIds=[s,...a.archivedThreadIds];break;case"deleted":a.threadData=Object.fromEntries(Object.entries(a.threadData).filter(([e])=>e!==s)),a.threadIdMap=Object.fromEntries(Object.entries(a.threadIdMap).filter(([e])=>e!==s&&e!==i));break;default:throw new Error(`Unsupported state: ${n}`)}return"deleted"!==n&&(a.threadData={...a.threadData,[s]:{...r,status:n}}),a};class Zr extends P{constructor(e,n){super(),d(this,"contextProvider"),d(this,"_options"),d(this,"_hookManager"),d(this,"_loadThreadsPromise"),d(this,"_mainThreadId"),d(this,"_state",new Yr({isLoading:!1,newThreadId:void 0,threadIds:[],archivedThreadIds:[],threadIdMap:{},threadData:{}})),d(this,"useProvider"),d(this,"initialize",async e=>{if(this._state.value.newThreadId!==e){const t=this.getItemById(e);if(!t)throw new Error("Thread not found");if("new"===t.status)throw new Error("Unexpected new state");return t.initializeTask}return this._state.optimisticUpdate({execute:()=>this._options.adapter.initialize(e),optimistic:t=>Xr(t,e,"regular"),loading:(t,n)=>{const r=e;return{...t,threadData:{...t.threadData,[r]:{...t.threadData[r],initializeTask:n}}}},then:(t,{remoteId:n,externalId:r})=>{const s=Gr(t,e);if(!s)return t;const i=e;return{...t,threadIdMap:{...t.threadIdMap,[n]:i},threadData:{...t.threadData,[i]:{...s,initializeTask:Promise.resolve({remoteId:n,externalId:r}),remoteId:n,externalId:r}}}}})}),d(this,"generateTitle",async e=>{var t;const n=this.getItemById(e);if(!n)throw new Error("Thread not found");if("new"===n.status)throw new Error("Thread is not yet initialized");const{remoteId:r}=await n.initializeTask,s=this._hookManager.getThreadRuntimeCore(n.id);if(!s)return;const i=s.messages,o=await this._options.adapter.generateTitle(r,i),a=Ye.fromAssistantStream(o);for await(const c of a){const e=null==(t=c.parts.filter(e=>"text"===e.type)[0])?void 0:t.text,r=this._state.baseValue;this._state.update({...r,threadData:{...r.threadData,[n.id]:{...n,title:e}}})}}),d(this,"useBoundIds",Kt(()=>[])),d(this,"__internal_RenderComponent",()=>{const e=t.useId();t.useEffect(()=>(this.useBoundIds.setState(t=>[...t,e],!0),()=>{this.useBoundIds.setState(t=>t.filter(t=>t!==e),!0)}),[e]);const n=this.useBoundIds(),{Provider:r}=this.useProvider(),s={modelContext:this.contextProvider};return(0===n.length||n[0]===e)&&A.jsx(at,{adapters:s,children:A.jsx(this._hookManager.__internal_RenderThreadRuntimes,{provider:r})})}),this.contextProvider=n,this._state.subscribe(()=>this._notifySubscribers()),this._hookManager=new Hr(e.runtimeHook),this.useProvider=Kt(()=>({Provider:e.adapter.unstable_Provider??t.Fragment})),this.__internal_setOptions(e),this.switchToNewThread()}get threadData(){return this._state.value.threadData}getLoadThreadsPromise(){return this._loadThreadsPromise||(this._loadThreadsPromise=this._state.optimisticUpdate({execute:()=>this._options.adapter.list(),loading:e=>({...e,isLoading:!0}),then:(e,t)=>{const n=[],r=[],s={},i={};for(const o of t.threads){switch(o.status){case"regular":n.push(o.remoteId);break;case"archived":r.push(o.remoteId);break;default:{const e=o.status;throw new Error(`Unsupported state: ${e}`)}}const e=Kr(o.remoteId);s[o.remoteId]=e,i[e]={id:o.remoteId,remoteId:o.remoteId,externalId:o.externalId,status:o.status,title:o.title,initializeTask:Promise.resolve({remoteId:o.remoteId,externalId:o.externalId})}}return{...e,threadIds:n,archivedThreadIds:r,threadIdMap:{...e.threadIdMap,...s},threadData:{...e.threadData,...i}}}}).then(()=>{})),this._loadThreadsPromise}__internal_setOptions(e){if(this._options===e)return;this._options=e;const n=e.adapter.unstable_Provider??t.Fragment;n!==this.useProvider.getState().Provider&&this.useProvider.setState({Provider:n},!0),this._hookManager.setRuntimeHook(e.runtimeHook)}__internal_load(){this.getLoadThreadsPromise()}get isLoading(){return this._state.value.isLoading}get threadIds(){return this._state.value.threadIds}get archivedThreadIds(){return this._state.value.archivedThreadIds}get newThreadId(){return this._state.value.newThreadId}get mainThreadId(){return this._mainThreadId}getMainThreadRuntimeCore(){const e=this._hookManager.getThreadRuntimeCore(this._mainThreadId);return e||qr}getThreadRuntimeCore(e){const t=this.getItemById(e);if(!t)throw new Error("Thread not found");const n=this._hookManager.getThreadRuntimeCore(t.id);if(!n)throw new Error("Thread not found");return n}getItemById(e){return Gr(this._state.value,e)}async switchToThread(e){let t=this.getItemById(e);if(!t){const n=await this._options.adapter.fetch(e),r=this._state.value,s=n.remoteId,i={...r.threadData,[s]:{id:s,initializeTask:Promise.resolve({remoteId:n.remoteId,externalId:n.externalId}),remoteId:n.remoteId,externalId:n.externalId,status:n.status,title:n.title}},o={...r.threadIdMap,[n.remoteId]:s},a="regular"===n.status?[...r.threadIds,n.remoteId]:r.threadIds,c="archived"===n.status?[...r.archivedThreadIds,n.remoteId]:r.archivedThreadIds;this._state.update({...r,threadIds:a,archivedThreadIds:c,threadIdMap:o,threadData:i}),t=this.getItemById(e)}if(!t)throw new Error("Thread not found");if(this._mainThreadId===t.id)return;const n=this._hookManager.startThreadRuntime(t.id);void 0!==this.mainThreadId?await n:n.then(()=>this._notifySubscribers()),"archived"===t.status&&await this.unarchive(t.id),this._mainThreadId=t.id,this._notifySubscribers()}async switchToNewThread(){for(;void 0!==this._state.baseValue.newThreadId&&void 0===this._state.value.newThreadId;)await this._state.waitForUpdate();const e=this._state.value;let t=this._state.value.newThreadId;if(void 0===t){do{t=`__LOCALID_${D()}`}while(e.threadIdMap[t]);const n=t;this._state.update({...e,newThreadId:t,threadIdMap:{...e.threadIdMap,[t]:n},threadData:{...e.threadData,[n]:{status:"new",id:t,remoteId:void 0,externalId:void 0,title:void 0}}})}return this.switchToThread(t)}rename(e,t){const n=this.getItemById(e);if(!n)throw new Error("Thread not found");if("new"===n.status)throw new Error("Thread is not yet initialized");return this._state.optimisticUpdate({execute:async()=>{const{remoteId:e}=await n.initializeTask;return this._options.adapter.rename(e,t)},optimistic:n=>{const r=Gr(n,e);return r?{...n,threadData:{...n.threadData,[r.id]:{...r,title:t}}}:n}})}async _ensureThreadIsNotMain(e){if(e===this.newThreadId)throw new Error("Cannot ensure new thread is not main");e===this._mainThreadId&&await this.switchToNewThread()}async archive(e){const t=this.getItemById(e);if(!t)throw new Error("Thread not found");if("regular"!==t.status)throw new Error("Thread is not yet initialized or already archived");return this._state.optimisticUpdate({execute:async()=>{await this._ensureThreadIsNotMain(t.id);const{remoteId:e}=await t.initializeTask;return this._options.adapter.archive(e)},optimistic:e=>Xr(e,t.id,"archived")})}unarchive(e){const t=this.getItemById(e);if(!t)throw new Error("Thread not found");if("archived"!==t.status)throw new Error("Thread is not archived");return this._state.optimisticUpdate({execute:async()=>{try{const{remoteId:e}=await t.initializeTask;return await this._options.adapter.unarchive(e)}catch(e){throw await this._ensureThreadIsNotMain(t.id),e}},optimistic:e=>Xr(e,t.id,"regular")})}async delete(e){const t=this.getItemById(e);if(!t)throw new Error("Thread not found");if("regular"!==t.status&&"archived"!==t.status)throw new Error("Thread is not yet initialized");return this._state.optimisticUpdate({execute:async()=>{await this._ensureThreadIsNotMain(t.id);const{remoteId:e}=await t.initializeTask;return await this._options.adapter.delete(e)},optimistic:e=>Xr(e,t.id,"deleted")})}async detach(e){const t=this.getItemById(e);if(!t)throw new Error("Thread not found");if("regular"!==t.status&&"archived"!==t.status)throw new Error("Thread is not yet initialized");await this._ensureThreadIsNotMain(t.id),this._hookManager.stopThreadRuntime(t.id)}}class Qr extends N{constructor(e){super(),d(this,"threads"),this.threads=new Zr(e,this._contextProvider)}get RenderComponent(){return this.threads.__internal_RenderComponent}}const es=e=>{if(null!==yn().threadListItem.source){if(!e.allowNesting)throw new Error("useRemoteThreadListRuntime cannot be nested inside another RemoteThreadListRuntime. Set allowNesting: true to allow nesting (the inner runtime will become a no-op).");return e.runtimeHook()}return(e=>{const[n]=t.useState(()=>new Qr(e));return t.useEffect(()=>{n.threads.__internal_setOptions(e),n.threads.__internal_load()},[n,e]),t.useMemo(()=>new Br(n),[n])})(e)};var ts=Symbol.for("react.lazy"),ns=v[" use ".trim().toString()];function rs(e){return null!=e&&"object"==typeof e&&"$$typeof"in e&&e.$$typeof===ts&&"_payload"in e&&("object"==typeof(t=e._payload)&&null!==t&&"then"in t);var t}function ss(e){const t=os(e),n=v.forwardRef((e,n)=>{let{children:r,...s}=e;rs(r)&&"function"==typeof ns&&(r=ns(r._payload));const i=v.Children.toArray(r),o=i.find(cs);if(o){const e=o.props.children,r=i.map(t=>t===o?v.Children.count(e)>1?v.Children.only(null):v.isValidElement(e)?e.props.children:null:t);return A.jsx(t,{...s,ref:n,children:v.isValidElement(e)?v.cloneElement(e,void 0,r):null})}return A.jsx(t,{...s,ref:n,children:r})});return n.displayName=`${e}.Slot`,n}var is=ss("Slot");function os(e){const t=v.forwardRef((e,t)=>{let{children:n,...r}=e;if(rs(n)&&"function"==typeof ns&&(n=ns(n._payload)),v.isValidElement(n)){const e=function(e){var t,n;let r=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,s=r&&"isReactWarning"in r&&r.isReactWarning;if(s)return e.ref;if(r=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,s=r&&"isReactWarning"in r&&r.isReactWarning,s)return e.props.ref;return e.props.ref||e.ref}(n),s=function(e,t){const n={...t};for(const r in t){const s=e[r],i=t[r];/^on[A-Z]/.test(r)?s&&i?n[r]=(...e)=>{const t=i(...e);return s(...e),t}:s&&(n[r]=s):"style"===r?n[r]={...s,...i}:"className"===r&&(n[r]=[s,i].filter(Boolean).join(" "))}return{...e,...n}}(r,n.props);return n.type!==v.Fragment&&(s.ref=t?Xt(t,e):e),v.cloneElement(n,s)}return v.Children.count(n)>1?v.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var as=Symbol("radix.slottable");function cs(e){return v.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===as}var ls,us,ds=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{const n=ss(`Primitive.${t}`),r=v.forwardRef((e,r)=>{const{asChild:s,...i}=e,o=s?n:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),A.jsx(o,{...i,ref:r})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{});(us=ls||(ls={})).Hidden="hidden",us.Floating="floating",us.Normal="normal";const hs=t.forwardRef(({hideWhenRunning:e,autohide:t,autohideFloat:n,...r},s)=>{const i=(({hideWhenRunning:e,autohide:t,autohideFloat:n})=>En(({thread:r,message:s})=>e&&r.isRunning?ls.Hidden:"always"===t||"not-last"===t&&!s.isLast?s.isHovering?"always"===n||"single-branch"===n&&s.branchCount<=1?ls.Floating:ls.Normal:ls.Hidden:ls.Normal))({hideWhenRunning:e,autohide:t,autohideFloat:n});return i===ls.Hidden?null:A.jsx(ds.div,{...i===ls.Floating?{"data-floating":"true"}:null,...r,ref:s})});function ps(e,t,{checkForDefaultPrevented:n=!0}={}){return function(r){if(null==e||e(r),!1===n||!r.defaultPrevented)return null==t?void 0:t(r)}}hs.displayName="ActionBarPrimitive.Root";const fs=t.forwardRef(({copiedDuration:e,onClick:n,disabled:r,...s},i)=>{const o=En(({message:e})=>e.isCopied),a=(({copiedDuration:e=3e3}={})=>{const n=wn(),r=En(({message:e})=>{var t;return("assistant"!==e.role||"running"!==(null==(t=e.status)?void 0:t.type))&&e.parts.some(e=>"text"===e.type&&e.text.length>0)}),s=En(({composer:e})=>e.isEditing),i=En(({composer:e})=>e.text),o=t.useCallback(()=>{const t=s?i:n.message().getCopyText();t&&navigator.clipboard.writeText(t).then(()=>{n.message().setIsCopied(!0),setTimeout(()=>n.message().setIsCopied(!1),e)})},[n,s,i,e]);return r?o:null})({copiedDuration:e});return A.jsx(ds.button,{type:"button",...o?{"data-copied":"true"}:{},...s,ref:i,disabled:r||!a,onClick:ps(n,()=>{null==a||a()})})});fs.displayName="ActionBarPrimitive.Copy";const ms=(e,n,r=[])=>{const s=t.forwardRef((e,t)=>{const s={},i={};Object.keys(e).forEach(t=>{r.includes(t)?s[t]=e[t]:i[t]=e[t]});const o=n(s)??void 0;return A.jsx(ds.button,{type:"button",...i,ref:t,disabled:i.disabled||!o,onClick:ps(i.onClick,o)})});return s.displayName=e,s};function gs(e,t=(null==globalThis?void 0:globalThis.document)){const n=Dr(e);v.useEffect(()=>{const e=e=>{"Escape"===e.key&&n(e)};return t.addEventListener("keydown",e,{capture:!0}),()=>t.removeEventListener("keydown",e,{capture:!0})},[n,t])}function vs(...e){const t=e[0];if(1===e.length)return t;const n=()=>{const n=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){const r=n.reduce((t,{useScope:n,scopeName:r})=>({...t,...n(e)[`__scope${r}`]}),{});return v.useMemo(()=>({[`__scope${t.scopeName}`]:r}),[r])}};return n.scopeName=t.scopeName,n}function ys(e){const t=bs(e),n=v.forwardRef((e,n)=>{const{children:r,...s}=e,i=v.Children.toArray(r),o=i.find(xs);if(o){const e=o.props.children,r=i.map(t=>t===o?v.Children.count(e)>1?v.Children.only(null):v.isValidElement(e)?e.props.children:null:t);return A.jsx(t,{...s,ref:n,children:v.isValidElement(e)?v.cloneElement(e,void 0,r):null})}return A.jsx(t,{...s,ref:n,children:r})});return n.displayName=`${e}.Slot`,n}function bs(e){const t=v.forwardRef((e,t)=>{const{children:n,...r}=e;if(v.isValidElement(n)){const e=function(e){var t,n;let r=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,s=r&&"isReactWarning"in r&&r.isReactWarning;if(s)return e.ref;if(r=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,s=r&&"isReactWarning"in r&&r.isReactWarning,s)return e.props.ref;return e.props.ref||e.ref}(n),s=function(e,t){const n={...t};for(const r in t){const s=e[r],i=t[r];/^on[A-Z]/.test(r)?s&&i?n[r]=(...e)=>{const t=i(...e);return s(...e),t}:s&&(n[r]=s):"style"===r?n[r]={...s,...i}:"className"===r&&(n[r]=[s,i].filter(Boolean).join(" "))}return{...e,...n}}(r,n.props);return n.type!==v.Fragment&&(s.ref=t?Xt(t,e):e),v.cloneElement(n,s)}return v.Children.count(n)>1?v.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var ws=Symbol("radix.slottable");function xs(e){return v.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===ws}var _s=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{const n=ys(`Primitive.${t}`),r=v.forwardRef((e,r)=>{const{asChild:s,...i}=e,o=s?n:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),A.jsx(o,{...i,ref:r})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{});var Ss,Es="dismissableLayer.update",Is="dismissableLayer.pointerDownOutside",Ts="dismissableLayer.focusOutside",Cs=v.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Rs=v.forwardRef((e,t)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:s,onFocusOutside:i,onInteractOutside:o,onDismiss:a,...c}=e,l=v.useContext(Cs),[u,d]=v.useState(null),h=(null==u?void 0:u.ownerDocument)??(null==globalThis?void 0:globalThis.document),[,p]=v.useState({}),f=Zt(t,e=>d(e)),m=Array.from(l.layers),[g]=[...l.layersWithOutsidePointerEventsDisabled].slice(-1),y=m.indexOf(g),b=u?m.indexOf(u):-1,w=l.layersWithOutsidePointerEventsDisabled.size>0,x=b>=y,_=function(e,t=(null==globalThis?void 0:globalThis.document)){const n=Dr(e),r=v.useRef(!1),s=v.useRef(()=>{});return v.useEffect(()=>{const e=e=>{if(e.target&&!r.current){let r=function(){js(Is,n,i,{discrete:!0})};const i={originalEvent:e};"touch"===e.pointerType?(t.removeEventListener("click",s.current),s.current=r,t.addEventListener("click",s.current,{once:!0})):r()}else t.removeEventListener("click",s.current);r.current=!1},i=window.setTimeout(()=>{t.addEventListener("pointerdown",e)},0);return()=>{window.clearTimeout(i),t.removeEventListener("pointerdown",e),t.removeEventListener("click",s.current)}},[t,n]),{onPointerDownCapture:()=>r.current=!0}}(e=>{const t=e.target,n=[...l.branches].some(e=>e.contains(t));x&&!n&&(null==s||s(e),null==o||o(e),e.defaultPrevented||null==a||a())},h),S=function(e,t=(null==globalThis?void 0:globalThis.document)){const n=Dr(e),r=v.useRef(!1);return v.useEffect(()=>{const e=e=>{if(e.target&&!r.current){js(Ts,n,{originalEvent:e},{discrete:!1})}};return t.addEventListener("focusin",e),()=>t.removeEventListener("focusin",e)},[t,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}(e=>{const t=e.target;[...l.branches].some(e=>e.contains(t))||(null==i||i(e),null==o||o(e),e.defaultPrevented||null==a||a())},h);return gs(e=>{b===l.layers.size-1&&(null==r||r(e),!e.defaultPrevented&&a&&(e.preventDefault(),a()))},h),v.useEffect(()=>{if(u)return n&&(0===l.layersWithOutsidePointerEventsDisabled.size&&(Ss=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),l.layersWithOutsidePointerEventsDisabled.add(u)),l.layers.add(u),As(),()=>{n&&1===l.layersWithOutsidePointerEventsDisabled.size&&(h.body.style.pointerEvents=Ss)}},[u,h,n,l]),v.useEffect(()=>()=>{u&&(l.layers.delete(u),l.layersWithOutsidePointerEventsDisabled.delete(u),As())},[u,l]),v.useEffect(()=>{const e=()=>p({});return document.addEventListener(Es,e),()=>document.removeEventListener(Es,e)},[]),A.jsx(_s.div,{...c,ref:f,style:{pointerEvents:w?x?"auto":"none":void 0,...e.style},onFocusCapture:ps(e.onFocusCapture,S.onFocusCapture),onBlurCapture:ps(e.onBlurCapture,S.onBlurCapture),onPointerDownCapture:ps(e.onPointerDownCapture,_.onPointerDownCapture)})});Rs.displayName="DismissableLayer";var ks=v.forwardRef((e,t)=>{const n=v.useContext(Cs),r=v.useRef(null),s=Zt(t,r);return v.useEffect(()=>{const e=r.current;if(e)return n.branches.add(e),()=>{n.branches.delete(e)}},[n.branches]),A.jsx(_s.div,{...e,ref:s})});function As(){const e=new CustomEvent(Es);document.dispatchEvent(e)}function js(e,t,n,{discrete:r}){const s=n.originalEvent.target,i=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&s.addEventListener(e,t,{once:!0}),r?function(e,t){e&&y.flushSync(()=>e.dispatchEvent(t))}(s,i):s.dispatchEvent(i)}ks.displayName="DismissableLayerBranch";var Ms=0;function Ns(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}function Ps(e){const t=Os(e),n=v.forwardRef((e,n)=>{const{children:r,...s}=e,i=v.Children.toArray(r),o=i.find(Bs);if(o){const e=o.props.children,r=i.map(t=>t===o?v.Children.count(e)>1?v.Children.only(null):v.isValidElement(e)?e.props.children:null:t);return A.jsx(t,{...s,ref:n,children:v.isValidElement(e)?v.cloneElement(e,void 0,r):null})}return A.jsx(t,{...s,ref:n,children:r})});return n.displayName=`${e}.Slot`,n}function Os(e){const t=v.forwardRef((e,t)=>{const{children:n,...r}=e;if(v.isValidElement(n)){const e=function(e){var t,n;let r=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,s=r&&"isReactWarning"in r&&r.isReactWarning;if(s)return e.ref;if(r=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,s=r&&"isReactWarning"in r&&r.isReactWarning,s)return e.props.ref;return e.props.ref||e.ref}(n),s=function(e,t){const n={...t};for(const r in t){const s=e[r],i=t[r];/^on[A-Z]/.test(r)?s&&i?n[r]=(...e)=>{const t=i(...e);return s(...e),t}:s&&(n[r]=s):"style"===r?n[r]={...s,...i}:"className"===r&&(n[r]=[s,i].filter(Boolean).join(" "))}return{...e,...n}}(r,n.props);return n.type!==v.Fragment&&(s.ref=t?Xt(t,e):e),v.cloneElement(n,s)}return v.Children.count(n)>1?v.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var Ls=Symbol("radix.slottable");function Bs(e){return v.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===Ls}var Ds=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{const n=Ps(`Primitive.${t}`),r=v.forwardRef((e,r)=>{const{asChild:s,...i}=e,o=s?n:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),A.jsx(o,{...i,ref:r})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{}),Fs="focusScope.autoFocusOnMount",$s="focusScope.autoFocusOnUnmount",Us={bubbles:!1,cancelable:!0},zs=v.forwardRef((e,t)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:s,onUnmountAutoFocus:i,...o}=e,[a,c]=v.useState(null),l=Dr(s),u=Dr(i),d=v.useRef(null),h=Zt(t,e=>c(e)),p=v.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;v.useEffect(()=>{if(r){let e=function(e){if(p.paused||!a)return;const t=e.target;a.contains(t)?d.current=t:qs(d.current,{select:!0})},t=function(e){if(p.paused||!a)return;const t=e.relatedTarget;null!==t&&(a.contains(t)||qs(d.current,{select:!0}))},n=function(e){if(document.activeElement===document.body)for(const t of e)t.removedNodes.length>0&&qs(a)};document.addEventListener("focusin",e),document.addEventListener("focusout",t);const r=new MutationObserver(n);return a&&r.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",e),document.removeEventListener("focusout",t),r.disconnect()}}},[r,a,p.paused]),v.useEffect(()=>{if(a){Js.add(p);const t=document.activeElement;if(!a.contains(t)){const n=new CustomEvent(Fs,Us);a.addEventListener(Fs,l),a.dispatchEvent(n),n.defaultPrevented||(!function(e,{select:t=!1}={}){const n=document.activeElement;for(const r of e)if(qs(r,{select:t}),document.activeElement!==n)return}((e=Ws(a),e.filter(e=>"A"!==e.tagName)),{select:!0}),document.activeElement===t&&qs(a))}return()=>{a.removeEventListener(Fs,l),setTimeout(()=>{const e=new CustomEvent($s,Us);a.addEventListener($s,u),a.dispatchEvent(e),e.defaultPrevented||qs(t??document.body,{select:!0}),a.removeEventListener($s,u),Js.remove(p)},0)}}var e},[a,l,u,p]);const f=v.useCallback(e=>{if(!n&&!r)return;if(p.paused)return;const t="Tab"===e.key&&!e.altKey&&!e.ctrlKey&&!e.metaKey,s=document.activeElement;if(t&&s){const t=e.currentTarget,[r,i]=function(e){const t=Ws(e),n=Hs(t,e),r=Hs(t.reverse(),e);return[n,r]}(t);r&&i?e.shiftKey||s!==i?e.shiftKey&&s===r&&(e.preventDefault(),n&&qs(i,{select:!0})):(e.preventDefault(),n&&qs(r,{select:!0})):s===t&&e.preventDefault()}},[n,r,p.paused]);return A.jsx(Ds.div,{tabIndex:-1,...o,ref:h,onKeyDown:f})});function Ws(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function Hs(e,t){for(const n of e)if(!Vs(n,{upTo:t}))return n}function Vs(e,{upTo:t}){if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(void 0!==t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}function qs(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&function(e){return e instanceof HTMLInputElement&&"select"in e}(e)&&t&&e.select()}}zs.displayName="FocusScope";var Js=function(){let e=[];return{add(t){const n=e[0];t!==n&&(null==n||n.pause()),e=Ys(e,t),e.unshift(t)},remove(t){var n;e=Ys(e,t),null==(n=e[0])||n.resume()}}}();function Ys(e,t){const n=[...e],r=n.indexOf(t);return-1!==r&&n.splice(r,1),n}var Ks=(null==globalThis?void 0:globalThis.document)?v.useLayoutEffect:()=>{},Gs=v[" useId ".trim().toString()]||(()=>{}),Xs=0;function Zs(e){const[t,n]=v.useState(Gs());return Ks(()=>{n(e=>e??String(Xs++))},[e]),e||(t?`radix-${t}`:"")}const Qs=["top","right","bottom","left"],ei=Math.min,ti=Math.max,ni=Math.round,ri=Math.floor,si=e=>({x:e,y:e}),ii={left:"right",right:"left",bottom:"top",top:"bottom"},oi={start:"end",end:"start"};function ai(e,t,n){return ti(e,ei(t,n))}function ci(e,t){return"function"==typeof e?e(t):e}function li(e){return e.split("-")[0]}function ui(e){return e.split("-")[1]}function di(e){return"x"===e?"y":"x"}function hi(e){return"y"===e?"height":"width"}const pi=new Set(["top","bottom"]);function fi(e){return pi.has(li(e))?"y":"x"}function mi(e){return di(fi(e))}function gi(e){return e.replace(/start|end/g,e=>oi[e])}const vi=["left","right"],yi=["right","left"],bi=["top","bottom"],wi=["bottom","top"];function xi(e,t,n,r){const s=ui(e);let i=function(e,t,n){switch(e){case"top":case"bottom":return n?t?yi:vi:t?vi:yi;case"left":case"right":return t?bi:wi;default:return[]}}(li(e),"start"===n,r);return s&&(i=i.map(e=>e+"-"+s),t&&(i=i.concat(i.map(gi)))),i}function _i(e){return e.replace(/left|right|bottom|top/g,e=>ii[e])}function Si(e){return"number"!=typeof e?function(e){return{top:0,right:0,bottom:0,left:0,...e}}(e):{top:e,right:e,bottom:e,left:e}}function Ei(e){const{x:t,y:n,width:r,height:s}=e;return{width:r,height:s,top:n,left:t,right:t+r,bottom:n+s,x:t,y:n}}function Ii(e,t,n){let{reference:r,floating:s}=e;const i=fi(t),o=mi(t),a=hi(o),c=li(t),l="y"===i,u=r.x+r.width/2-s.width/2,d=r.y+r.height/2-s.height/2,h=r[a]/2-s[a]/2;let p;switch(c){case"top":p={x:u,y:r.y-s.height};break;case"bottom":p={x:u,y:r.y+r.height};break;case"right":p={x:r.x+r.width,y:d};break;case"left":p={x:r.x-s.width,y:d};break;default:p={x:r.x,y:r.y}}switch(ui(t)){case"start":p[o]-=h*(n&&l?-1:1);break;case"end":p[o]+=h*(n&&l?-1:1)}return p}async function Ti(e,t){var n;void 0===t&&(t={});const{x:r,y:s,platform:i,rects:o,elements:a,strategy:c}=e,{boundary:l="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:h=!1,padding:p=0}=ci(t,e),f=Si(p),m=a[h?"floating"===d?"reference":"floating":d],g=Ei(await i.getClippingRect({element:null==(n=await(null==i.isElement?void 0:i.isElement(m)))||n?m:m.contextElement||await(null==i.getDocumentElement?void 0:i.getDocumentElement(a.floating)),boundary:l,rootBoundary:u,strategy:c})),v="floating"===d?{x:r,y:s,width:o.floating.width,height:o.floating.height}:o.reference,y=await(null==i.getOffsetParent?void 0:i.getOffsetParent(a.floating)),b=await(null==i.isElement?void 0:i.isElement(y))&&await(null==i.getScale?void 0:i.getScale(y))||{x:1,y:1},w=Ei(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:v,offsetParent:y,strategy:c}):v);return{top:(g.top-w.top+f.top)/b.y,bottom:(w.bottom-g.bottom+f.bottom)/b.y,left:(g.left-w.left+f.left)/b.x,right:(w.right-g.right+f.right)/b.x}}function Ci(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function Ri(e){return Qs.some(t=>e[t]>=0)}const ki=new Set(["left","top"]);function Ai(){return"undefined"!=typeof window}function ji(e){return Pi(e)?(e.nodeName||"").toLowerCase():"#document"}function Mi(e){var t;return(null==e||null==(t=e.ownerDocument)?void 0:t.defaultView)||window}function Ni(e){var t;return null==(t=(Pi(e)?e.ownerDocument:e.document)||window.document)?void 0:t.documentElement}function Pi(e){return!!Ai()&&(e instanceof Node||e instanceof Mi(e).Node)}function Oi(e){return!!Ai()&&(e instanceof Element||e instanceof Mi(e).Element)}function Li(e){return!!Ai()&&(e instanceof HTMLElement||e instanceof Mi(e).HTMLElement)}function Bi(e){return!(!Ai()||"undefined"==typeof ShadowRoot)&&(e instanceof ShadowRoot||e instanceof Mi(e).ShadowRoot)}const Di=new Set(["inline","contents"]);function Fi(e){const{overflow:t,overflowX:n,overflowY:r,display:s}=Xi(e);return/auto|scroll|overlay|hidden|clip/.test(t+r+n)&&!Di.has(s)}const $i=new Set(["table","td","th"]);function Ui(e){return $i.has(ji(e))}const zi=[":popover-open",":modal"];function Wi(e){return zi.some(t=>{try{return e.matches(t)}catch(n){return!1}})}const Hi=["transform","translate","scale","rotate","perspective"],Vi=["transform","translate","scale","rotate","perspective","filter"],qi=["paint","layout","strict","content"];function Ji(e){const t=Yi(),n=Oi(e)?Xi(e):e;return Hi.some(e=>!!n[e]&&"none"!==n[e])||!!n.containerType&&"normal"!==n.containerType||!t&&!!n.backdropFilter&&"none"!==n.backdropFilter||!t&&!!n.filter&&"none"!==n.filter||Vi.some(e=>(n.willChange||"").includes(e))||qi.some(e=>(n.contain||"").includes(e))}function Yi(){return!("undefined"==typeof CSS||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}const Ki=new Set(["html","body","#document"]);function Gi(e){return Ki.has(ji(e))}function Xi(e){return Mi(e).getComputedStyle(e)}function Zi(e){return Oi(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Qi(e){if("html"===ji(e))return e;const t=e.assignedSlot||e.parentNode||Bi(e)&&e.host||Ni(e);return Bi(t)?t.host:t}function eo(e){const t=Qi(e);return Gi(t)?e.ownerDocument?e.ownerDocument.body:e.body:Li(t)&&Fi(t)?t:eo(t)}function to(e,t,n){var r;void 0===t&&(t=[]),void 0===n&&(n=!0);const s=eo(e),i=s===(null==(r=e.ownerDocument)?void 0:r.body),o=Mi(s);if(i){const e=no(o);return t.concat(o,o.visualViewport||[],Fi(s)?s:[],e&&n?to(e):[])}return t.concat(s,to(s,[],n))}function no(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function ro(e){const t=Xi(e);let n=parseFloat(t.width)||0,r=parseFloat(t.height)||0;const s=Li(e),i=s?e.offsetWidth:n,o=s?e.offsetHeight:r,a=ni(n)!==i||ni(r)!==o;return a&&(n=i,r=o),{width:n,height:r,$:a}}function so(e){return Oi(e)?e:e.contextElement}function io(e){const t=so(e);if(!Li(t))return si(1);const n=t.getBoundingClientRect(),{width:r,height:s,$:i}=ro(t);let o=(i?ni(n.width):n.width)/r,a=(i?ni(n.height):n.height)/s;return o&&Number.isFinite(o)||(o=1),a&&Number.isFinite(a)||(a=1),{x:o,y:a}}const oo=si(0);function ao(e){const t=Mi(e);return Yi()&&t.visualViewport?{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}:oo}function co(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=!1);const s=e.getBoundingClientRect(),i=so(e);let o=si(1);t&&(r?Oi(r)&&(o=io(r)):o=io(e));const a=function(e,t,n){return void 0===t&&(t=!1),!(!n||t&&n!==Mi(e))&&t}(i,n,r)?ao(i):si(0);let c=(s.left+a.x)/o.x,l=(s.top+a.y)/o.y,u=s.width/o.x,d=s.height/o.y;if(i){const e=Mi(i),t=r&&Oi(r)?Mi(r):r;let n=e,s=no(n);for(;s&&r&&t!==n;){const e=io(s),t=s.getBoundingClientRect(),r=Xi(s),i=t.left+(s.clientLeft+parseFloat(r.paddingLeft))*e.x,o=t.top+(s.clientTop+parseFloat(r.paddingTop))*e.y;c*=e.x,l*=e.y,u*=e.x,d*=e.y,c+=i,l+=o,n=Mi(s),s=no(n)}}return Ei({width:u,height:d,x:c,y:l})}function lo(e,t){const n=Zi(e).scrollLeft;return t?t.left+n:co(Ni(e)).left+n}function uo(e,t){const n=e.getBoundingClientRect();return{x:n.left+t.scrollLeft-lo(e,n),y:n.top+t.scrollTop}}const ho=new Set(["absolute","fixed"]);function po(e,t,n){let r;if("viewport"===t)r=function(e,t){const n=Mi(e),r=Ni(e),s=n.visualViewport;let i=r.clientWidth,o=r.clientHeight,a=0,c=0;if(s){i=s.width,o=s.height;const e=Yi();(!e||e&&"fixed"===t)&&(a=s.offsetLeft,c=s.offsetTop)}const l=lo(r);if(l<=0){const e=r.ownerDocument,t=e.body,n=getComputedStyle(t),s="CSS1Compat"===e.compatMode&&parseFloat(n.marginLeft)+parseFloat(n.marginRight)||0,o=Math.abs(r.clientWidth-t.clientWidth-s);o<=25&&(i-=o)}else l<=25&&(i+=l);return{width:i,height:o,x:a,y:c}}(e,n);else if("document"===t)r=function(e){const t=Ni(e),n=Zi(e),r=e.ownerDocument.body,s=ti(t.scrollWidth,t.clientWidth,r.scrollWidth,r.clientWidth),i=ti(t.scrollHeight,t.clientHeight,r.scrollHeight,r.clientHeight);let o=-n.scrollLeft+lo(e);const a=-n.scrollTop;return"rtl"===Xi(r).direction&&(o+=ti(t.clientWidth,r.clientWidth)-s),{width:s,height:i,x:o,y:a}}(Ni(e));else if(Oi(t))r=function(e,t){const n=co(e,!0,"fixed"===t),r=n.top+e.clientTop,s=n.left+e.clientLeft,i=Li(e)?io(e):si(1);return{width:e.clientWidth*i.x,height:e.clientHeight*i.y,x:s*i.x,y:r*i.y}}(t,n);else{const n=ao(e);r={x:t.x-n.x,y:t.y-n.y,width:t.width,height:t.height}}return Ei(r)}function fo(e,t){const n=Qi(e);return!(n===t||!Oi(n)||Gi(n))&&("fixed"===Xi(n).position||fo(n,t))}function mo(e,t,n){const r=Li(t),s=Ni(t),i="fixed"===n,o=co(e,!0,i,t);let a={scrollLeft:0,scrollTop:0};const c=si(0);function l(){c.x=lo(s)}if(r||!r&&!i)if(("body"!==ji(t)||Fi(s))&&(a=Zi(t)),r){const e=co(t,!0,i,t);c.x=e.x+t.clientLeft,c.y=e.y+t.clientTop}else s&&l();i&&!r&&s&&l();const u=!s||r||i?si(0):uo(s,a);return{x:o.left+a.scrollLeft-c.x-u.x,y:o.top+a.scrollTop-c.y-u.y,width:o.width,height:o.height}}function go(e){return"static"===Xi(e).position}function vo(e,t){if(!Li(e)||"fixed"===Xi(e).position)return null;if(t)return t(e);let n=e.offsetParent;return Ni(e)===n&&(n=n.ownerDocument.body),n}function yo(e,t){const n=Mi(e);if(Wi(e))return n;if(!Li(e)){let t=Qi(e);for(;t&&!Gi(t);){if(Oi(t)&&!go(t))return t;t=Qi(t)}return n}let r=vo(e,t);for(;r&&Ui(r)&&go(r);)r=vo(r,t);return r&&Gi(r)&&go(r)&&!Ji(r)?n:r||function(e){let t=Qi(e);for(;Li(t)&&!Gi(t);){if(Ji(t))return t;if(Wi(t))return null;t=Qi(t)}return null}(e)||n}const bo={convertOffsetParentRelativeRectToViewportRelativeRect:function(e){let{elements:t,rect:n,offsetParent:r,strategy:s}=e;const i="fixed"===s,o=Ni(r),a=!!t&&Wi(t.floating);if(r===o||a&&i)return n;let c={scrollLeft:0,scrollTop:0},l=si(1);const u=si(0),d=Li(r);if((d||!d&&!i)&&(("body"!==ji(r)||Fi(o))&&(c=Zi(r)),Li(r))){const e=co(r);l=io(r),u.x=e.x+r.clientLeft,u.y=e.y+r.clientTop}const h=!o||d||i?si(0):uo(o,c);return{width:n.width*l.x,height:n.height*l.y,x:n.x*l.x-c.scrollLeft*l.x+u.x+h.x,y:n.y*l.y-c.scrollTop*l.y+u.y+h.y}},getDocumentElement:Ni,getClippingRect:function(e){let{element:t,boundary:n,rootBoundary:r,strategy:s}=e;const i=[..."clippingAncestors"===n?Wi(t)?[]:function(e,t){const n=t.get(e);if(n)return n;let r=to(e,[],!1).filter(e=>Oi(e)&&"body"!==ji(e)),s=null;const i="fixed"===Xi(e).position;let o=i?Qi(e):e;for(;Oi(o)&&!Gi(o);){const t=Xi(o),n=Ji(o);n||"fixed"!==t.position||(s=null),(i?!n&&!s:!n&&"static"===t.position&&s&&ho.has(s.position)||Fi(o)&&!n&&fo(e,o))?r=r.filter(e=>e!==o):s=t,o=Qi(o)}return t.set(e,r),r}(t,this._c):[].concat(n),r],o=i[0],a=i.reduce((e,n)=>{const r=po(t,n,s);return e.top=ti(r.top,e.top),e.right=ei(r.right,e.right),e.bottom=ei(r.bottom,e.bottom),e.left=ti(r.left,e.left),e},po(t,o,s));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}},getOffsetParent:yo,getElementRects:async function(e){const t=this.getOffsetParent||yo,n=this.getDimensions,r=await n(e.floating);return{reference:mo(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}},getClientRects:function(e){return Array.from(e.getClientRects())},getDimensions:function(e){const{width:t,height:n}=ro(e);return{width:t,height:n}},getScale:io,isElement:Oi,isRTL:function(e){return"rtl"===Xi(e).direction}};function wo(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function xo(e,t,n,r){void 0===r&&(r={});const{ancestorScroll:s=!0,ancestorResize:i=!0,elementResize:o="function"==typeof ResizeObserver,layoutShift:a="function"==typeof IntersectionObserver,animationFrame:c=!1}=r,l=so(e),u=s||i?[...l?to(l):[],...to(t)]:[];u.forEach(e=>{s&&e.addEventListener("scroll",n,{passive:!0}),i&&e.addEventListener("resize",n)});const d=l&&a?function(e,t){let n,r=null;const s=Ni(e);function i(){var e;clearTimeout(n),null==(e=r)||e.disconnect(),r=null}return function o(a,c){void 0===a&&(a=!1),void 0===c&&(c=1),i();const l=e.getBoundingClientRect(),{left:u,top:d,width:h,height:p}=l;if(a||t(),!h||!p)return;const f={rootMargin:-ri(d)+"px "+-ri(s.clientWidth-(u+h))+"px "+-ri(s.clientHeight-(d+p))+"px "+-ri(u)+"px",threshold:ti(0,ei(1,c))||1};let m=!0;function g(t){const r=t[0].intersectionRatio;if(r!==c){if(!m)return o();r?o(!1,r):n=setTimeout(()=>{o(!1,1e-7)},1e3)}1!==r||wo(l,e.getBoundingClientRect())||o(),m=!1}try{r=new IntersectionObserver(g,{...f,root:s.ownerDocument})}catch(v){r=new IntersectionObserver(g,f)}r.observe(e)}(!0),i}(l,n):null;let h,p=-1,f=null;o&&(f=new ResizeObserver(e=>{let[r]=e;r&&r.target===l&&f&&(f.unobserve(t),cancelAnimationFrame(p),p=requestAnimationFrame(()=>{var e;null==(e=f)||e.observe(t)})),n()}),l&&!c&&f.observe(l),f.observe(t));let m=c?co(e):null;return c&&function t(){const r=co(e);m&&!wo(m,r)&&n();m=r,h=requestAnimationFrame(t)}(),n(),()=>{var e;u.forEach(e=>{s&&e.removeEventListener("scroll",n),i&&e.removeEventListener("resize",n)}),null==d||d(),null==(e=f)||e.disconnect(),f=null,c&&cancelAnimationFrame(h)}}const _o=function(e){return void 0===e&&(e=0),{name:"offset",options:e,async fn(t){var n,r;const{x:s,y:i,placement:o,middlewareData:a}=t,c=await async function(e,t){const{placement:n,platform:r,elements:s}=e,i=await(null==r.isRTL?void 0:r.isRTL(s.floating)),o=li(n),a=ui(n),c="y"===fi(n),l=ki.has(o)?-1:1,u=i&&c?-1:1,d=ci(t,e);let{mainAxis:h,crossAxis:p,alignmentAxis:f}="number"==typeof d?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&"number"==typeof f&&(p="end"===a?-1*f:f),c?{x:p*u,y:h*l}:{x:h*l,y:p*u}}(t,e);return o===(null==(n=a.offset)?void 0:n.placement)&&null!=(r=a.arrow)&&r.alignmentOffset?{}:{x:s+c.x,y:i+c.y,data:{...c,placement:o}}}}},So=function(e){return void 0===e&&(e={}),{name:"shift",options:e,async fn(t){const{x:n,y:r,placement:s}=t,{mainAxis:i=!0,crossAxis:o=!1,limiter:a={fn:e=>{let{x:t,y:n}=e;return{x:t,y:n}}},...c}=ci(e,t),l={x:n,y:r},u=await Ti(t,c),d=fi(li(s)),h=di(d);let p=l[h],f=l[d];if(i){const e="y"===h?"bottom":"right";p=ai(p+u["y"===h?"top":"left"],p,p-u[e])}if(o){const e="y"===d?"bottom":"right";f=ai(f+u["y"===d?"top":"left"],f,f-u[e])}const m=a.fn({...t,[h]:p,[d]:f});return{...m,data:{x:m.x-n,y:m.y-r,enabled:{[h]:i,[d]:o}}}}}},Eo=function(e){return void 0===e&&(e={}),{name:"flip",options:e,async fn(t){var n,r;const{placement:s,middlewareData:i,rects:o,initialPlacement:a,platform:c,elements:l}=t,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:h,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:f="none",flipAlignment:m=!0,...g}=ci(e,t);if(null!=(n=i.arrow)&&n.alignmentOffset)return{};const v=li(s),y=fi(a),b=li(a)===a,w=await(null==c.isRTL?void 0:c.isRTL(l.floating)),x=h||(b||!m?[_i(a)]:function(e){const t=_i(e);return[gi(e),t,gi(t)]}(a)),_="none"!==f;!h&&_&&x.push(...xi(a,m,f,w));const S=[a,...x],E=await Ti(t,g),I=[];let T=(null==(r=i.flip)?void 0:r.overflows)||[];if(u&&I.push(E[v]),d){const e=function(e,t,n){void 0===n&&(n=!1);const r=ui(e),s=mi(e),i=hi(s);let o="x"===s?r===(n?"end":"start")?"right":"left":"start"===r?"bottom":"top";return t.reference[i]>t.floating[i]&&(o=_i(o)),[o,_i(o)]}(s,o,w);I.push(E[e[0]],E[e[1]])}if(T=[...T,{placement:s,overflows:I}],!I.every(e=>e<=0)){var C,R;const e=((null==(C=i.flip)?void 0:C.index)||0)+1,t=S[e];if(t){if(!("alignment"===d&&y!==fi(t))||T.every(e=>fi(e.placement)!==y||e.overflows[0]>0))return{data:{index:e,overflows:T},reset:{placement:t}}}let n=null==(R=T.filter(e=>e.overflows[0]<=0).sort((e,t)=>e.overflows[1]-t.overflows[1])[0])?void 0:R.placement;if(!n)switch(p){case"bestFit":{var k;const e=null==(k=T.filter(e=>{if(_){const t=fi(e.placement);return t===y||"y"===t}return!0}).map(e=>[e.placement,e.overflows.filter(e=>e>0).reduce((e,t)=>e+t,0)]).sort((e,t)=>e[1]-t[1])[0])?void 0:k[0];e&&(n=e);break}case"initialPlacement":n=a}if(s!==n)return{reset:{placement:n}}}return{}}}},Io=function(e){return void 0===e&&(e={}),{name:"size",options:e,async fn(t){var n,r;const{placement:s,rects:i,platform:o,elements:a}=t,{apply:c=()=>{},...l}=ci(e,t),u=await Ti(t,l),d=li(s),h=ui(s),p="y"===fi(s),{width:f,height:m}=i.floating;let g,v;"top"===d||"bottom"===d?(g=d,v=h===(await(null==o.isRTL?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(v=d,g="end"===h?"top":"bottom");const y=m-u.top-u.bottom,b=f-u.left-u.right,w=ei(m-u[g],y),x=ei(f-u[v],b),_=!t.middlewareData.shift;let S=w,E=x;if(null!=(n=t.middlewareData.shift)&&n.enabled.x&&(E=b),null!=(r=t.middlewareData.shift)&&r.enabled.y&&(S=y),_&&!h){const e=ti(u.left,0),t=ti(u.right,0),n=ti(u.top,0),r=ti(u.bottom,0);p?E=f-2*(0!==e||0!==t?e+t:ti(u.left,u.right)):S=m-2*(0!==n||0!==r?n+r:ti(u.top,u.bottom))}await c({...t,availableWidth:E,availableHeight:S});const I=await o.getDimensions(a.floating);return f!==I.width||m!==I.height?{reset:{rects:!0}}:{}}}},To=function(e){return void 0===e&&(e={}),{name:"hide",options:e,async fn(t){const{rects:n}=t,{strategy:r="referenceHidden",...s}=ci(e,t);switch(r){case"referenceHidden":{const e=Ci(await Ti(t,{...s,elementContext:"reference"}),n.reference);return{data:{referenceHiddenOffsets:e,referenceHidden:Ri(e)}}}case"escaped":{const e=Ci(await Ti(t,{...s,altBoundary:!0}),n.floating);return{data:{escapedOffsets:e,escaped:Ri(e)}}}default:return{}}}}},Co=e=>({name:"arrow",options:e,async fn(t){const{x:n,y:r,placement:s,rects:i,platform:o,elements:a,middlewareData:c}=t,{element:l,padding:u=0}=ci(e,t)||{};if(null==l)return{};const d=Si(u),h={x:n,y:r},p=mi(s),f=hi(p),m=await o.getDimensions(l),g="y"===p,v=g?"top":"left",y=g?"bottom":"right",b=g?"clientHeight":"clientWidth",w=i.reference[f]+i.reference[p]-h[p]-i.floating[f],x=h[p]-i.reference[p],_=await(null==o.getOffsetParent?void 0:o.getOffsetParent(l));let S=_?_[b]:0;S&&await(null==o.isElement?void 0:o.isElement(_))||(S=a.floating[b]||i.floating[f]);const E=w/2-x/2,I=S/2-m[f]/2-1,T=ei(d[v],I),C=ei(d[y],I),R=T,k=S-m[f]-C,A=S/2-m[f]/2+E,j=ai(R,A,k),M=!c.arrow&&null!=ui(s)&&A!==j&&i.reference[f]/2-(A<R?T:C)-m[f]/2<0,N=M?A<R?A-R:A-k:0;return{[p]:h[p]+N,data:{[p]:j,centerOffset:A-j-N,...M&&{alignmentOffset:N}},reset:M}}}),Ro=function(e){return void 0===e&&(e={}),{options:e,fn(t){const{x:n,y:r,placement:s,rects:i,middlewareData:o}=t,{offset:a=0,mainAxis:c=!0,crossAxis:l=!0}=ci(e,t),u={x:n,y:r},d=fi(s),h=di(d);let p=u[h],f=u[d];const m=ci(a,t),g="number"==typeof m?{mainAxis:m,crossAxis:0}:{mainAxis:0,crossAxis:0,...m};if(c){const e="y"===h?"height":"width",t=i.reference[h]-i.floating[e]+g.mainAxis,n=i.reference[h]+i.reference[e]-g.mainAxis;p<t?p=t:p>n&&(p=n)}if(l){var v,y;const e="y"===h?"width":"height",t=ki.has(li(s)),n=i.reference[d]-i.floating[e]+(t&&(null==(v=o.offset)?void 0:v[d])||0)+(t?0:g.crossAxis),r=i.reference[d]+i.reference[e]+(t?0:(null==(y=o.offset)?void 0:y[d])||0)-(t?g.crossAxis:0);f<n?f=n:f>r&&(f=r)}return{[h]:p,[d]:f}}}},ko=(e,t,n)=>{const r=new Map,s={platform:bo,...n},i={...s.platform,_c:r};return(async(e,t,n)=>{const{placement:r="bottom",strategy:s="absolute",middleware:i=[],platform:o}=n,a=i.filter(Boolean),c=await(null==o.isRTL?void 0:o.isRTL(t));let l=await o.getElementRects({reference:e,floating:t,strategy:s}),{x:u,y:d}=Ii(l,r,c),h=r,p={},f=0;for(let m=0;m<a.length;m++){const{name:n,fn:i}=a[m],{x:g,y:v,data:y,reset:b}=await i({x:u,y:d,initialPlacement:r,placement:h,strategy:s,middlewareData:p,rects:l,platform:o,elements:{reference:e,floating:t}});u=null!=g?g:u,d=null!=v?v:d,p={...p,[n]:{...p[n],...y}},b&&f<=50&&(f++,"object"==typeof b&&(b.placement&&(h=b.placement),b.rects&&(l=!0===b.rects?await o.getElementRects({reference:e,floating:t,strategy:s}):b.rects),({x:u,y:d}=Ii(l,h,c))),m=-1)}return{x:u,y:d,placement:h,strategy:s,middlewareData:p}})(e,t,{...s,platform:i})};var Ao="undefined"!=typeof document?t.useLayoutEffect:function(){};function jo(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if("function"==typeof e&&e.toString()===t.toString())return!0;let n,r,s;if(e&&t&&"object"==typeof e){if(Array.isArray(e)){if(n=e.length,n!==t.length)return!1;for(r=n;0!==r--;)if(!jo(e[r],t[r]))return!1;return!0}if(s=Object.keys(e),n=s.length,n!==Object.keys(t).length)return!1;for(r=n;0!==r--;)if(!{}.hasOwnProperty.call(t,s[r]))return!1;for(r=n;0!==r--;){const n=s[r];if(("_owner"!==n||!e.$$typeof)&&!jo(e[n],t[n]))return!1}return!0}return e!=e&&t!=t}function Mo(e){if("undefined"==typeof window)return 1;return(e.ownerDocument.defaultView||window).devicePixelRatio||1}function No(e,t){const n=Mo(e);return Math.round(t*n)/n}function Po(e){const t=v.useRef(e);return Ao(()=>{t.current=e}),t}const Oo=e=>({name:"arrow",options:e,fn(t){const{element:n,padding:r}="function"==typeof e?e(t):e;return n&&(s=n,{}.hasOwnProperty.call(s,"current"))?null!=n.current?Co({element:n.current,padding:r}).fn(t):{}:n?Co({element:n,padding:r}).fn(t):{};var s}}),Lo=(e,t)=>({...So(e),options:[e,t]}),Bo=(e,t)=>({...Ro(e),options:[e,t]}),Do=(e,t)=>({...Eo(e),options:[e,t]}),Fo=(e,t)=>({...Io(e),options:[e,t]}),$o=(e,t)=>({...To(e),options:[e,t]}),Uo=(e,t)=>({...Oo(e),options:[e,t]});function zo(e){const t=Wo(e),n=v.forwardRef((e,n)=>{const{children:r,...s}=e,i=v.Children.toArray(r),o=i.find(Vo);if(o){const e=o.props.children,r=i.map(t=>t===o?v.Children.count(e)>1?v.Children.only(null):v.isValidElement(e)?e.props.children:null:t);return A.jsx(t,{...s,ref:n,children:v.isValidElement(e)?v.cloneElement(e,void 0,r):null})}return A.jsx(t,{...s,ref:n,children:r})});return n.displayName=`${e}.Slot`,n}function Wo(e){const t=v.forwardRef((e,t)=>{const{children:n,...r}=e;if(v.isValidElement(n)){const e=function(e){var t,n;let r=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,s=r&&"isReactWarning"in r&&r.isReactWarning;if(s)return e.ref;if(r=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,s=r&&"isReactWarning"in r&&r.isReactWarning,s)return e.props.ref;return e.props.ref||e.ref}(n),s=function(e,t){const n={...t};for(const r in t){const s=e[r],i=t[r];/^on[A-Z]/.test(r)?s&&i?n[r]=(...e)=>{const t=i(...e);return s(...e),t}:s&&(n[r]=s):"style"===r?n[r]={...s,...i}:"className"===r&&(n[r]=[s,i].filter(Boolean).join(" "))}return{...e,...n}}(r,n.props);return n.type!==v.Fragment&&(s.ref=t?Xt(t,e):e),v.cloneElement(n,s)}return v.Children.count(n)>1?v.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var Ho=Symbol("radix.slottable");function Vo(e){return v.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===Ho}var qo=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{const n=zo(`Primitive.${t}`),r=v.forwardRef((e,r)=>{const{asChild:s,...i}=e,o=s?n:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),A.jsx(o,{...i,ref:r})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{}),Jo=v.forwardRef((e,t)=>{const{children:n,width:r=10,height:s=5,...i}=e;return A.jsx(qo.svg,{...i,ref:t,width:r,height:s,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?n:A.jsx("polygon",{points:"0,0 30,0 15,10"})})});Jo.displayName="Arrow";var Yo=Jo;function Ko(...e){const t=e[0];if(1===e.length)return t;const n=()=>{const n=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){const r=n.reduce((t,{useScope:n,scopeName:r})=>({...t,...n(e)[`__scope${r}`]}),{});return v.useMemo(()=>({[`__scope${t.scopeName}`]:r}),[r])}};return n.scopeName=t.scopeName,n}function Go(e){const t=Xo(e),n=v.forwardRef((e,n)=>{const{children:r,...s}=e,i=v.Children.toArray(r),o=i.find(Qo);if(o){const e=o.props.children,r=i.map(t=>t===o?v.Children.count(e)>1?v.Children.only(null):v.isValidElement(e)?e.props.children:null:t);return A.jsx(t,{...s,ref:n,children:v.isValidElement(e)?v.cloneElement(e,void 0,r):null})}return A.jsx(t,{...s,ref:n,children:r})});return n.displayName=`${e}.Slot`,n}function Xo(e){const t=v.forwardRef((e,t)=>{const{children:n,...r}=e;if(v.isValidElement(n)){const e=function(e){var t,n;let r=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,s=r&&"isReactWarning"in r&&r.isReactWarning;if(s)return e.ref;if(r=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,s=r&&"isReactWarning"in r&&r.isReactWarning,s)return e.props.ref;return e.props.ref||e.ref}(n),s=function(e,t){const n={...t};for(const r in t){const s=e[r],i=t[r];/^on[A-Z]/.test(r)?s&&i?n[r]=(...e)=>{const t=i(...e);return s(...e),t}:s&&(n[r]=s):"style"===r?n[r]={...s,...i}:"className"===r&&(n[r]=[s,i].filter(Boolean).join(" "))}return{...e,...n}}(r,n.props);return n.type!==v.Fragment&&(s.ref=t?Xt(t,e):e),v.cloneElement(n,s)}return v.Children.count(n)>1?v.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var Zo=Symbol("radix.slottable");function Qo(e){return v.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===Zo}var ea=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{const n=Go(`Primitive.${t}`),r=v.forwardRef((e,r)=>{const{asChild:s,...i}=e,o=s?n:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),A.jsx(o,{...i,ref:r})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{});var ta="Popper",[na,ra]=function(e,t=[]){let n=[];const r=()=>{const t=n.map(e=>v.createContext(e));return function(n){const r=(null==n?void 0:n[e])||t;return v.useMemo(()=>({[`__scope${e}`]:{...n,[e]:r}}),[n,r])}};return r.scopeName=e,[function(t,r){const s=v.createContext(r),i=n.length;n=[...n,r];const o=t=>{var n;const{scope:r,children:o,...a}=t,c=(null==(n=null==r?void 0:r[e])?void 0:n[i])||s,l=v.useMemo(()=>a,Object.values(a));return A.jsx(c.Provider,{value:l,children:o})};return o.displayName=t+"Provider",[o,function(n,o){var a;const c=(null==(a=null==o?void 0:o[e])?void 0:a[i])||s,l=v.useContext(c);if(l)return l;if(void 0!==r)return r;throw new Error(`\`${n}\` must be used within \`${t}\``)}]},Ko(r,...t)]}(ta),[sa,ia]=na(ta),oa=e=>{const{__scopePopper:t,children:n}=e,[r,s]=v.useState(null);return A.jsx(sa,{scope:t,anchor:r,onAnchorChange:s,children:n})};oa.displayName=ta;var aa="PopperAnchor",ca=v.forwardRef((e,t)=>{const{__scopePopper:n,virtualRef:r,...s}=e,i=ia(aa,n),o=v.useRef(null),a=Zt(t,o),c=v.useRef(null);return v.useEffect(()=>{const e=c.current;c.current=(null==r?void 0:r.current)||o.current,e!==c.current&&i.onAnchorChange(c.current)}),r?null:A.jsx(ea.div,{...s,ref:a})});ca.displayName=aa;var la="PopperContent",[ua,da]=na(la),ha=v.forwardRef((e,t)=>{var n,r,s,i,o,a;const{__scopePopper:c,side:l="bottom",sideOffset:u=0,align:d="center",alignOffset:h=0,arrowPadding:p=0,avoidCollisions:f=!0,collisionBoundary:m=[],collisionPadding:g=0,sticky:b="partial",hideWhenDetached:w=!1,updatePositionStrategy:x="optimized",onPlaced:_,...S}=e,E=ia(la,c),[I,T]=v.useState(null),C=Zt(t,e=>T(e)),[R,k]=v.useState(null),j=function(e){const[t,n]=v.useState(void 0);return Ks(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});const t=new ResizeObserver(t=>{if(!Array.isArray(t))return;if(!t.length)return;const r=t[0];let s,i;if("borderBoxSize"in r){const e=r.borderBoxSize,t=Array.isArray(e)?e[0]:e;s=t.inlineSize,i=t.blockSize}else s=e.offsetWidth,i=e.offsetHeight;n({width:s,height:i})});return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}n(void 0)},[e]),t}(R),M=(null==j?void 0:j.width)??0,N=(null==j?void 0:j.height)??0,P=l+("center"!==d?"-"+d:""),O="number"==typeof g?g:{top:0,right:0,bottom:0,left:0,...g},L=Array.isArray(m)?m:[m],B=L.length>0,D={padding:O,boundary:L.filter(ga),altBoundary:B},{refs:F,floatingStyles:$,placement:U,isPositioned:z,middlewareData:W}=function(e){void 0===e&&(e={});const{placement:t="bottom",strategy:n="absolute",middleware:r=[],platform:s,elements:{reference:i,floating:o}={},transform:a=!0,whileElementsMounted:c,open:l}=e,[u,d]=v.useState({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[h,p]=v.useState(r);jo(h,r)||p(r);const[f,m]=v.useState(null),[g,b]=v.useState(null),w=v.useCallback(e=>{e!==E.current&&(E.current=e,m(e))},[]),x=v.useCallback(e=>{e!==I.current&&(I.current=e,b(e))},[]),_=i||f,S=o||g,E=v.useRef(null),I=v.useRef(null),T=v.useRef(u),C=null!=c,R=Po(c),k=Po(s),A=Po(l),j=v.useCallback(()=>{if(!E.current||!I.current)return;const e={placement:t,strategy:n,middleware:h};k.current&&(e.platform=k.current),ko(E.current,I.current,e).then(e=>{const t={...e,isPositioned:!1!==A.current};M.current&&!jo(T.current,t)&&(T.current=t,y.flushSync(()=>{d(t)}))})},[h,t,n,k,A]);Ao(()=>{!1===l&&T.current.isPositioned&&(T.current.isPositioned=!1,d(e=>({...e,isPositioned:!1})))},[l]);const M=v.useRef(!1);Ao(()=>(M.current=!0,()=>{M.current=!1}),[]),Ao(()=>{if(_&&(E.current=_),S&&(I.current=S),_&&S){if(R.current)return R.current(_,S,j);j()}},[_,S,j,R,C]);const N=v.useMemo(()=>({reference:E,floating:I,setReference:w,setFloating:x}),[w,x]),P=v.useMemo(()=>({reference:_,floating:S}),[_,S]),O=v.useMemo(()=>{const e={position:n,left:0,top:0};if(!P.floating)return e;const t=No(P.floating,u.x),r=No(P.floating,u.y);return a?{...e,transform:"translate("+t+"px, "+r+"px)",...Mo(P.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:t,top:r}},[n,a,P.floating,u.x,u.y]);return v.useMemo(()=>({...u,update:j,refs:N,elements:P,floatingStyles:O}),[u,j,N,P,O])}({strategy:"fixed",placement:P,whileElementsMounted:(...e)=>xo(...e,{animationFrame:"always"===x}),elements:{reference:E.anchor},middleware:[(H={mainAxis:u+N,alignmentAxis:h},{..._o(H),options:[H,V]}),f&&Lo({mainAxis:!0,crossAxis:!1,limiter:"partial"===b?Bo():void 0,...D}),f&&Do({...D}),Fo({...D,apply:({elements:e,rects:t,availableWidth:n,availableHeight:r})=>{const{width:s,height:i}=t.reference,o=e.floating.style;o.setProperty("--radix-popper-available-width",`${n}px`),o.setProperty("--radix-popper-available-height",`${r}px`),o.setProperty("--radix-popper-anchor-width",`${s}px`),o.setProperty("--radix-popper-anchor-height",`${i}px`)}}),R&&Uo({element:R,padding:p}),va({arrowWidth:M,arrowHeight:N}),w&&$o({strategy:"referenceHidden",...D})]});var H,V;const[q,J]=ya(U),Y=Dr(_);Ks(()=>{z&&(null==Y||Y())},[z,Y]);const K=null==(n=W.arrow)?void 0:n.x,G=null==(r=W.arrow)?void 0:r.y,X=0!==(null==(s=W.arrow)?void 0:s.centerOffset),[Z,Q]=v.useState();return Ks(()=>{I&&Q(window.getComputedStyle(I).zIndex)},[I]),A.jsx("div",{ref:F.setFloating,"data-radix-popper-content-wrapper":"",style:{...$,transform:z?$.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Z,"--radix-popper-transform-origin":[null==(i=W.transformOrigin)?void 0:i.x,null==(o=W.transformOrigin)?void 0:o.y].join(" "),...(null==(a=W.hide)?void 0:a.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:A.jsx(ua,{scope:c,placedSide:q,onArrowChange:k,arrowX:K,arrowY:G,shouldHideArrow:X,children:A.jsx(ea.div,{"data-side":q,"data-align":J,...S,ref:C,style:{...S.style,animation:z?void 0:"none"}})})})});ha.displayName=la;var pa="PopperArrow",fa={top:"bottom",right:"left",bottom:"top",left:"right"},ma=v.forwardRef(function(e,t){const{__scopePopper:n,...r}=e,s=da(pa,n),i=fa[s.placedSide];return A.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:A.jsx(Yo,{...r,ref:t,style:{...r.style,display:"block"}})})});function ga(e){return null!==e}ma.displayName=pa;var va=e=>({name:"transformOrigin",options:e,fn(t){var n,r,s;const{placement:i,rects:o,middlewareData:a}=t,c=0!==(null==(n=a.arrow)?void 0:n.centerOffset),l=c?0:e.arrowWidth,u=c?0:e.arrowHeight,[d,h]=ya(i),p={start:"0%",center:"50%",end:"100%"}[h],f=((null==(r=a.arrow)?void 0:r.x)??0)+l/2,m=((null==(s=a.arrow)?void 0:s.y)??0)+u/2;let g="",v="";return"bottom"===d?(g=c?p:`${f}px`,v=-u+"px"):"top"===d?(g=c?p:`${f}px`,v=`${o.floating.height+u}px`):"right"===d?(g=-u+"px",v=c?p:`${m}px`):"left"===d&&(g=`${o.floating.width+u}px`,v=c?p:`${m}px`),{data:{x:g,y:v}}}});function ya(e){const[t,n="center"]=e.split("-");return[t,n]}var ba=oa,wa=ca,xa=ha,_a=ma;function Sa(e){const t=Ea(e),n=v.forwardRef((e,n)=>{const{children:r,...s}=e,i=v.Children.toArray(r),o=i.find(Ta);if(o){const e=o.props.children,r=i.map(t=>t===o?v.Children.count(e)>1?v.Children.only(null):v.isValidElement(e)?e.props.children:null:t);return A.jsx(t,{...s,ref:n,children:v.isValidElement(e)?v.cloneElement(e,void 0,r):null})}return A.jsx(t,{...s,ref:n,children:r})});return n.displayName=`${e}.Slot`,n}function Ea(e){const t=v.forwardRef((e,t)=>{const{children:n,...r}=e;if(v.isValidElement(n)){const e=function(e){var t,n;let r=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,s=r&&"isReactWarning"in r&&r.isReactWarning;if(s)return e.ref;if(r=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,s=r&&"isReactWarning"in r&&r.isReactWarning,s)return e.props.ref;return e.props.ref||e.ref}(n),s=function(e,t){const n={...t};for(const r in t){const s=e[r],i=t[r];/^on[A-Z]/.test(r)?s&&i?n[r]=(...e)=>{const t=i(...e);return s(...e),t}:s&&(n[r]=s):"style"===r?n[r]={...s,...i}:"className"===r&&(n[r]=[s,i].filter(Boolean).join(" "))}return{...e,...n}}(r,n.props);return n.type!==v.Fragment&&(s.ref=t?Xt(t,e):e),v.cloneElement(n,s)}return v.Children.count(n)>1?v.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var Ia=Symbol("radix.slottable");function Ta(e){return v.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===Ia}var Ca=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{const n=Sa(`Primitive.${t}`),r=v.forwardRef((e,r)=>{const{asChild:s,...i}=e,o=s?n:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),A.jsx(o,{...i,ref:r})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{}),Ra=v.forwardRef((e,t)=>{var r;const{container:s,...i}=e,[o,a]=v.useState(!1);Ks(()=>a(!0),[]);const c=s||o&&(null==(r=null==globalThis?void 0:globalThis.document)?void 0:r.body);return c?n.createPortal(A.jsx(Ca.div,{...i,ref:t}),c):null});Ra.displayName="Portal";var ka=e=>{const{present:t,children:n}=e,r=function(e){const[t,n]=v.useState(),r=v.useRef(null),s=v.useRef(e),i=v.useRef("none"),o=e?"mounted":"unmounted",[a,c]=function(e,t){return v.useReducer((e,n)=>t[e][n]??e,e)}(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return v.useEffect(()=>{const e=Aa(r.current);i.current="mounted"===a?e:"none"},[a]),Ks(()=>{const t=r.current,n=s.current;if(n!==e){const r=i.current,o=Aa(t);if(e)c("MOUNT");else if("none"===o||"none"===(null==t?void 0:t.display))c("UNMOUNT");else{c(n&&r!==o?"ANIMATION_OUT":"UNMOUNT")}s.current=e}},[e,c]),Ks(()=>{if(t){let e;const n=t.ownerDocument.defaultView??window,o=i=>{const o=Aa(r.current).includes(CSS.escape(i.animationName));if(i.target===t&&o&&(c("ANIMATION_END"),!s.current)){const r=t.style.animationFillMode;t.style.animationFillMode="forwards",e=n.setTimeout(()=>{"forwards"===t.style.animationFillMode&&(t.style.animationFillMode=r)})}},a=e=>{e.target===t&&(i.current=Aa(r.current))};return t.addEventListener("animationstart",a),t.addEventListener("animationcancel",o),t.addEventListener("animationend",o),()=>{n.clearTimeout(e),t.removeEventListener("animationstart",a),t.removeEventListener("animationcancel",o),t.removeEventListener("animationend",o)}}c("ANIMATION_END")},[t,c]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:v.useCallback(e=>{r.current=e?getComputedStyle(e):null,n(e)},[])}}(t),s="function"==typeof n?n({present:r.isPresent}):v.Children.only(n),i=Zt(r.ref,function(e){var t,n;let r=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,s=r&&"isReactWarning"in r&&r.isReactWarning;if(s)return e.ref;if(r=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,s=r&&"isReactWarning"in r&&r.isReactWarning,s)return e.props.ref;return e.props.ref||e.ref}(s));return"function"==typeof n||r.isPresent?v.cloneElement(s,{ref:i}):null};function Aa(e){return(null==e?void 0:e.animationName)||"none"}function ja(e){const t=Ma(e),n=v.forwardRef((e,n)=>{const{children:r,...s}=e,i=v.Children.toArray(r),o=i.find(Pa);if(o){const e=o.props.children,r=i.map(t=>t===o?v.Children.count(e)>1?v.Children.only(null):v.isValidElement(e)?e.props.children:null:t);return A.jsx(t,{...s,ref:n,children:v.isValidElement(e)?v.cloneElement(e,void 0,r):null})}return A.jsx(t,{...s,ref:n,children:r})});return n.displayName=`${e}.Slot`,n}function Ma(e){const t=v.forwardRef((e,t)=>{const{children:n,...r}=e;if(v.isValidElement(n)){const e=function(e){var t,n;let r=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,s=r&&"isReactWarning"in r&&r.isReactWarning;if(s)return e.ref;if(r=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,s=r&&"isReactWarning"in r&&r.isReactWarning,s)return e.props.ref;return e.props.ref||e.ref}(n),s=function(e,t){const n={...t};for(const r in t){const s=e[r],i=t[r];/^on[A-Z]/.test(r)?s&&i?n[r]=(...e)=>{const t=i(...e);return s(...e),t}:s&&(n[r]=s):"style"===r?n[r]={...s,...i}:"className"===r&&(n[r]=[s,i].filter(Boolean).join(" "))}return{...e,...n}}(r,n.props);return n.type!==v.Fragment&&(s.ref=t?Xt(t,e):e),v.cloneElement(n,s)}return v.Children.count(n)>1?v.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}ka.displayName="Presence";var Na=Symbol("radix.slottable");function Pa(e){return v.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===Na}var Oa=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{const n=ja(`Primitive.${t}`),r=v.forwardRef((e,r)=>{const{asChild:s,...i}=e,o=s?n:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),A.jsx(o,{...i,ref:r})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{}),La=v[" useInsertionEffect ".trim().toString()]||Ks;function Ba({prop:e,defaultProp:t,onChange:n=()=>{},caller:r}){const[s,i,o]=function({defaultProp:e,onChange:t}){const[n,r]=v.useState(e),s=v.useRef(n),i=v.useRef(t);return La(()=>{i.current=t},[t]),v.useEffect(()=>{var e;s.current!==n&&(null==(e=i.current)||e.call(i,n),s.current=n)},[n,s]),[n,r,i]}({defaultProp:t,onChange:n}),a=void 0!==e,c=a?e:s;{const t=v.useRef(void 0!==e);v.useEffect(()=>{const e=t.current;if(e!==a){}t.current=a},[a,r])}const l=v.useCallback(t=>{var n;if(a){const r=function(e){return"function"==typeof e}(t)?t(e):t;r!==e&&(null==(n=o.current)||n.call(o,r))}else i(t)},[a,e,i,o]);return[c,l]}var Da=new WeakMap,Fa=new WeakMap,$a={},Ua=0,za=function(e){return e&&(e.host||za(e.parentNode))},Wa=function(e,t,n,r){var s=function(e,t){return t.map(function(t){if(e.contains(t))return t;var n=za(t);return n&&e.contains(n)?n:null}).filter(function(e){return Boolean(e)})}(t,Array.isArray(e)?e:[e]);$a[n]||($a[n]=new WeakMap);var i=$a[n],o=[],a=new Set,c=new Set(s),l=function(e){e&&!a.has(e)&&(a.add(e),l(e.parentNode))};s.forEach(l);var u=function(e){e&&!c.has(e)&&Array.prototype.forEach.call(e.children,function(e){if(a.has(e))u(e);else try{var t=e.getAttribute(r),s=null!==t&&"false"!==t,c=(Da.get(e)||0)+1,l=(i.get(e)||0)+1;Da.set(e,c),i.set(e,l),o.push(e),1===c&&s&&Fa.set(e,!0),1===l&&e.setAttribute(n,"true"),s||e.setAttribute(r,"true")}catch(d){}})};return u(t),a.clear(),Ua++,function(){o.forEach(function(e){var t=Da.get(e)-1,s=i.get(e)-1;Da.set(e,t),i.set(e,s),t||(Fa.has(e)||e.removeAttribute(r),Fa.delete(e)),s||e.removeAttribute(n)}),--Ua||(Da=new WeakMap,Da=new WeakMap,Fa=new WeakMap,$a={})}},Ha=function(e,t,n){void 0===n&&(n="data-aria-hidden");var r=Array.from(Array.isArray(e)?e:[e]),s=function(e){return"undefined"==typeof document?null:(Array.isArray(e)?e[0]:e).ownerDocument.body}(e);return s?(r.push.apply(r,Array.from(s.querySelectorAll("[aria-live], script"))),Wa(r,s,n,"aria-hidden")):function(){return null}},Va=function(){return Va=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},Va.apply(this,arguments)};function qa(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(n[r[s]]=e[r[s]])}return n}"function"==typeof SuppressedError&&SuppressedError;var Ja="right-scroll-bar-position",Ya="width-before-scroll-bar";function Ka(e,t){return"function"==typeof e?e(t):e&&(e.current=t),e}var Ga="undefined"!=typeof window?v.useLayoutEffect:v.useEffect,Xa=new WeakMap;function Za(e,n){var r,s,i,o=(r=null,s=function(t){return e.forEach(function(e){return Ka(e,t)})},(i=t.useState(function(){return{value:r,callback:s,facade:{get current(){return i.value},set current(e){var t=i.value;t!==e&&(i.value=e,i.callback(e,t))}}}})[0]).callback=s,i.facade);return Ga(function(){var t=Xa.get(o);if(t){var n=new Set(t),r=new Set(e),s=o.current;n.forEach(function(e){r.has(e)||Ka(e,null)}),r.forEach(function(e){n.has(e)||Ka(e,s)})}Xa.set(o,e)},[e]),o}function Qa(e){return e}var ec=function(e){var t=e.sideCar,n=qa(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=t.read();if(!r)throw new Error("Sidecar medium not found");return v.createElement(r,Va({},n))};ec.isSideCarExport=!0;var tc=function(e){void 0===e&&(e={});var t=function(e,t){void 0===t&&(t=Qa);var n=[],r=!1;return{read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(e){var s=t(e,r);return n.push(s),function(){n=n.filter(function(e){return e!==s})}},assignSyncMedium:function(e){for(r=!0;n.length;){var t=n;n=[],t.forEach(e)}n={push:function(t){return e(t)},filter:function(){return n}}},assignMedium:function(e){r=!0;var t=[];if(n.length){var s=n;n=[],s.forEach(e),t=n}var i=function(){var n=t;t=[],n.forEach(e)},o=function(){return Promise.resolve().then(i)};o(),n={push:function(e){t.push(e),o()},filter:function(e){return t=t.filter(e),n}}}}}(null);return t.options=Va({async:!0,ssr:!1},e),t}(),nc=function(){},rc=v.forwardRef(function(e,t){var n=v.useRef(null),r=v.useState({onScrollCapture:nc,onWheelCapture:nc,onTouchMoveCapture:nc}),s=r[0],i=r[1],o=e.forwardProps,a=e.children,c=e.className,l=e.removeScrollBar,u=e.enabled,d=e.shards,h=e.sideCar,p=e.noRelative,f=e.noIsolation,m=e.inert,g=e.allowPinchZoom,y=e.as,b=void 0===y?"div":y,w=e.gapMode,x=qa(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),_=h,S=Za([n,t]),E=Va(Va({},x),s);return v.createElement(v.Fragment,null,u&&v.createElement(_,{sideCar:tc,removeScrollBar:l,shards:d,noRelative:p,noIsolation:f,inert:m,setCallbacks:i,allowPinchZoom:!!g,lockRef:n,gapMode:w}),o?v.cloneElement(v.Children.only(a),Va(Va({},E),{ref:S})):v.createElement(b,Va({},E,{className:c,ref:S}),a))});rc.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},rc.classNames={fullWidth:Ya,zeroRight:Ja};function sc(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=function(){if("undefined"!=typeof __webpack_nonce__)return __webpack_nonce__}();return t&&e.setAttribute("nonce",t),e}var ic=function(){var e=0,t=null;return{add:function(n){var r,s;0==e&&(t=sc())&&(s=n,(r=t).styleSheet?r.styleSheet.cssText=s:r.appendChild(document.createTextNode(s)),function(e){(document.head||document.getElementsByTagName("head")[0]).appendChild(e)}(t)),e++},remove:function(){! --e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},oc=function(){var e,t=(e=ic(),function(t,n){v.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])});return function(e){var n=e.styles,r=e.dynamic;return t(n,r),null}},ac={left:0,top:0,right:0,gap:0},cc=function(e){return parseInt(e||"",10)||0},lc=function(e){if(void 0===e&&(e="margin"),"undefined"==typeof window)return ac;var t=function(e){var t=window.getComputedStyle(document.body),n=t["padding"===e?"paddingLeft":"marginLeft"],r=t["padding"===e?"paddingTop":"marginTop"],s=t["padding"===e?"paddingRight":"marginRight"];return[cc(n),cc(r),cc(s)]}(e),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,r-n+t[2]-t[0])}},uc=oc(),dc="data-scroll-locked",hc=function(e,t,n,r){var s=e.left,i=e.top,o=e.right,a=e.gap;return void 0===n&&(n="margin"),"\n  .".concat("with-scroll-bars-hidden"," {\n   overflow: hidden ").concat(r,";\n   padding-right: ").concat(a,"px ").concat(r,";\n  }\n  body[").concat(dc,"] {\n    overflow: hidden ").concat(r,";\n    overscroll-behavior: contain;\n    ").concat([t&&"position: relative ".concat(r,";"),"margin"===n&&"\n    padding-left: ".concat(s,"px;\n    padding-top: ").concat(i,"px;\n    padding-right: ").concat(o,"px;\n    margin-left:0;\n    margin-top:0;\n    margin-right: ").concat(a,"px ").concat(r,";\n    "),"padding"===n&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),"\n  }\n  \n  .").concat(Ja," {\n    right: ").concat(a,"px ").concat(r,";\n  }\n  \n  .").concat(Ya," {\n    margin-right: ").concat(a,"px ").concat(r,";\n  }\n  \n  .").concat(Ja," .").concat(Ja," {\n    right: 0 ").concat(r,";\n  }\n  \n  .").concat(Ya," .").concat(Ya," {\n    margin-right: 0 ").concat(r,";\n  }\n  \n  body[").concat(dc,"] {\n    ").concat("--removed-body-scroll-bar-size",": ").concat(a,"px;\n  }\n")},pc=function(){var e=parseInt(document.body.getAttribute(dc)||"0",10);return isFinite(e)?e:0},fc=function(e){var t=e.noRelative,n=e.noImportant,r=e.gapMode,s=void 0===r?"margin":r;v.useEffect(function(){return document.body.setAttribute(dc,(pc()+1).toString()),function(){var e=pc()-1;e<=0?document.body.removeAttribute(dc):document.body.setAttribute(dc,e.toString())}},[]);var i=v.useMemo(function(){return lc(s)},[s]);return v.createElement(uc,{styles:hc(i,!t,s,n?"":"!important")})},mc=!1;if("undefined"!=typeof window)try{var gc=Object.defineProperty({},"passive",{get:function(){return mc=!0,!0}});window.addEventListener("test",gc,gc),window.removeEventListener("test",gc,gc)}catch(td){mc=!1}var vc=!!mc&&{passive:!1},yc=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return"hidden"!==n[t]&&!(n.overflowY===n.overflowX&&!function(e){return"TEXTAREA"===e.tagName}(e)&&"visible"===n[t])},bc=function(e,t){var n=t.ownerDocument,r=t;do{if("undefined"!=typeof ShadowRoot&&r instanceof ShadowRoot&&(r=r.host),wc(e,r)){var s=xc(e,r);if(s[1]>s[2])return!0}r=r.parentNode}while(r&&r!==n.body);return!1},wc=function(e,t){return"v"===e?function(e){return yc(e,"overflowY")}(t):function(e){return yc(e,"overflowX")}(t)},xc=function(e,t){return"v"===e?[(n=t).scrollTop,n.scrollHeight,n.clientHeight]:function(e){return[e.scrollLeft,e.scrollWidth,e.clientWidth]}(t);var n},_c=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},Sc=function(e){return[e.deltaX,e.deltaY]},Ec=function(e){return e&&"current"in e?e.current:e},Ic=function(e){return"\n  .block-interactivity-".concat(e," {pointer-events: none;}\n  .allow-interactivity-").concat(e," {pointer-events: all;}\n")},Tc=0,Cc=[];function Rc(e){for(var t=null;null!==e;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const kc=(Ac=function(e){var t=v.useRef([]),n=v.useRef([0,0]),r=v.useRef(),s=v.useState(Tc++)[0],i=v.useState(oc)[0],o=v.useRef(e);v.useEffect(function(){o.current=e},[e]),v.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(s));var t=function(e,t,n){if(n||2===arguments.length)for(var r,s=0,i=t.length;s<i;s++)!r&&s in t||(r||(r=Array.prototype.slice.call(t,0,s)),r[s]=t[s]);return e.concat(r||Array.prototype.slice.call(t))}([e.lockRef.current],(e.shards||[]).map(Ec),!0).filter(Boolean);return t.forEach(function(e){return e.classList.add("allow-interactivity-".concat(s))}),function(){document.body.classList.remove("block-interactivity-".concat(s)),t.forEach(function(e){return e.classList.remove("allow-interactivity-".concat(s))})}}},[e.inert,e.lockRef.current,e.shards]);var a=v.useCallback(function(e,t){if("touches"in e&&2===e.touches.length||"wheel"===e.type&&e.ctrlKey)return!o.current.allowPinchZoom;var s,i=_c(e),a=n.current,c="deltaX"in e?e.deltaX:a[0]-i[0],l="deltaY"in e?e.deltaY:a[1]-i[1],u=e.target,d=Math.abs(c)>Math.abs(l)?"h":"v";if("touches"in e&&"h"===d&&"range"===u.type)return!1;var h=window.getSelection(),p=h&&h.anchorNode;if(p&&(p===u||p.contains(u)))return!1;var f=bc(d,u);if(!f)return!0;if(f?s=d:(s="v"===d?"h":"v",f=bc(d,u)),!f)return!1;if(!r.current&&"changedTouches"in e&&(c||l)&&(r.current=s),!s)return!0;var m=r.current||s;return function(e,t,n,r){var s=function(e,t){return"h"===e&&"rtl"===t?-1:1}(e,window.getComputedStyle(t).direction),i=s*r,o=n.target,a=t.contains(o),c=!1,l=i>0,u=0,d=0;do{if(!o)break;var h=xc(e,o),p=h[0],f=h[1]-h[2]-s*p;(p||f)&&wc(e,o)&&(u+=f,d+=p);var m=o.parentNode;o=m&&m.nodeType===Node.DOCUMENT_FRAGMENT_NODE?m.host:m}while(!a&&o!==document.body||a&&(t.contains(o)||t===o));return(l&&Math.abs(u)<1||!l&&Math.abs(d)<1)&&(c=!0),c}(m,t,e,"h"===m?c:l)},[]),c=v.useCallback(function(e){var n=e;if(Cc.length&&Cc[Cc.length-1]===i){var r="deltaY"in n?Sc(n):_c(n),s=t.current.filter(function(e){return e.name===n.type&&(e.target===n.target||n.target===e.shadowParent)&&(t=e.delta,s=r,t[0]===s[0]&&t[1]===s[1]);var t,s})[0];if(s&&s.should)n.cancelable&&n.preventDefault();else if(!s){var c=(o.current.shards||[]).map(Ec).filter(Boolean).filter(function(e){return e.contains(n.target)});(c.length>0?a(n,c[0]):!o.current.noIsolation)&&n.cancelable&&n.preventDefault()}}},[]),l=v.useCallback(function(e,n,r,s){var i={name:e,delta:n,target:r,should:s,shadowParent:Rc(r)};t.current.push(i),setTimeout(function(){t.current=t.current.filter(function(e){return e!==i})},1)},[]),u=v.useCallback(function(e){n.current=_c(e),r.current=void 0},[]),d=v.useCallback(function(t){l(t.type,Sc(t),t.target,a(t,e.lockRef.current))},[]),h=v.useCallback(function(t){l(t.type,_c(t),t.target,a(t,e.lockRef.current))},[]);v.useEffect(function(){return Cc.push(i),e.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:h}),document.addEventListener("wheel",c,vc),document.addEventListener("touchmove",c,vc),document.addEventListener("touchstart",u,vc),function(){Cc=Cc.filter(function(e){return e!==i}),document.removeEventListener("wheel",c,vc),document.removeEventListener("touchmove",c,vc),document.removeEventListener("touchstart",u,vc)}},[]);var p=e.removeScrollBar,f=e.inert;return v.createElement(v.Fragment,null,f?v.createElement(i,{styles:Ic(s)}):null,p?v.createElement(fc,{noRelative:e.noRelative,gapMode:e.gapMode}):null)},tc.useMedium(Ac),ec);var Ac,jc=v.forwardRef(function(e,t){return v.createElement(rc,Va({},e,{ref:t,sideCar:kc}))});jc.classNames=rc.classNames;var Mc="Popover",[Nc,Pc]=function(e,t=[]){let n=[];const r=()=>{const t=n.map(e=>v.createContext(e));return function(n){const r=(null==n?void 0:n[e])||t;return v.useMemo(()=>({[`__scope${e}`]:{...n,[e]:r}}),[n,r])}};return r.scopeName=e,[function(t,r){const s=v.createContext(r),i=n.length;n=[...n,r];const o=t=>{var n;const{scope:r,children:o,...a}=t,c=(null==(n=null==r?void 0:r[e])?void 0:n[i])||s,l=v.useMemo(()=>a,Object.values(a));return A.jsx(c.Provider,{value:l,children:o})};return o.displayName=t+"Provider",[o,function(n,o){var a;const c=(null==(a=null==o?void 0:o[e])?void 0:a[i])||s,l=v.useContext(c);if(l)return l;if(void 0!==r)return r;throw new Error(`\`${n}\` must be used within \`${t}\``)}]},vs(r,...t)]}(Mc,[ra]),Oc=ra(),[Lc,Bc]=Nc(Mc),Dc=e=>{const{__scopePopover:t,children:n,open:r,defaultOpen:s,onOpenChange:i,modal:o=!1}=e,a=Oc(t),c=v.useRef(null),[l,u]=v.useState(!1),[d,h]=Ba({prop:r,defaultProp:s??!1,onChange:i,caller:Mc});return A.jsx(ba,{...a,children:A.jsx(Lc,{scope:t,contentId:Zs(),triggerRef:c,open:d,onOpenChange:h,onOpenToggle:v.useCallback(()=>h(e=>!e),[h]),hasCustomAnchor:l,onCustomAnchorAdd:v.useCallback(()=>u(!0),[]),onCustomAnchorRemove:v.useCallback(()=>u(!1),[]),modal:o,children:n})})};Dc.displayName=Mc;var Fc="PopoverAnchor",$c=v.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,s=Bc(Fc,n),i=Oc(n),{onCustomAnchorAdd:o,onCustomAnchorRemove:a}=s;return v.useEffect(()=>(o(),()=>a()),[o,a]),A.jsx(wa,{...i,...r,ref:t})});$c.displayName=Fc;var Uc="PopoverTrigger",zc=v.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,s=Bc(Uc,n),i=Oc(n),o=Zt(t,s.triggerRef),a=A.jsx(Oa.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":tl(s.open),...r,ref:o,onClick:ps(e.onClick,s.onOpenToggle)});return s.hasCustomAnchor?a:A.jsx(wa,{asChild:!0,...i,children:a})});zc.displayName=Uc;var Wc="PopoverPortal",[Hc,Vc]=Nc(Wc,{forceMount:void 0}),qc=e=>{const{__scopePopover:t,forceMount:n,children:r,container:s}=e,i=Bc(Wc,t);return A.jsx(Hc,{scope:t,forceMount:n,children:A.jsx(ka,{present:n||i.open,children:A.jsx(Ra,{asChild:!0,container:s,children:r})})})};qc.displayName=Wc;var Jc="PopoverContent",Yc=v.forwardRef((e,t)=>{const n=Vc(Jc,e.__scopePopover),{forceMount:r=n.forceMount,...s}=e,i=Bc(Jc,e.__scopePopover);return A.jsx(ka,{present:r||i.open,children:i.modal?A.jsx(Gc,{...s,ref:t}):A.jsx(Xc,{...s,ref:t})})});Yc.displayName=Jc;var Kc=ja("PopoverContent.RemoveScroll"),Gc=v.forwardRef((e,t)=>{const n=Bc(Jc,e.__scopePopover),r=v.useRef(null),s=Zt(t,r),i=v.useRef(!1);return v.useEffect(()=>{const e=r.current;if(e)return Ha(e)},[]),A.jsx(jc,{as:Kc,allowPinchZoom:!0,children:A.jsx(Zc,{...e,ref:s,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ps(e.onCloseAutoFocus,e=>{var t;e.preventDefault(),i.current||null==(t=n.triggerRef.current)||t.focus()}),onPointerDownOutside:ps(e.onPointerDownOutside,e=>{const t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey,r=2===t.button||n;i.current=r},{checkForDefaultPrevented:!1}),onFocusOutside:ps(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1})})})}),Xc=v.forwardRef((e,t)=>{const n=Bc(Jc,e.__scopePopover),r=v.useRef(!1),s=v.useRef(!1);return A.jsx(Zc,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{var i,o;null==(i=e.onCloseAutoFocus)||i.call(e,t),t.defaultPrevented||(r.current||null==(o=n.triggerRef.current)||o.focus(),t.preventDefault()),r.current=!1,s.current=!1},onInteractOutside:t=>{var i,o;null==(i=e.onInteractOutside)||i.call(e,t),t.defaultPrevented||(r.current=!0,"pointerdown"===t.detail.originalEvent.type&&(s.current=!0));const a=t.target;(null==(o=n.triggerRef.current)?void 0:o.contains(a))&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&s.current&&t.preventDefault()}})}),Zc=v.forwardRef((e,t)=>{const{__scopePopover:n,trapFocus:r,onOpenAutoFocus:s,onCloseAutoFocus:i,disableOutsidePointerEvents:o,onEscapeKeyDown:a,onPointerDownOutside:c,onFocusOutside:l,onInteractOutside:u,...d}=e,h=Bc(Jc,n),p=Oc(n);return v.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??Ns()),document.body.insertAdjacentElement("beforeend",e[1]??Ns()),Ms++,()=>{1===Ms&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),Ms--}},[]),A.jsx(zs,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:s,onUnmountAutoFocus:i,children:A.jsx(Rs,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:u,onEscapeKeyDown:a,onPointerDownOutside:c,onFocusOutside:l,onDismiss:()=>h.onOpenChange(!1),children:A.jsx(xa,{"data-state":tl(h.open),role:"dialog",id:h.contentId,...p,...d,ref:t,style:{...d.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Qc="PopoverClose",el=v.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,s=Bc(Qc,n);return A.jsx(Oa.button,{type:"button",...r,ref:t,onClick:ps(e.onClick,()=>s.onOpenChange(!1))})});el.displayName=Qc;function tl(e){return e?"open":"closed"}v.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,s=Oc(n);return A.jsx(_a,{...s,...r,ref:t})}).displayName="PopoverArrow";var nl=Dc,rl=$c,sl=zc,il=qc,ol=Yc;const al=Pc(),cl=({__scopeAssistantModal:e,defaultOpen:n,unstable_openOnRunStart:r,open:s,onOpenChange:i,...o})=>{const a=al(e),[c,l]=(({defaultOpen:e=!1,unstable_openOnRunStart:n=!0})=>{const r=t.useState(e),[,s]=r,i=wn();return t.useEffect(()=>{if(n)return i.on("thread.run-start",()=>{s(!0)})},[n,s,i]),r})({defaultOpen:n,unstable_openOnRunStart:r});return A.jsx(nl,{...a,open:void 0===s?c:s,onOpenChange:e=>{null==i||i(e),l(e)},...o})};cl.displayName="AssistantModalPrimitive.Root";const ll=t.forwardRef(({__scopeAssistantModal:e,...t},n)=>{const r=al(e);return A.jsx(sl,{...r,...t,ref:n})});ll.displayName="AssistantModalPrimitive.Trigger";const ul=t.forwardRef(({__scopeAssistantModal:e,side:t,align:n,onInteractOutside:r,dissmissOnInteractOutside:s=!1,portalProps:i,...o},a)=>{const c=al(e);return A.jsx(il,{...c,...i,children:A.jsx(ol,{...c,...o,ref:a,side:t??"top",align:n??"end",onInteractOutside:ps(r,s?void 0:e=>e.preventDefault())})})});ul.displayName="AssistantModalPrimitive.Content";const dl=t.forwardRef(({__scopeAssistantModal:e,...t},n)=>{const r=al(e);return A.jsx(rl,{...r,...t,ref:n})});dl.displayName="AssistantModalPrimitive.Anchor";const hl=e=>{const n=t.useRef(void 0);return t.useCallback(t=>{n.current&&n.current(),t&&(n.current=e(t))},[e])},pl=(e,n)=>{const r=t.useCallback(t=>{if(!e)return;const r=e(),s=()=>{const e=n?n(t):t.offsetHeight;r.setHeight(e)},i=new ResizeObserver(s);return i.observe(t),s(),()=>{i.disconnect(),r.unregister()}},[e,n]);return hl(r)},fl=t.createContext(!1),ml=(e,t)=>{const n=e.match(/^([\d.]+)(em|px|rem)$/);if(!n)return 0;const r=parseFloat(n[1]),s=n[2];if("px"===s)return r;if("em"===s){return r*(parseFloat(getComputedStyle(t).fontSize)||16)}if("rem"===s){return r*(parseFloat(getComputedStyle(document.documentElement).fontSize)||16)}return 0},gl=({children:e,fillClampThreshold:n="10em",fillClampOffset:r="6em"})=>{const s=En(({message:e})=>e.isLast&&e.index>=2),i=Mn({optional:!0}),o=t.useContext(fl),a=t.useCallback(e=>{if(!i||o)return;const t=()=>{const t=i.getState();if("top"===t.turnAnchor&&s){const{viewport:s,inset:i,userMessage:o}=t.height,a=ml(n,e),c=ml(r,e),l=o<=a?o:c,u=Math.max(0,s-i-l);e.style.minHeight=`${u}px`,e.style.flexShrink="0",e.style.transition="min-height 0s"}else e.style.minHeight="",e.style.flexShrink="",e.style.transition=""};return t(),i.subscribe(t)},[i,s,o,n,r]),c=hl(a);return A.jsx(fl.Provider,{value:!0,children:A.jsx(is,{ref:c,children:e})})};gl.displayName="ThreadPrimitive.ViewportSlack";const vl=t.forwardRef((e,n)=>{const r=Zt(n,(()=>{const e=wn(),n=En(()=>e.message()),r=t.useCallback(e=>{const t=()=>{n.setIsHovering(!0)},r=()=>{n.setIsHovering(!1)};return e.addEventListener("mouseenter",t),e.addEventListener("mouseleave",r),e.matches(":hover")&&queueMicrotask(()=>n.setIsHovering(!0)),()=>{e.removeEventListener("mouseenter",t),e.removeEventListener("mouseleave",r),n.setIsHovering(!1)}},[n]);return hl(r)})(),(()=>{const e=jn(e=>e.turnAnchor),n=jn(e=>e.registerUserMessageHeight),r=En(({thread:t,message:n})=>{var r;return"top"===e&&"user"===n.role&&n.index===t.messages.length-2&&"assistant"===(null==(r=t.messages.at(-1))?void 0:r.role)}),s=t.useCallback(e=>e.offsetHeight,[]);return pl(r?n:null,s)})());return A.jsx(gl,{children:A.jsx(ds.div,{...e,ref:r})})});vl.displayName="MessagePrimitive.Root";const yl=t.forwardRef(({smooth:e=!0,component:n="span",...r},s)=>{const{text:i,status:o}=((e,n=!1)=>{const{text:r}=e,s=En(({message:e})=>e.id),i=t.useRef(s),[o,a]=t.useState(r),c=Ur({optional:!0}),l=Dr(t=>{if(a(t),c){const n=o!==t||"running"===e.status.type?Wr:e.status;c.setState(n,!0)}});t.useEffect(()=>{if(c){const t=!n||o===r&&"running"!==e.status.type?e.status:Wr;c.setState(t,!0)}},[c,n,r,o,e.status]);const[u]=t.useState(new zr(r,l));return t.useEffect(()=>{if(n){if(i.current!==s||!r.startsWith(u.targetText))return i.current=s,l(r),u.currentText=r,u.targetText=r,void u.stop();u.targetText=r,u.start()}else u.stop()},[l,u,s,n,r]),t.useEffect(()=>()=>{u.stop()},[u]),t.useMemo(()=>n?{type:"text",text:o,status:r===o?e.status:Wr}:e,[n,o,e,r])})(En(({part:e})=>{if("text"!==e.type&&"reasoning"!==e.type)throw new Error("MessagePartText can only be used inside text or reasoning message parts.");return e}),e);return A.jsx(n,{"data-status":o.type,...r,ref:s,children:i})});yl.displayName="MessagePartPrimitive.Text";const bl=t.forwardRef((e,t)=>{const{image:n}=En(({part:e})=>{if("image"!==e.type)throw new Error("MessagePartImage can only be used inside image message parts.");return e});return A.jsx(ds.img,{src:n,...e,ref:t})});bl.displayName="MessagePartPrimitive.Image";const wl=({children:e})=>En(({part:e})=>"running"===e.status.type)?e:null;wl.displayName="MessagePartPrimitive.InProgress";const xl=e=>Symbol.iterator in e,_l=e=>"entries"in e,Sl=(e,t)=>{const n=e instanceof Map?e:new Map(e.entries()),r=t instanceof Map?t:new Map(t.entries());if(n.size!==r.size)return!1;for(const[s,i]of n)if(!r.has(s)||!Object.is(i,r.get(s)))return!1;return!0};function El(e,t){return!!Object.is(e,t)||"object"==typeof e&&null!==e&&"object"==typeof t&&null!==t&&(Object.getPrototypeOf(e)===Object.getPrototypeOf(t)&&(xl(e)&&xl(t)?_l(e)&&_l(t)?Sl(e,t):((e,t)=>{const n=e[Symbol.iterator](),r=t[Symbol.iterator]();let s=n.next(),i=r.next();for(;!s.done&&!i.done;){if(!Object.is(s.value,i.value))return!1;s=n.next(),i=r.next()}return!!s.done&&!!i.done})(e,t):Sl({entries:()=>Object.entries(e)},{entries:()=>Object.entries(t)})))}const Il=e=>{let t=-1;return{startGroup:e=>{-1===t&&(t=e)},endGroup:(n,r)=>{-1!==t&&(r.push({type:e,startIndex:t,endIndex:n}),t=-1)},finalize:(n,r)=>{-1!==t&&r.push({type:e,startIndex:t,endIndex:n})}}},Tl=()=>{const e=En(function(e){const n=t.useRef(void 0);return t=>{const r=e(t);return El(n.current,r)?n.current:n.current=r}}(e=>e.message.parts.map(e=>e.type)));return t.useMemo(()=>0===e.length?[]:(e=>{const t=[],n=Il("toolGroup"),r=Il("reasoningGroup");for(let s=0;s<e.length;s++){const i=e[s];"tool-call"===i?(r.endGroup(s-1,t),n.startGroup(s)):"reasoning"===i?(n.endGroup(s-1,t),r.startGroup(s)):(n.endGroup(s-1,t),r.endGroup(s-1,t),t.push({type:"single",index:s}))}return n.finalize(e.length-1,t),r.finalize(e.length-1,t),t})(e),[e])},Cl=({Fallback:e,...t})=>{const n=En(({tools:n})=>{const r=n.tools[t.toolName]??e;return Array.isArray(r)?r[0]??e:r});return n?A.jsx(n,{...t}):null},Rl={Text:()=>A.jsxs("p",{style:{whiteSpace:"pre-line"},children:[A.jsx(yl,{}),A.jsx(wl,{children:A.jsx("span",{style:{fontFamily:"revert"},children:" "})})]}),Reasoning:()=>null,Source:()=>null,Image:()=>A.jsx(bl,{}),File:()=>null,Unstable_Audio:()=>null,ToolGroup:({children:e})=>e,ReasoningGroup:({children:e})=>e},kl=({components:{Text:e=Rl.Text,Reasoning:t=Rl.Reasoning,Image:n=Rl.Image,Source:r=Rl.Source,File:s=Rl.File,Unstable_Audio:i=Rl.Unstable_Audio,tools:o={}}={}})=>{var a,c;const l=wn(),u=En(({part:e})=>e),d=u.type;if("tool-call"===d){const e=l.part().addToolResult,t=l.part().resumeToolCall;if("Override"in o)return A.jsx(o.Override,{...u,addResult:e,resume:t});const n=(null==(a=o.by_name)?void 0:a[u.toolName])??o.Fallback;return A.jsx(Cl,{...u,Fallback:n,addResult:e,resume:t})}if("requires-action"===(null==(c=u.status)?void 0:c.type))throw new Error("Encountered unexpected requires-action status");switch(d){case"text":return A.jsx(e,{...u});case"reasoning":return A.jsx(t,{...u});case"source":return A.jsx(r,{...u});case"image":return A.jsx(n,{...u});case"file":return A.jsx(s,{...u});case"audio":return A.jsx(i,{...u});case"data":return null;default:throw new Error(`Unknown message part type: ${d}`)}},Al=t.memo(({index:e,components:t})=>A.jsx(rr,{index:e,children:A.jsx(kl,{components:t})}),(e,t)=>{var n,r,s,i,o,a,c,l,u,d,h,p,f,m,g,v,y,b;return e.index===t.index&&(null==(n=e.components)?void 0:n.Text)===(null==(r=t.components)?void 0:r.Text)&&(null==(s=e.components)?void 0:s.Reasoning)===(null==(i=t.components)?void 0:i.Reasoning)&&(null==(o=e.components)?void 0:o.Source)===(null==(a=t.components)?void 0:a.Source)&&(null==(c=e.components)?void 0:c.Image)===(null==(l=t.components)?void 0:l.Image)&&(null==(u=e.components)?void 0:u.File)===(null==(d=t.components)?void 0:d.File)&&(null==(h=e.components)?void 0:h.Unstable_Audio)===(null==(p=t.components)?void 0:p.Unstable_Audio)&&(null==(f=e.components)?void 0:f.tools)===(null==(m=t.components)?void 0:m.tools)&&(null==(g=e.components)?void 0:g.ToolGroup)===(null==(v=t.components)?void 0:v.ToolGroup)&&(null==(y=e.components)?void 0:y.ReasoningGroup)===(null==(b=t.components)?void 0:b.ReasoningGroup)});Al.displayName="MessagePrimitive.PartByIndex";const jl=({status:e,component:t})=>A.jsx(ir,{text:"",isRunning:"running"===e.type,children:A.jsx(t,{type:"text",text:"",status:e})}),Ml=Object.freeze({type:"complete"}),Nl=t.memo(({components:e})=>{const t=En(e=>e.message.status??Ml);return(null==e?void 0:e.Empty)?A.jsx(e.Empty,{status:t}):A.jsx(jl,{status:t,component:(null==e?void 0:e.Text)??Rl.Text})},(e,t)=>{var n,r,s,i;return(null==(n=e.components)?void 0:n.Empty)===(null==(r=t.components)?void 0:r.Empty)&&(null==(s=e.components)?void 0:s.Text)===(null==(i=t.components)?void 0:i.Text)}),Pl=({components:e})=>{const n=En(({message:e})=>e.parts.length),r=Tl(),s=t.useMemo(()=>0===n?A.jsx(Nl,{components:e}):r.map(t=>{if("single"===t.type)return A.jsx(Al,{index:t.index,components:e},t.index);if("toolGroup"===t.type){const n=(null==e?void 0:e.ToolGroup)??Rl.ToolGroup;return A.jsx(n,{startIndex:t.startIndex,endIndex:t.endIndex,children:Array.from({length:t.endIndex-t.startIndex+1},(n,r)=>A.jsx(Al,{index:t.startIndex+r,components:e},r))},`tool-${t.startIndex}`)}{const n=(null==e?void 0:e.ReasoningGroup)??Rl.ReasoningGroup;return A.jsx(n,{startIndex:t.startIndex,endIndex:t.endIndex,children:Array.from({length:t.endIndex-t.startIndex+1},(n,r)=>A.jsx(Al,{index:t.startIndex+r,components:e},r))},`reasoning-${t.startIndex}`)}}),[r,e,n]);return A.jsx(A.Fragment,{children:s})};Pl.displayName="MessagePrimitive.Parts";const Ol=()=>{const e=wn(),n=En(e=>e.thread.isRunning||!e.composer.isEditing||e.composer.isEmpty),r=t.useCallback(()=>{e.composer().send()},[e]);return n?null:r},Ll=ms("ComposerPrimitive.Send",Ol),Bl=t.forwardRef(({onSubmit:e,...t},n)=>{const r=Ol();return A.jsx(ds.form,{...t,ref:n,onSubmit:ps(e,e=>{e.preventDefault(),r&&r()})})});function Dl(){return Dl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Dl.apply(null,arguments)}Bl.displayName="ComposerPrimitive.Root";var Fl=t.useLayoutEffect,$l=function(e,t){"function"!=typeof e?e.current=t:e(t)},Ul={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0",display:"block"},zl=function(e){Object.keys(Ul).forEach(function(t){e.style.setProperty(t,Ul[t],"important")})},Wl=null,Hl=function(e,t){var n=e.scrollHeight;return"border-box"===t.sizingStyle.boxSizing?n+t.borderSize:n-t.paddingSize};var Vl=function(){},ql=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak","wordSpacing","scrollbarGutter"],Jl=!!document.documentElement.currentStyle,Yl=function(e){var t=window.getComputedStyle(e);if(null===t)return null;var n,r=(n=t,ql.reduce(function(e,t){return e[t]=n[t],e},{})),s=r.boxSizing;return""===s?null:(Jl&&"border-box"===s&&(r.width=parseFloat(r.width)+parseFloat(r.borderRightWidth)+parseFloat(r.borderLeftWidth)+parseFloat(r.paddingRight)+parseFloat(r.paddingLeft)+"px"),{sizingStyle:r,paddingSize:parseFloat(r.paddingBottom)+parseFloat(r.paddingTop),borderSize:parseFloat(r.borderBottomWidth)+parseFloat(r.borderTopWidth)})};function Kl(e,n,r){var s,i,o=(s=r,i=t.useRef(s),Fl(function(){i.current=s}),i);v.useLayoutEffect(function(){var t=function(e){return o.current(e)};if(e)return e.addEventListener(n,t),function(){return e.removeEventListener(n,t)}},[])}var Gl=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],Xl=function(e,n){var r=e.cacheMeasurements,s=e.maxRows,i=e.minRows,o=e.onChange,a=void 0===o?Vl:o,c=e.onHeightChange,l=void 0===c?Vl:c,u=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,Gl),d=void 0!==u.value,h=v.useRef(null),p=function(e,n){var r=t.useRef();return t.useCallback(function(t){e.current=t,r.current&&$l(r.current,null),r.current=n,n&&$l(n,t)},[n])}(h,n),f=v.useRef(0),m=v.useRef(),g=function(){var e=h.current,t=r&&m.current?m.current:Yl(e);if(t){m.current=t;var n=function(e,t,n,r){void 0===n&&(n=1),void 0===r&&(r=1/0),Wl||((Wl=document.createElement("textarea")).setAttribute("tabindex","-1"),Wl.setAttribute("aria-hidden","true"),zl(Wl)),null===Wl.parentNode&&document.body.appendChild(Wl);var s=e.paddingSize,i=e.borderSize,o=e.sizingStyle,a=o.boxSizing;Object.keys(o).forEach(function(e){var t=e;Wl.style[t]=o[t]}),zl(Wl),Wl.value=t;var c=Hl(Wl,e);Wl.value=t,c=Hl(Wl,e),Wl.value="x";var l=Wl.scrollHeight-s,u=l*n;"border-box"===a&&(u=u+s+i),c=Math.max(u,c);var d=l*r;return"border-box"===a&&(d=d+s+i),[c=Math.min(d,c),l]}(t,e.value||e.placeholder||"x",i,s),o=n[0],a=n[1];f.current!==o&&(f.current=o,e.style.setProperty("height",o+"px","important"),l(o,{rowHeight:a}))}};return v.useLayoutEffect(g),function(e,t){Kl(document.body,"reset",function(n){e.current.form===n.target&&t(n)})}(h,function(){if(!d){var e=h.current.value;requestAnimationFrame(function(){var t=h.current;t&&e!==t.value&&g()})}}),Kl(window,"resize",g),function(e){Kl(document.fonts,"loadingdone",e)}(g),v.createElement("textarea",Dl({},u,{onChange:function(e){d||g(),a(e)},ref:p}))},Zl=v.forwardRef(Xl);const Ql=e=>{const n=Dr(e),r=jn(e=>e.onScrollToBottom);t.useEffect(()=>r(n),[r,n])},eu=t.forwardRef(({autoFocus:e=!1,asChild:n,disabled:r,onChange:s,onKeyDown:i,onPaste:o,submitOnEnter:a=!0,cancelOnEscape:c=!0,unstable_focusOnRunStart:l=!0,unstable_focusOnScrollToBottom:u=!0,unstable_focusOnThreadSwitched:d=!0,addAttachmentOnPaste:h=!0,...p},f)=>{const m=wn(),g=En(({composer:e})=>e.isEditing?e.text:""),v=n?is:Zl,y=En(({thread:e})=>e.isDisabled)||r,b=t.useRef(null),w=Zt(f,b);gs(e=>{var t;if(!c)return;if(!(null==(t=b.current)?void 0:t.contains(e.target)))return;const n=m.composer();n.getState().canCancel&&(n.cancel(),e.preventDefault())});const x=e&&!y,_=t.useCallback(()=>{const e=b.current;e&&x&&(e.focus({preventScroll:!0}),e.setSelectionRange(e.value.length,e.value.length))},[x]);return t.useEffect(()=>_(),[_]),Ql(()=>{"thread"===m.composer().getState().type&&u&&_()}),t.useEffect(()=>{if("thread"===m.composer().getState().type&&l)return m.on("thread.run-start",_)},[l,_,m]),t.useEffect(()=>{if("thread"===m.composer().getState().type&&d)return m.on("thread-list-item.switched-to",_)},[d,_,m]),A.jsx(v,{name:"input",value:g,...p,ref:w,disabled:y,onChange:ps(s,e=>{m.composer().getState().isEditing&&$t(()=>{m.composer().setText(e.target.value)})}),onKeyDown:ps(i,e=>{var t,n;if(!y&&a&&!e.nativeEvent.isComposing&&"Enter"===e.key&&!1===e.shiftKey){m.thread().getState().isRunning||(e.preventDefault(),null==(n=null==(t=b.current)?void 0:t.closest("form"))||n.requestSubmit())}}),onPaste:ps(o,async e=>{var t;if(!h)return;const n=m.thread().getState().capabilities,r=Array.from((null==(t=e.clipboardData)?void 0:t.files)||[]);if(n.attachments&&r.length>0)try{e.preventDefault(),await Promise.all(r.map(e=>m.composer().addAttachment(e)))}catch(s){}})})});eu.displayName="ComposerPrimitive.Input";const tu=t.forwardRef((e,t)=>A.jsx(ds.div,{...e,ref:t}));tu.displayName="ThreadPrimitive.Root";const nu=({children:e})=>En(({thread:e})=>0===e.messages.length&&!e.isLoading)?e:null;nu.displayName="ThreadPrimitive.Empty";const ru=({children:e,...t})=>{var n;return(n=t,En(({thread:e})=>!(!0===n.empty&&!e.isEmpty||!1===n.empty&&e.isEmpty||!0===n.running&&!e.isRunning||!1===n.running&&e.isRunning||!0===n.disabled&&!e.isDisabled||!1===n.disabled&&e.isDisabled)))?e:null};ru.displayName="ThreadPrimitive.If";const su=({autoScroll:e,scrollToBottomOnRunStart:n=!0,scrollToBottomOnInitialize:r=!0,scrollToBottomOnThreadSwitch:s=!0})=>{const i=t.useRef(null),o=Mn();void 0===e&&(e="top"!==o.getState().turnAnchor);const a=t.useRef(0),c=t.useRef(null),l=t.useCallback(e=>{const t=i.current;t&&(c.current=e,t.scrollTo({top:t.scrollHeight,behavior:e}))},[]),u=()=>{const e=i.current;if(!e)return;const t=o.getState().isAtBottom,n=Math.abs(e.scrollHeight-e.scrollTop-e.clientHeight)<1||e.scrollHeight<=e.clientHeight;if(!n&&a.current<e.scrollTop);else{n&&(c.current=null);(n||null===c.current)&&n!==t&&o.setState({isAtBottom:n})}a.current=e.scrollTop},d=(e=>{const n=Dr(e),r=t.useCallback(e=>{const t=new ResizeObserver(()=>{n()}),r=new MutationObserver(()=>{n()});return t.observe(e),r.observe(e,{childList:!0,subtree:!0,attributes:!0,characterData:!0}),()=>{t.disconnect(),r.disconnect()}},[n]);return hl(r)})(()=>{const t=c.current;t?l(t):e&&o.getState().isAtBottom&&l("instant"),u()}),h=hl(e=>(e.addEventListener("scroll",u),()=>{e.removeEventListener("scroll",u)}));Ql(({behavior:e})=>{l(e)}),In("thread.run-start",()=>{n&&(c.current="auto",requestAnimationFrame(()=>{l("auto")}))}),In("thread.initialize",()=>{r&&(c.current="instant",requestAnimationFrame(()=>{l("instant")}))}),In("thread-list-item.switched-to",()=>{s&&(c.current="instant",requestAnimationFrame(()=>{l("instant")}))});return Zt(d,h,i)},iu=t.forwardRef(({autoScroll:e,scrollToBottomOnRunStart:n,scrollToBottomOnInitialize:r,scrollToBottomOnThreadSwitch:s,children:i,...o},a)=>{const c=Zt(a,su({autoScroll:e,scrollToBottomOnRunStart:n,scrollToBottomOnInitialize:r,scrollToBottomOnThreadSwitch:s}),(()=>{const e=jn(e=>e.registerViewport),n=t.useCallback(e=>e.clientHeight,[]);return pl(e,n)})());return A.jsx(ds.div,{...o,ref:c,children:i})});iu.displayName="ThreadPrimitive.ViewportScrollable";const ou=t.forwardRef(({turnAnchor:e,...t},n)=>A.jsx(Qn,{options:{turnAnchor:e},children:A.jsx(iu,{...t,ref:n})}));ou.displayName="ThreadPrimitive.Viewport";const au=(e,t)=>e.Message===t.Message&&e.EditComposer===t.EditComposer&&e.UserEditComposer===t.UserEditComposer&&e.AssistantEditComposer===t.AssistantEditComposer&&e.SystemEditComposer===t.SystemEditComposer&&e.UserMessage===t.UserMessage&&e.AssistantMessage===t.AssistantMessage&&e.SystemMessage===t.SystemMessage,cu=()=>null,lu=({components:e})=>{const t=((e,t,n)=>{switch(t){case"user":return n?e.UserEditComposer??e.EditComposer??e.UserMessage??e.Message:e.UserMessage??e.Message;case"assistant":return n?e.AssistantEditComposer??e.EditComposer??e.AssistantMessage??e.Message:e.AssistantMessage??e.Message;case"system":return n?e.SystemEditComposer??e.EditComposer??e.SystemMessage??e.Message:e.SystemMessage??cu;default:throw new Error(`Unknown message role: ${t}`)}})(e,En(({message:e})=>e.role),En(({message:e})=>e.composer.isEditing));return A.jsx(t,{})},uu=t.memo(({index:e,components:t})=>A.jsx(nr,{index:e,children:A.jsx(lu,{components:t})}),(e,t)=>e.index===t.index&&au(e.components,t.components));uu.displayName="ThreadPrimitive.MessageByIndex";const du=({components:e})=>{const n=En(({thread:e})=>e.messages.length);return t.useMemo(()=>0===n?null:Array.from({length:n},(t,n)=>A.jsx(uu,{index:n,components:e},n)),[n,e])};du.displayName="ThreadPrimitive.Messages";const hu=t.memo(du,(e,t)=>au(e.components,t.components)),pu=ms("ThreadPrimitive.ScrollToBottom",({behavior:e}={})=>{const n=jn(e=>e.isAtBottom),r=Mn(),s=t.useCallback(()=>{r.getState().scrollToBottom({behavior:e})},[r,e]);return n?null:s},["behavior"]);class fu{constructor(e){d(this,"config"),d(this,"abortController",null),this.config=e}async*run(e){var t,n,r,s;const i=this.config.proxyUrl&&this.config.instanceId,o=i?this.config.proxyUrl:this.config.webhookUrl;if(!o||""===o.trim()){const e=new Error("Webhook URL is not configured. Please configure the webhook URL in the chat instance settings.");throw null==(n=(t=this.config).onError)||n.call(t,e),e}this.abortController=new AbortController;const a=e.messages.filter(e=>"user"===e.role).pop(),c=(null==a?void 0:a.content.filter(e=>"text"===e.type).map(e=>e.text).join(""))||"",l={action:"sendMessage",sessionId:this.config.sessionId,chatInput:c,context:this.config.context};i&&(l.instance_id=this.config.instanceId);try{const e=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Accept:i?"application/json":"text/event-stream"},body:JSON.stringify(l),signal:this.abortController.signal});if(!e.ok){const t=await e.text();throw new Error(`HTTP ${e.status}: ${t}`)}const t=e.headers.get("content-type")||"";t.includes("text/event-stream")?yield*this.handleSSEResponse(e):t.includes("application/json")?yield*this.handleJSONResponse(e):yield*this.handleTextResponse(e)}catch(u){if(u instanceof Error&&"AbortError"===u.name)return;throw null==(s=(r=this.config).onError)||s.call(r,u instanceof Error?u:new Error(String(u))),u}}async*handleSSEResponse(e){var t;const n=null==(t=e.body)?void 0:t.getReader();if(!n)throw new Error("No response body");const r=new TextDecoder;let s="",i="";try{for(;;){const{done:e,value:t}=await n.read();if(e)break;s+=r.decode(t,{stream:!0});const a=s.split("\n");s=a.pop()||"";for(const n of a)if(n.trim()&&!n.startsWith(":")&&n.startsWith("data: ")){const e=n.slice(6);if("[DONE]"===e)continue;try{const t=JSON.parse(e);if(t.error)throw new Error(t.error);t.text&&(i+=t.text,yield{content:[{type:"text",text:i}]}),t.tool_calls&&(yield{content:[{type:"text",text:i}]})}catch(o){e.trim()&&(i+=e,yield{content:[{type:"text",text:i}]})}}}if(s.trim()&&s.startsWith("data: ")){const e=s.slice(6);if("[DONE]"!==e&&e.trim()){try{const t=JSON.parse(e);t.text&&(i+=t.text)}catch{i+=e}yield{content:[{type:"text",text:i}]}}}}finally{n.releaseLock()}}async*handleJSONResponse(e){const t=await e.json(),n=t.output||t.text||t.message||t.response||t.content||("string"==typeof t?t:JSON.stringify(t));yield{content:[{type:"text",text:n}]}}async*handleTextResponse(e){const t=await e.text();yield{content:[{type:"text",text:t}]}}cancel(){var e;null==(e=this.abortController)||e.abort(),this.abortController=null}formatMessages(e){return e.map(e=>{const t=e.content.filter(e=>"text"===e.type).map(e=>e.text),n=e.content.filter(e=>"image"===e.type||"file"===e.type).map(e=>({type:e.type,url:e.url,filename:e.filename||"attachment",mimeType:e.mimeType||"application/octet-stream"})),r={role:e.role,content:t.join("")};return n.length>0&&(r.attachments=n),r})}updateSessionId(e){this.config.sessionId=e}updateContext(e){this.config.context={...this.config.context,...e}}}const mu=({className:e})=>A.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[A.jsx("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),A.jsx("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})]}),gu=({className:e})=>A.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[A.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),A.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]}),vu=({className:e})=>A.jsx("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:A.jsx("polyline",{points:"6 9 12 15 18 9"})}),yu=({className:e})=>A.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[A.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),A.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),bu=({className:e})=>A.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[A.jsx("rect",{x:"3",y:"11",width:"18",height:"10",rx:"2"}),A.jsx("circle",{cx:"12",cy:"5",r:"2"}),A.jsx("path",{d:"M12 7v4"}),A.jsx("line",{x1:"8",y1:"16",x2:"8",y2:"16"}),A.jsx("line",{x1:"16",y1:"16",x2:"16",y2:"16"})]}),wu=({className:e})=>A.jsx("svg",{className:e,viewBox:"0 0 24 24",fill:"currentColor",children:A.jsx("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z"})}),xu=({className:e})=>A.jsx("svg",{className:e,viewBox:"0 0 24 24",fill:"currentColor",children:A.jsx("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"})}),_u=({className:e,size:t=16})=>A.jsxs("svg",{className:e,width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[A.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),A.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),Su=e=>{const t="string"==typeof e?new Date(e):e,n=(new Date).getTime()-t.getTime(),r=Math.floor(n/6e4),s=Math.floor(n/36e5),i=Math.floor(n/864e5);return r<1?"Just now":r<60?`${r}m ago`:s<24?`${s}h ago`:i<7?`${i}d ago`:t.toLocaleDateString()},Eu=e=>e<1024?`${e} B`:e<1048576?`${(e/1024).toFixed(1)} KB`:`${(e/1048576).toFixed(1)} MB`,Iu=({type:e,src:n,primaryColor:r,show:s=!0})=>{const[i,o]=t.useState(!1);return s?A.jsx("div",{className:"flowchat-avatar "+("user"===e?"flowchat-avatar-user":"flowchat-avatar-assistant"),style:"user"===e&&r?{backgroundColor:r}:void 0,children:n&&!i?A.jsx("img",{src:n,alt:"",onError:()=>o(!0)}):"user"===e?A.jsx(yu,{style:{width:16,height:16}}):A.jsx(bu,{style:{width:16,height:16}})}):A.jsx("div",{style:{width:32,height:32}})},Tu=({show:e})=>{const t=Pn();return e&&(null==t?void 0:t.createdAt)?A.jsx("span",{className:"flowchat-timestamp",children:Su(t.createdAt)}):null},Cu=({primaryColor:e,showAvatar:t=!0,showTimestamp:n})=>A.jsx(vl,{className:"aui-user-message-root",children:A.jsxs("div",{className:"flowchat-message flowchat-message-user",children:[A.jsx(Iu,{type:"user",primaryColor:e,show:t}),A.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px",alignItems:"flex-end"},children:[A.jsx("div",{className:"aui-user-message-content",style:e?{background:`linear-gradient(135deg, ${e} 0%, ${e}e6 100%)`}:void 0,children:A.jsx(Pl,{})}),A.jsx(Tu,{show:n})]})]})}),Ru=({avatarUrl:e,showAvatar:t=!0,showTimestamp:n})=>A.jsx(vl,{className:"aui-assistant-message-root",children:A.jsxs("div",{className:"flowchat-message flowchat-message-assistant",children:[A.jsx(Iu,{type:"assistant",src:e,show:t}),A.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[A.jsx("div",{className:"aui-assistant-message-content",children:A.jsx(Pl,{})}),A.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[A.jsx(hs,{className:"aui-assistant-action-bar-root",children:A.jsx(fs,{asChild:!0,children:A.jsx("button",{className:"flowchat-action-button","aria-label":"Copy message",children:A.jsx(gu,{style:{width:14,height:14}})})})}),A.jsx(Tu,{show:n})]})]})]})}),ku=()=>A.jsx(pu,{className:"aui-thread-scroll-to-bottom",children:A.jsx(vu,{style:{width:16,height:16}})}),Au=({file:e,onRemove:n})=>{const r=e.type.startsWith("image/"),[s,i]=t.useState(null);return t.useEffect(()=>{if(r){const t=URL.createObjectURL(e);return i(t),()=>URL.revokeObjectURL(t)}},[e,r]),A.jsxs("div",{className:"flowchat-attachment-preview",children:[r&&s?A.jsx("img",{src:s,alt:e.name,className:"flowchat-attachment-image"}):A.jsxs("div",{className:"flowchat-attachment-file",children:[A.jsx(xu,{style:{width:16,height:16}}),A.jsx("span",{className:"flowchat-attachment-name",children:e.name}),A.jsx("span",{className:"flowchat-attachment-size",children:Eu(e.size)})]}),A.jsx("button",{type:"button",className:"flowchat-attachment-remove",onClick:n,"aria-label":"Remove attachment",children:A.jsx(_u,{size:14})})]})},ju=({placeholder:e="Type your message...",showVoiceInput:n=!0,primaryColor:r,fileUpload:s=!1,fileTypes:i=["image/jpeg","image/png","image/gif","application/pdf"],maxFileSize:o=10485760})=>{const a=t.useRef(null),[c,l]=t.useState([]),[u,d]=t.useState(null),h=t.useCallback(e=>{const t=Array.from(e.target.files||[]);d(null);for(const n of t)i.length>0&&!i.some(e=>e.endsWith("/*")?n.type.startsWith(e.slice(0,-1)):n.type===e)?d(`File type ${n.type} is not allowed`):n.size>o?d(`File ${n.name} exceeds maximum size of ${Eu(o)}`):l(e=>[...e,n]);a.current&&(a.current.value="")},[i,o]),p=t.useCallback(e=>{l(t=>t.filter((t,n)=>n!==e))},[]);return A.jsxs(Bl,{className:"aui-composer-root",children:[c.length>0&&A.jsx("div",{className:"flowchat-attachments-container",children:c.map((e,t)=>A.jsx(Au,{file:e,onRemove:()=>p(t)},`${e.name}-${t}`))}),u&&A.jsxs("div",{className:"flowchat-composer-error",children:[u,A.jsx("button",{type:"button",onClick:()=>d(null),children:A.jsx(_u,{size:12})})]}),A.jsxs("div",{className:"flowchat-composer-container",children:[s&&A.jsxs(A.Fragment,{children:[A.jsx("input",{ref:a,type:"file",accept:i.join(","),multiple:!0,onChange:h,style:{display:"none"}}),A.jsx("button",{type:"button",className:"flowchat-attachment-button",onClick:()=>{var e;return null==(e=a.current)?void 0:e.click()},"aria-label":"Attach file",children:A.jsx(xu,{style:{width:18,height:18}})})]}),A.jsx(eu,{placeholder:e,className:"aui-composer-input",autoFocus:!0}),A.jsxs("div",{className:"flowchat-composer-actions",children:[n&&A.jsx("button",{type:"button",className:"flowchat-voice-button","aria-label":"Start voice input",children:A.jsx(wu,{style:{width:18,height:18}})}),A.jsx(Ll,{className:"aui-composer-send",style:r?{backgroundColor:r}:void 0,children:A.jsx(mu,{className:"aui-composer-send-icon"})})]})]})]})},Mu=({prompts:e,primaryColor:t})=>{const n=function(e){const t=wn(),n=En(()=>{var e,n;return t.thread.source?(null==(n=(e=t.thread()).__internal_getRuntime)?void 0:n.call(e))??null:null});if(!n&&!(null==e?void 0:e.optional))throw new Error("ThreadRuntime is not available");return n}();if(!e||0===e.length)return null;return A.jsx("div",{className:"flowchat-suggestions",children:e.slice(0,4).map((e,r)=>A.jsx("button",{type:"button",className:"flowchat-suggestion-button",onClick:()=>(e=>{n.append({role:"user",content:[{type:"text",text:e}]})})(e),style:t?{borderColor:`${t}40`,color:t}:void 0,children:e},r))})},Nu=({message:e="Hi! How can I help you today?",avatarUrl:t,showAvatar:n=!0,suggestedPrompts:r,primaryColor:s})=>A.jsxs(nu,{children:[A.jsxs("div",{className:"flowchat-welcome",children:[A.jsx(Iu,{type:"assistant",src:t,show:n}),A.jsx("div",{className:"flowchat-welcome-content",children:A.jsx("p",{style:{margin:0},children:e})})]}),A.jsx(Mu,{prompts:r,primaryColor:s})]}),Pu=({avatarUrl:e,showAvatar:t=!0})=>A.jsxs("div",{className:"flowchat-typing",children:[A.jsx(Iu,{type:"assistant",src:e,show:t}),A.jsxs("div",{className:"flowchat-typing-dots",children:[A.jsx("span",{className:"flowchat-typing-dot"}),A.jsx("span",{className:"flowchat-typing-dot"}),A.jsx("span",{className:"flowchat-typing-dot"})]})]}),Ou=({welcomeMessage:e,placeholder:n,showVoiceInput:r=!0,primaryColor:s,suggestedPrompts:i,showTimestamp:o=!1,showAvatar:a=!0,avatarUrl:c,showTypingIndicator:l=!0,fileUpload:u=!1,fileTypes:d,maxFileSize:h,onNewMessage:p})=>{const f=t.useCallback(()=>A.jsx(Cu,{primaryColor:s,showAvatar:a,showTimestamp:o}),[s,a,o]),m=t.useCallback(()=>A.jsx(Ru,{avatarUrl:c,showAvatar:a,showTimestamp:o}),[c,a,o]);return A.jsxs(tu,{className:"aui-thread-root",children:[A.jsxs(ou,{className:"aui-thread-viewport",children:[A.jsx(Nu,{message:e,avatarUrl:c,showAvatar:a,suggestedPrompts:i,primaryColor:s}),A.jsx(hu,{components:{UserMessage:f,AssistantMessage:m}}),l&&A.jsx(ru,{running:!0,children:A.jsx(Pu,{avatarUrl:c,showAvatar:a})})]}),A.jsx(ku,{}),A.jsx(ju,{placeholder:n,showVoiceInput:r,primaryColor:s,fileUpload:u,fileTypes:d,maxFileSize:h})]})},Lu=({className:e})=>A.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[A.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),A.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),Bu=({title:e="Chat",onClose:t,primaryColor:n})=>A.jsxs("div",{className:"\n      fc-flex fc-items-center fc-justify-between\n      fc-px-4 fc-py-3\n      fc-text-white\n      fc-border-b fc-border-white/10\n    ",style:{backgroundColor:n||"hsl(var(--aui-primary))"},children:[A.jsx("h2",{className:"fc-text-base fc-font-semibold fc-m-0",children:e}),t&&A.jsx("button",{onClick:t,className:"\n          fc-flex fc-items-center fc-justify-center\n          fc-w-8 fc-h-8 fc-rounded-lg\n          fc-bg-white/10 hover:fc-bg-white/20\n          fc-border-0 fc-cursor-pointer fc-text-inherit\n          fc-transition-colors fc-duration-150\n        ","aria-label":"Close chat",children:A.jsx(Lu,{className:"fc-w-5 fc-h-5"})})]}),Du=({config:e,onClose:t})=>A.jsxs("div",{className:"fc-flex fc-flex-col fc-h-full fc-overflow-hidden",children:[e.showHeader&&A.jsx(Bu,{title:e.chatTitle,onClose:t,primaryColor:e.primaryColor}),A.jsx(Ou,{welcomeMessage:e.welcomeMessage,placeholder:e.placeholderText,showVoiceInput:!0})]}),Fu=({webhookUrl:e,sessionId:n,config:r,context:s={},apiUrl:i,isPreview:o=!1,onClose:a})=>{const c=t.useMemo(()=>new fu({webhookUrl:e,sessionId:n,context:s,proxyUrl:i?`${i}/proxy`:void 0,instanceId:r.instanceId,onError:e=>{}}),[e,n,s,i,r.instanceId]),l=Lr(c),u="dark"===r.theme?"fc-dark":"",d=r.primaryColor?{"--aui-primary":$u(r.primaryColor)}:{};return A.jsx("div",{className:`flowchat-widget aui-root ${u}`,style:d,"data-preview":o,children:A.jsx(er,{runtime:l,children:A.jsx(Du,{config:r,onClose:a})})})};function $u(e){e=e.replace(/^#/,"");const t=parseInt(e.substring(0,2),16)/255,n=parseInt(e.substring(2,4),16)/255,r=parseInt(e.substring(4,6),16)/255,s=Math.max(t,n,r),i=Math.min(t,n,r);let o=0,a=0;const c=(s+i)/2;if(s!==i){const e=s-i;switch(a=c>.5?e/(2-s-i):e/(s+i),s){case t:o=((n-r)/e+(n<r?6:0))/6;break;case n:o=((r-t)/e+2)/6;break;case r:o=((t-n)/e+4)/6}}return`${Math.round(360*o)} ${Math.round(100*a)}% ${Math.round(100*c)}%`}const Uu=({size:e=24})=>A.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:A.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})}),zu=({size:e=24})=>A.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[A.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),A.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),Wu={chat:Uu,message:({size:e=24})=>A.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:A.jsx("path",{d:"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"})}),help:({size:e=24})=>A.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[A.jsx("circle",{cx:"12",cy:"12",r:"10"}),A.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),A.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),headphones:({size:e=24})=>A.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[A.jsx("path",{d:"M3 18v-6a9 9 0 0 1 18 0v6"}),A.jsx("path",{d:"M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"})]}),sparkles:({size:e=24})=>A.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[A.jsx("path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"}),A.jsx("path",{d:"M5 3v4"}),A.jsx("path",{d:"M19 17v4"}),A.jsx("path",{d:"M3 5h4"}),A.jsx("path",{d:"M17 19h4"})]}),camera:({size:e=24})=>A.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[A.jsx("path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"}),A.jsx("circle",{cx:"12",cy:"13",r:"3"})]})},Hu=({icon:e,customIconUrl:n,size:r,isOpen:s})=>{const[i,o]=t.useState(!1);if(s)return A.jsx(zu,{size:r});if(n&&!i)return A.jsx("img",{src:n,alt:"Chat",style:{width:r,height:r,objectFit:"contain"},onError:()=>o(!0)});const a=Wu[e||"chat"]||Uu;return A.jsx(a,{size:r})},Vu=({count:e,show:t,primaryColor:n})=>t&&0!==e?A.jsx("span",{className:"flowchat-unread-badge",style:n?{backgroundColor:n}:void 0,children:e>99?"99+":e}):null,qu=({text:e,isOpen:t,position:n})=>{if(!e||t)return null;const r=null==n?void 0:n.includes("left");return A.jsx("span",{className:"flowchat-bubble-text",style:{[r?"marginLeft":"marginRight"]:"12px",order:r?1:-1},children:e})},Ju=({title:e="Chat",onClose:t,primaryColor:n})=>A.jsxs("div",{className:"flowchat-header",style:n?{background:`linear-gradient(135deg, ${n} 0%, ${n}e6 100%)`}:void 0,children:[A.jsx("h2",{className:"flowchat-header-title",children:e}),t&&A.jsx("button",{onClick:t,className:"flowchat-header-close","aria-label":"Close chat",children:A.jsx(zu,{size:20})})]}),Yu={small:{width:48,height:48,iconSize:20},medium:{width:56,height:56,iconSize:24},large:{width:64,height:64,iconSize:28}},Ku=({config:e})=>{var n,r,s,i,o,a,c,l,u;const d=e.bubble,[h,p]=t.useState(!1),[f,m]=t.useState(!1),[g,v]=t.useState(0),y=Yu[d.size||"medium"],b=t.useCallback(e=>{p(e),e&&(m(!0),v(0))},[]);((e,n,r,s)=>{t.useEffect(()=>{var t,i,o,a;if(!(null==e?void 0:e.enabled)||n)return;const c="flowchat_auto_opened",l="flowchat_auto_opened_day";if((null==(t=e.conditions)?void 0:t.oncePerSession)&&sessionStorage.getItem(c))return;if(null==(i=e.conditions)?void 0:i.oncePerDay){const e=(new Date).toDateString();if(localStorage.getItem(l)===e)return}if((null==(o=e.conditions)?void 0:o.skipIfInteracted)&&s)return;if((null==(a=e.conditions)?void 0:a.excludeMobile)&&window.innerWidth<768)return;const u=()=>{var t,n;r(!0),(null==(t=e.conditions)?void 0:t.oncePerSession)&&sessionStorage.setItem(c,"true"),(null==(n=e.conditions)?void 0:n.oncePerDay)&&localStorage.setItem(l,(new Date).toDateString())};if("delay"===e.trigger){const t=setTimeout(u,1e3*(e.delay||5));return()=>clearTimeout(t)}if("scroll"===e.trigger){const t=()=>{window.scrollY/(document.body.scrollHeight-window.innerHeight)*100>=(e.scrollPercentage||50)&&(u(),window.removeEventListener("scroll",t))};return window.addEventListener("scroll",t),()=>window.removeEventListener("scroll",t)}if("exit-intent"===e.trigger){const e=t=>{t.clientY<=0&&(u(),document.removeEventListener("mouseleave",e))};return document.addEventListener("mouseleave",e),()=>document.removeEventListener("mouseleave",e)}if("idle"===e.trigger){let t;const n=()=>{clearTimeout(t),t=setTimeout(u,1e3*(e.idleTime||30))},r=["mousemove","keydown","scroll","click"];return r.forEach(e=>document.addEventListener(e,n)),n(),()=>{clearTimeout(t),r.forEach(e=>document.removeEventListener(e,n))}}},[e,n,r,s])})(e.autoOpen,h,b,f);const w=null==(n=d.position)?void 0:n.includes("top"),x=null==(r=d.position)?void 0:r.includes("left"),_={position:"fixed",zIndex:9999,[x?"left":"right"]:d.offsetX||24,[w?"top":"bottom"]:d.offsetY||24},S=(null==(s=e.window)?void 0:s.width)||400,E=(null==(i=e.window)?void 0:i.height)||600,I={position:"fixed",zIndex:9998,[x?"left":"right"]:d.offsetX||24,[w?"top":"bottom"]:(d.offsetY||24)+y.height+16,width:`${Math.max(300,Math.min(S,window.innerWidth-48))}px`,height:`${Math.max(400,Math.min(E,window.innerHeight-120))}px`,maxWidth:"calc(100vw - 48px)",maxHeight:"calc(100vh - 120px)"},T=e.primaryColor?{width:y.width,height:y.height,background:`linear-gradient(135deg, ${e.primaryColor} 0%, ${e.primaryColor}e6 100%)`}:{width:y.width,height:y.height};return A.jsxs(cl,{open:h,onOpenChange:b,children:[A.jsx(dl,{style:_,children:A.jsxs("div",{className:"flowchat-bubble-container",style:{display:"flex",alignItems:"center"},children:[A.jsx(qu,{text:d.text,isOpen:h,position:d.position}),A.jsxs(ll,{className:"flowchat-bubble-button "+(d.pulseAnimation&&!h?"pulse":""),style:T,children:[A.jsx(Hu,{icon:d.icon,customIconUrl:d.customIconUrl,size:y.iconSize,isOpen:h}),A.jsx(Vu,{count:g,show:!1!==d.showUnreadBadge,primaryColor:e.primaryColor})]})]})}),A.jsxs(ul,{className:"flowchat-modal",style:I,sideOffset:16,children:[e.showHeader&&A.jsx(Ju,{title:e.chatTitle,onClose:()=>b(!1),primaryColor:e.primaryColor}),A.jsx("div",{style:{flex:1,minHeight:0,overflow:"hidden"},children:A.jsx(Ou,{welcomeMessage:e.welcomeMessage,placeholder:e.placeholderText,showVoiceInput:!1!==(null==(o=e.features)?void 0:o.voiceInput),primaryColor:e.primaryColor,suggestedPrompts:e.suggestedPrompts,showTimestamp:e.showTimestamp,showAvatar:!1!==e.showAvatar,avatarUrl:e.avatarUrl,showTypingIndicator:!1!==(null==(a=e.features)?void 0:a.showTypingIndicator),fileUpload:null==(c=e.features)?void 0:c.fileUpload,fileTypes:null==(l=e.features)?void 0:l.fileTypes,maxFileSize:null==(u=e.features)?void 0:u.maxFileSize,onNewMessage:()=>{h||v(e=>e+1)}})})]})]})},Gu=({webhookUrl:e,sessionId:n,config:r,context:s={},apiUrl:i})=>{var o,a,c,l,u,d,h,p;const f=null==(o=r.rules)?void 0:o.deviceTargeting;if(f){const e=window.innerWidth,t=e>=768&&e<1024,n=e>=1024;if(e<768&&!f.mobile)return null;if(t&&!f.tablet)return null;if(n&&!f.desktop)return null}if((null==(a=r.rules)?void 0:a.requireLogin)&&!(null==(c=null==s?void 0:s.user)?void 0:c.isLoggedIn))return null;const m=t.useMemo(()=>new fu({webhookUrl:e,sessionId:n,context:s,proxyUrl:i?`${i}/proxy`:void 0,instanceId:r.instanceId,onError:e=>{}}),[e,n,s,i,r.instanceId]),g=Lr(m),v={};return(null==(l=r.appearance)?void 0:l.primaryColor)&&(v["--fc-primary"]=r.appearance.primaryColor),(null==(u=r.appearance)?void 0:u.font)&&(v["--fc-font-family"]=r.appearance.font),(null==(d=r.appearance)?void 0:d.fontSize)&&(v["--fc-font-size"]=`${r.appearance.fontSize}px`),void 0!==(null==(h=r.appearance)?void 0:h.borderRadius)&&(v["--fc-border-radius"]=`${r.appearance.borderRadius}px`),A.jsxs("div",{className:"flowchat-widget",style:v,children:[A.jsx(er,{runtime:g,children:A.jsx(Ku,{config:r})}),(null==(p=r.appearance)?void 0:p.customCss)&&A.jsx("style",{dangerouslySetInnerHTML:{__html:r.appearance.customCss}})]})},Xu=({className:e})=>A.jsx("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:A.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})}),Zu=({className:e})=>A.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[A.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),A.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]});async function Qu(e){var t,n;const r=document.getElementById(e.containerId);if(r)try{const s=await fetch(`${e.apiUrl}/init?instance_id=${encodeURIComponent(e.instanceId)}`,{headers:{"X-WP-Nonce":e.nonce}});if(!s.ok){const e=await s.json();return void((null==(t=window.n8nChatConfig)?void 0:t.debug)&&(r.innerHTML=`<div class="n8n-chat-error">${e.message||"Failed to initialize"}</div>`))}const i=await s.json(),o=k(r);"bubble"===e.mode?o.render(A.jsx(Gu,{webhookUrl:i.webhookUrl,sessionId:i.sessionId,config:i.config,context:i.context,apiUrl:e.apiUrl})):o.render(A.jsx(Fu,{webhookUrl:i.webhookUrl,sessionId:i.sessionId,config:i.config,context:i.context,apiUrl:e.apiUrl})),null==(n=window.n8nChatConfig)||n.debug}catch(s){}}function ed(){Object.keys(window).forEach(e=>{if(e.startsWith("n8nChatInit_")){const t=window[e];t&&t.containerId&&Qu(t)}if(e.startsWith("n8nChatBubble_")){const t=window[e];t&&t.containerId&&Qu({...t,mode:"bubble"})}})}return"loading"===document.readyState?document.addEventListener("DOMContentLoaded",ed):ed(),window.N8nChat={init:Qu},e.AssistantModal=({children:e,position:n="bottom-right",offsetX:r=24,offsetY:s=24,bubbleSize:i="md",bubbleColor:o,showPulse:a=!0,bubbleIcon:c,...l})=>{const[u,d]=t.useState(!1),h={[n.includes("right")?"right":"left"]:r,bottom:s};return A.jsxs(cl,{open:u,onOpenChange:d,...l,children:[A.jsx(dl,{className:"fc-fixed fc-z-50",style:h,children:A.jsxs(ll,{className:`\n            fc-flex fc-items-center fc-justify-center fc-rounded-full fc-cursor-pointer\n            fc-shadow-bubble hover:fc-shadow-bubble-hover\n            fc-transition-all fc-duration-200\n            hover:fc-scale-110 active:fc-scale-90\n            fc-border-0 fc-outline-none\n            ${{sm:"fc-w-12 fc-h-12",md:"fc-w-14 fc-h-14",lg:"fc-w-16 fc-h-16"}[i]}\n            ${a&&!u?"fc-animate-pulse-ring":""}\n          `,style:{backgroundColor:o||"hsl(var(--aui-primary))",color:"hsl(var(--aui-primary-foreground))"},children:[A.jsx("span",{className:`\n              fc-absolute fc-transition-all fc-duration-200\n              ${u?"fc-rotate-90 fc-scale-0":"fc-rotate-0 fc-scale-100"}\n            `,children:c||A.jsx(Xu,{className:"fc-w-6 fc-h-6"})}),A.jsx("span",{className:`\n              fc-absolute fc-transition-all fc-duration-200\n              ${u?"fc-rotate-0 fc-scale-100":"fc--rotate-90 fc-scale-0"}\n            `,children:A.jsx(Zu,{className:"fc-w-6 fc-h-6"})})]})}),A.jsx(ul,{className:"\n          fc-fixed fc-z-50\n          fc-w-[400px] fc-h-[550px] fc-max-h-[calc(100vh-120px)]\n          fc-rounded-2xl fc-overflow-hidden\n          fc-shadow-chat fc-border fc-border-[hsl(var(--aui-border))]\n          fc-bg-[hsl(var(--aui-background))]\n          fc-outline-none\n          data-[state=open]:fc-animate-slide-up\n          data-[state=closed]:fc-animate-fade-out\n          max-[480px]:fc-inset-0 max-[480px]:fc-w-full max-[480px]:fc-h-full\n          max-[480px]:fc-max-h-full max-[480px]:fc-rounded-none\n        ",sideOffset:16,style:h,children:e})]})},e.BubbleWidget=Gu,e.ChatWidget=Fu,e.N8nRuntimeAdapter=fu,e.Thread=Ou,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),e}({},React,ReactDOM);
